"use strict";(self.webpackChunksc_viaduct=self.webpackChunksc_viaduct||[]).push([[947],{80069:(e,t,i)=>{i.d(t,{F:()=>c,a:()=>h,b:()=>u});var r,s=i(57528),o=i(73398),n=i(72790),a=i(64839),l=i(32307),d=i(70367);class c extends a.Y{}function u(){const e=new l.N5;return e.include(o.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new d.N("colorTexture",(e=>e.color)),new d.N("focusArea",(e=>e.focusArea)),new n.c("focusAreaEffectMode",(e=>{var t;return null!==(t=e.effect)&&void 0!==t?t:1}))).main.add((0,a.H)(r||(r=(0,s.A)(["float mask = texture( focusArea, uv, 0.0 ).r;\nvec4 color = texture( colorTexture, uv, 0.0 );\nvec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);\nif (focusAreaEffectMode == 1) {\nfragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;\n} else {\nfragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);\n}"])))),e}const h=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},40366:(e,t,i)=>{i.d(t,{F:()=>p,a:()=>g,b:()=>v});var r,s,o=i(57528),n=i(34761),a=i(13191),l=i(9392),d=i(64839),c=i(43425),u=i(32307),h=i(66470);class p extends d.Y{constructor(){super(...arguments),this.origin=l.uY}}function v(){const e=new u.N5;return e.attributes.add(h.r.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new c.X("proj",((e,t)=>t.camera.projectionMatrix)),new c.X("view",((e,t)=>(0,n.Tl)(f,t.camera.viewMatrix,e.origin)))).main.add((0,d.H)(r||(r=(0,o.A)(["gl_Position = proj * view * vec4(position, 1.0);"])))),e.fragment.main.add((0,d.H)(s||(s=(0,o.A)(["fragColor = vec4(1., 0., 0., 1.);"])))),e}const f=(0,a.vt)(),g=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskPassParameters:p,build:v},Symbol.toStringTag,{value:"Module"}))},66185:(e,t,i)=>{i.r(t),i.d(t,{default:()=>j});var r=i(35143),s=i(30726),o=i(68134),n=i(46053),a=i(85842),l=i(38983),d=i(13191),c=i(20664),u=i(9392),h=i(5809),p=i(44815),v=i(38496),f=i(45136),g=i(64465),_=i(83491),y=i(49296),m=i(16266),w=i(36423),A=i(87925),b=(i(81806),i(76460),i(47249),i(16455)),E=i(36451),C=i(16506),T=i(59246),M=i(80069),N=i(57162);class S extends T.w{constructor(e,t,r){super(e,t,new C.$(M.a,(()=>i.e(5915).then(i.bind(i,75915)))),r)}initializePipeline(){return(0,N.Ey)({colorWrite:N.kn})}}var x=i(40366),R=i(93345);class P extends T.w{constructor(e,t,r){super(e,t,new C.$(x.a,(()=>i.e(7144).then(i.bind(i,47144)))),r)}initializePipeline(){return(0,N.Ey)({colorWrite:N.kn,depthTest:{func:R.MT.LEQUAL}})}}var I=i(32119),O=i(11850),F=i(69008),H=i(76718);let Z=class extends E.A{constructor(e){super(e),this.consumes={required:["final-color"]},this.produces="final-color",this.focusAreaGeometries=new Array,this._vaos=Array(),this._count=new Array,this._origins=new Array,this._colorParameters=new M.F,this._maskParameters=new x.F,e.techniques.precompile(P),e.techniques.precompile(S)}initialize(){this.setExtrudedVolume()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos=[],this._count=[],this._origins=[]}render(e){const t=this.techniques.acquire(P),i=this.techniques.acquire(S),r=this.bindParameters,s=e.find((e=>{let{name:t}=e;return"final-color"===t})),o=null===s||void 0===s?void 0:s.getTexture(),n=r.camera,a=n.fullViewport[2],l=n.fullViewport[3],d=this.fboCache.acquire(a,l,"focusArea",b.N.RGBA),c=this.fboCache.acquire(a,l,this.produces);if(!t.compiled||!i.compiled||!this._vaos||this.effect===L.NONE)return this.requestRender(),t.release(),i.release(),c.release(),d.release(),s;const u=this.renderingContext;d.attachDepth(s.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),u.bindFramebuffer(d.fbo),u.clear(R.NV.COLOR|R.NV.STENCIL),u.setViewport(0,0,a,l),u.gl.clearStencil(0),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.setClearStencil(0);for(let h=0;h<this._vaos.length;h++){const e=this._vaos[h],i=this._count[h];e&&(this._maskParameters.origin=this._origins[h],u.bindTechnique(t,r,this._maskParameters),u.setFaceCullingEnabled(!1),u.setStencilTestEnabled(!0),u.setStencilWriteMask(255),u.setStencilFunction(R.MT.ALWAYS,0,255),u.setStencilOpSeparate(R.Y7.FRONT,R.eA.KEEP,R.eA.INCR_WRAP,R.eA.KEEP),u.setStencilOpSeparate(R.Y7.BACK,R.eA.KEEP,R.eA.DECR_WRAP,R.eA.KEEP),u.setDepthWriteEnabled(!1),u.setColorMask(!1,!1,!1,!1),u.bindVAO(e),u.drawArrays(R.WR.TRIANGLES,0,i),u.setFaceCullingEnabled(!1),u.setDepthTestEnabled(!1),u.setStencilFunction(R.MT.NOTEQUAL,0,255),u.setStencilWriteMask(0),u.setColorMask(!0,!0,!0,!0),u.drawArrays(R.WR.TRIANGLES,0,i))}return t.release(),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.bindFramebuffer(c.fbo),this._colorParameters.color=o,this._colorParameters.focusArea=d.getTexture(),this._colorParameters.effect=this.effect,u.bindTechnique(i,r,this._colorParameters),u.screen.draw(),d.release(),i.release(),c.attachDepth(s.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c}setExtrudedVolume(){const e=this.focusAreaGeometries;this._vaos=[],this._count=[],this._origins=[];for(let i=0;i<e.length;i++){var t;const r=e[i],s=new Array,o=r.indicesBottom;this._origins.push(r.origin);for(let e=0;e<o.length;e++)s.push(r.positions[3*(o[e]-1)]),s.push(r.positions[3*(o[e]-1)+1]),s.push(r.positions[3*(o[e]-1)+2]);const n=r.indicesExtruded;for(let e=0;e<n.length;e++)s.push(r.positions[3*n[e]]),s.push(r.positions[3*n[e]+1]),s.push(r.positions[3*n[e]+2]);const a=new Float32Array(s),l=new F.Z(this.renderingContext,I.D,new Map([["geometry",O.SL]]),new Map([["geometry",H.g.createVertex(this.renderingContext,R._U.STATIC_DRAW,a)]]));null!==(t=this._vaos)&&void 0!==t&&t.push(l),this._count.push(o.length+n.length)}}};(0,r._)([(0,n.MZ)()],Z.prototype,"consumes",void 0),(0,r._)([(0,n.MZ)()],Z.prototype,"produces",void 0),(0,r._)([(0,n.MZ)({constructOnly:!0})],Z.prototype,"techniques",void 0),(0,r._)([(0,n.MZ)()],Z.prototype,"focusAreaGeometries",void 0),(0,r._)([(0,n.MZ)()],Z.prototype,"effect",void 0),Z=(0,r._)([(0,a.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaRenderNode")],Z);class k{constructor(e,t,i,r,s){this.positions=e,this.indicesBottom=t,this.indicesExtruded=i,this.height=r,this.origin=s}}var L,q;(q=L||(L={}))[q.NONE=0]="NONE",q[q.BRIGHT=1]="BRIGHT",q[q.DARK=2]="DARK";const D={none:L.NONE,bright:L.BRIGHT,dark:L.DARK};var V=i(91196);let B=class extends((0,_.w)(V.A)){constructor(){super(...arguments),this.type="focusArea-3d",this._elevationContext=new y.F,this._geometries=new Array}initialize(){this.addHandles([(0,o.wB)((()=>this.layer.geometries),((e,t)=>{t=e,this._extrudePolygons(t),this._setFocusAreaRenderNode()}),o.pc),(0,o.wB)((()=>this.layer.tmpEffect),((e,t)=>{t=e,this._renderNode&&t&&(this._renderNode.effect=D[t])}),o.pc),(0,o.wB)((()=>this.layer.visible),((e,t)=>{var i,r;e?null!==(i=this._renderNode)&&void 0!==i||(this._renderNode=new Z({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:D[null!==(r=this.layer.tmpEffect)&&void 0!==r?r:"none"]})):this._renderNode=(0,s.pR)(this._renderNode)}),o.pc)])}destroy(){this._renderNode=(0,s.pR)(this._renderNode),this._geometries=[]}_extrudePolygons(e){this._geometries=[];for(const t of e){const e=(0,d.vt)(),i=(0,u.vt)(),r=this.view.renderCoordsHelper.viewingMode===g.RT.Global;r||this.view.renderCoordsHelper.worldUpAtPosition(null,i);const s=(0,w.W$)(t);if(null==s)return;(0,h.l)(t.spatialReference,[s.x,s.y,0],e,this.view.renderCoordsHelper.spatialReference);const o=(0,c.n)(G,[e[12]-0*i[0],e[13]-0*i[1],e[14]-0*i[2]]),n=(0,d.vt)();n[12]=-e[12],n[13]=-e[13],n[14]=-e[14];const a=(0,A.C8)(t,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:_,mapPositions:y,position:b}=a;for(const t of _){const s=t.count,a=(0,l.e)(t.mapPositions,t.holeIndices,3);if(0===a.length)continue;const d=a.length,c=6*s,u=(0,v.my)(c+d),h=(0,v.my)(d),g=(0,p.jh)(3*c),_=(0,p.jh)(3*c),w=(0,p.jh)(3*c),A=(0,p.jh)(c);(0,m.K)(b,y,a,t,g,w,_,A,u,h,1e4,i,r),(0,f.t)(g,g,n);const E=new k(g,h,u,1e4,[e[12]+0*o[0],e[13]+0*o[1],e[14]+0*o[2]]);this._geometries.push(E)}}}_setFocusAreaRenderNode(){var e;this._renderNode?(this._renderNode.focusAreaGeometries=this._geometries,this._renderNode.setExtrudedVolume()):this._renderNode=new Z({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:D[null!==(e=this.layer.tmpEffect)&&void 0!==e?e:"none"]})}};(0,r._)([(0,n.MZ)()],B.prototype,"type",void 0),(0,r._)([(0,n.MZ)()],B.prototype,"layer",void 0),B=(0,r._)([(0,a.$)("esri.views.3d.layers.FocusAreaLayerView3D")],B);const G=(0,u.vt)(),j=B},83491:(e,t,i)=>{i.d(t,{w:()=>c});var r=i(35143),s=i(54901),o=i(50346),n=i(68134),a=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),d=i(47700);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,d.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,s.hA)((()=>e.abort()))),await(0,n.C_)((()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),t),(0,o.Te)(t);const i=(0,d.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,r._)([(0,a.MZ)()],t.prototype,"view",void 0),(0,r._)([(0,a.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,r._)([(0,l.$)("esri.views.3d.layers.LayerView3D")],t),t}},91196:(e,t,i)=>{i.d(t,{A:()=>f});var r=i(35143),s=i(91967),o=i(54099),n=i(5632),a=i(76460),l=i(30726),d=i(91291),c=i(46053),u=(i(81806),i(47249),i(85842)),h=i(19451),p=i(90992);let v=class extends((0,n.sA)((0,d.g)(o.A.EventedMixin(s.A)))){constructor(e){super(e),this._updatingHandles=new h.U,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t;const i=this.layer&&this.layer.id||"no id",r=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";a.A.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),e)}}))}destroy(){this._updatingHandles=(0,l.pR)(this._updatingHandles)}get fullOpacity(){var e,t,i,r;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(i=null===(r=this.parent)||void 0===r?void 0:r.fullOpacity)&&void 0!==i?i:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var e;const t=this.view.timeExtent,i=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!i||!t.intersection(i).isEmpty}canResume(){var e,t,i;const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(i=this.view)||void 0===i?void 0:i.ready)&&(0,p.g7)(r)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var e,t;const i=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0);const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.g7)(r)&&this.visibleAtCurrentScale||(i.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(i.outsideVisibilityTimeExtent=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,r._)([(0,c.MZ)()],v.prototype,"view",void 0),(0,r._)([(0,c.MZ)()],v.prototype,"fullOpacity",null),(0,r._)([(0,c.MZ)()],v.prototype,"layer",void 0),(0,r._)([(0,c.MZ)()],v.prototype,"parent",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"suspended",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"suspendInfo",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"legendEnabled",null),(0,r._)([(0,c.MZ)({type:Boolean,readOnly:!0})],v.prototype,"updating",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"updatingProgress",null),(0,r._)([(0,c.MZ)()],v.prototype,"updateSuspended",null),(0,r._)([(0,c.MZ)()],v.prototype,"visible",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"visibleAtCurrentScale",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"visibleAtCurrentTimeExtent",null),v=(0,r._)([(0,u.$)("esri.views.layers.LayerView")],v);const f=v}}]);
//# sourceMappingURL=947.8373865b.chunk.js.map