"use strict";(self.webpackChunksc_viaduct=self.webpackChunksc_viaduct||[]).push([[947],{80069:(e,t,s)=>{s.d(t,{F:()=>l,a:()=>d,b:()=>c});var i=s(73398),r=s(72790),o=s(64839),n=s(32307),a=s(70367);class l extends o.Y{}function c(){const e=new n.N5;return e.include(i.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new a.N("colorTexture",(e=>e.color)),new a.N("focusArea",(e=>e.focusArea)),new r.c("focusAreaEffectMode",(e=>e.effect??1))).main.add(o.H`float mask = texture( focusArea, uv, 0.0 ).r;
vec4 color = texture( colorTexture, uv, 0.0 );
vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);
if (focusAreaEffectMode == 1) {
fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;
} else {
fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:l,build:c},Symbol.toStringTag,{value:"Module"}))},40366:(e,t,s)=>{s.d(t,{F:()=>d,a:()=>p,b:()=>u});var i=s(34761),r=s(13191),o=s(9392),n=s(64839),a=s(43425),l=s(32307),c=s(66470);class d extends n.Y{constructor(){super(...arguments),this.origin=o.uY}}function u(){const e=new l.N5;return e.attributes.add(c.r.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new a.X("proj",((e,t)=>t.camera.projectionMatrix)),new a.X("view",((e,t)=>(0,i.Tl)(h,t.camera.viewMatrix,e.origin)))).main.add(n.H`gl_Position = proj * view * vec4(position, 1.0);`),e.fragment.main.add(n.H`fragColor = vec4(1., 0., 0., 1.);`),e}const h=(0,r.vt)(),p=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskPassParameters:d,build:u},Symbol.toStringTag,{value:"Module"}))},66185:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var i=s(35143),r=s(30726),o=s(68134),n=s(46053),a=s(85842),l=s(38983),c=s(13191),d=s(20664),u=s(9392),h=s(5809),p=s(44815),f=s(38496),g=s(45136),v=s(64465),y=s(83491),_=s(49296),m=s(16266),w=s(36423),A=s(87925),b=(s(81806),s(76460),s(47249),s(16455)),E=s(36451),C=s(16506),T=s(59246),M=s(80069),N=s(57162);class S extends T.w{constructor(e,t,i){super(e,t,new C.$(M.a,(()=>s.e(5915).then(s.bind(s,75915)))),i)}initializePipeline(){return(0,N.Ey)({colorWrite:N.kn})}}var x=s(40366),R=s(93345);class P extends T.w{constructor(e,t,i){super(e,t,new C.$(x.a,(()=>s.e(7144).then(s.bind(s,47144)))),i)}initializePipeline(){return(0,N.Ey)({colorWrite:N.kn,depthTest:{func:R.MT.LEQUAL}})}}var I=s(32119),O=s(11850),F=s(69008),H=s(76718);let Z=class extends E.A{constructor(e){super(e),this.consumes={required:["final-color"]},this.produces="final-color",this.focusAreaGeometries=new Array,this._vaos=Array(),this._count=new Array,this._origins=new Array,this._colorParameters=new M.F,this._maskParameters=new x.F,e.techniques.precompile(P),e.techniques.precompile(S)}initialize(){this.setExtrudedVolume()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos=[],this._count=[],this._origins=[]}render(e){const t=this.techniques.acquire(P),s=this.techniques.acquire(S),i=this.bindParameters,r=e.find((e=>{let{name:t}=e;return"final-color"===t})),o=r?.getTexture(),n=i.camera,a=n.fullViewport[2],l=n.fullViewport[3],c=this.fboCache.acquire(a,l,"focusArea",b.N.RGBA),d=this.fboCache.acquire(a,l,this.produces);if(!t.compiled||!s.compiled||!this._vaos||this.effect===L.NONE)return this.requestRender(),t.release(),s.release(),d.release(),c.release(),r;const u=this.renderingContext;c.attachDepth(r.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),u.bindFramebuffer(c.fbo),u.clear(R.NV.COLOR|R.NV.STENCIL),u.setViewport(0,0,a,l),u.gl.clearStencil(0),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.setClearStencil(0);for(let h=0;h<this._vaos.length;h++){const e=this._vaos[h],s=this._count[h];e&&(this._maskParameters.origin=this._origins[h],u.bindTechnique(t,i,this._maskParameters),u.setFaceCullingEnabled(!1),u.setStencilTestEnabled(!0),u.setStencilWriteMask(255),u.setStencilFunction(R.MT.ALWAYS,0,255),u.setStencilOpSeparate(R.Y7.FRONT,R.eA.KEEP,R.eA.INCR_WRAP,R.eA.KEEP),u.setStencilOpSeparate(R.Y7.BACK,R.eA.KEEP,R.eA.DECR_WRAP,R.eA.KEEP),u.setDepthWriteEnabled(!1),u.setColorMask(!1,!1,!1,!1),u.bindVAO(e),u.drawArrays(R.WR.TRIANGLES,0,s),u.setFaceCullingEnabled(!1),u.setDepthTestEnabled(!1),u.setStencilFunction(R.MT.NOTEQUAL,0,255),u.setStencilWriteMask(0),u.setColorMask(!0,!0,!0,!0),u.drawArrays(R.WR.TRIANGLES,0,s))}return t.release(),u.gl.clear(u.gl.STENCIL_BUFFER_BIT),u.bindFramebuffer(d.fbo),this._colorParameters.color=o,this._colorParameters.focusArea=c.getTexture(),this._colorParameters.effect=this.effect,u.bindTechnique(s,i,this._colorParameters),u.screen.draw(),c.release(),s.release(),d.attachDepth(r.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),d}setExtrudedVolume(){const e=this.focusAreaGeometries;this._vaos=[],this._count=[],this._origins=[];for(let t=0;t<e.length;t++){const s=e[t],i=new Array,r=s.indicesBottom;this._origins.push(s.origin);for(let e=0;e<r.length;e++)i.push(s.positions[3*(r[e]-1)]),i.push(s.positions[3*(r[e]-1)+1]),i.push(s.positions[3*(r[e]-1)+2]);const o=s.indicesExtruded;for(let e=0;e<o.length;e++)i.push(s.positions[3*o[e]]),i.push(s.positions[3*o[e]+1]),i.push(s.positions[3*o[e]+2]);const n=new Float32Array(i),a=new F.Z(this.renderingContext,I.D,new Map([["geometry",O.SL]]),new Map([["geometry",H.g.createVertex(this.renderingContext,R._U.STATIC_DRAW,n)]]));this._vaos?.push(a),this._count.push(r.length+o.length)}}};(0,i._)([(0,n.MZ)()],Z.prototype,"consumes",void 0),(0,i._)([(0,n.MZ)()],Z.prototype,"produces",void 0),(0,i._)([(0,n.MZ)({constructOnly:!0})],Z.prototype,"techniques",void 0),(0,i._)([(0,n.MZ)()],Z.prototype,"focusAreaGeometries",void 0),(0,i._)([(0,n.MZ)()],Z.prototype,"effect",void 0),Z=(0,i._)([(0,a.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaRenderNode")],Z);class k{constructor(e,t,s,i,r){this.positions=e,this.indicesBottom=t,this.indicesExtruded=s,this.height=i,this.origin=r}}var L,q;(q=L||(L={}))[q.NONE=0]="NONE",q[q.BRIGHT=1]="BRIGHT",q[q.DARK=2]="DARK";const D={none:L.NONE,bright:L.BRIGHT,dark:L.DARK};var V=s(91196);let B=class extends((0,y.w)(V.A)){constructor(){super(...arguments),this.type="focusArea-3d",this._elevationContext=new _.F,this._geometries=new Array}initialize(){this.addHandles([(0,o.wB)((()=>this.layer.geometries),((e,t)=>{t=e,this._extrudePolygons(t),this._setFocusAreaRenderNode()}),o.pc),(0,o.wB)((()=>this.layer.tmpEffect),((e,t)=>{t=e,this._renderNode&&t&&(this._renderNode.effect=D[t])}),o.pc),(0,o.wB)((()=>this.layer.visible),((e,t)=>{e?this._renderNode??=new Z({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:D[this.layer.tmpEffect??"none"]}):this._renderNode=(0,r.pR)(this._renderNode)}),o.pc)])}destroy(){this._renderNode=(0,r.pR)(this._renderNode),this._geometries=[]}_extrudePolygons(e){this._geometries=[];for(const t of e){const e=(0,c.vt)(),s=(0,u.vt)(),i=this.view.renderCoordsHelper.viewingMode===v.RT.Global;i||this.view.renderCoordsHelper.worldUpAtPosition(null,s);const r=(0,w.W$)(t);if(null==r)return;(0,h.l)(t.spatialReference,[r.x,r.y,0],e,this.view.renderCoordsHelper.spatialReference);const o=(0,d.n)(G,[e[12]-0*s[0],e[13]-0*s[1],e[14]-0*s[2]]),n=(0,c.vt)();n[12]=-e[12],n[13]=-e[13],n[14]=-e[14];const a=(0,A.C8)(t,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:y,mapPositions:_,position:b}=a;for(const t of y){const r=t.count,a=(0,l.e)(t.mapPositions,t.holeIndices,3);if(0===a.length)continue;const c=a.length,d=6*r,u=(0,f.my)(d+c),h=(0,f.my)(c),v=(0,p.jh)(3*d),y=(0,p.jh)(3*d),w=(0,p.jh)(3*d),A=(0,p.jh)(d);(0,m.K)(b,_,a,t,v,w,y,A,u,h,1e4,s,i),(0,g.t)(v,v,n);const E=new k(v,h,u,1e4,[e[12]+0*o[0],e[13]+0*o[1],e[14]+0*o[2]]);this._geometries.push(E)}}}_setFocusAreaRenderNode(){this._renderNode?(this._renderNode.focusAreaGeometries=this._geometries,this._renderNode.setExtrudedVolume()):this._renderNode=new Z({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:D[this.layer.tmpEffect??"none"]})}};(0,i._)([(0,n.MZ)()],B.prototype,"type",void 0),(0,i._)([(0,n.MZ)()],B.prototype,"layer",void 0),B=(0,i._)([(0,a.$)("esri.views.3d.layers.FocusAreaLayerView3D")],B);const G=(0,u.vt)(),j=B},83491:(e,t,s)=>{s.d(t,{w:()=>d});var i=s(35143),r=s(54901),o=s(50346),n=s(68134),a=s(46053),l=(s(81806),s(76460),s(47249),s(85842)),c=s(47700);const d=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,c.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,r.hA)((()=>e.abort()))),await(0,n.C_)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,o.Te)(t);const s=(0,c.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(s)throw s}};return(0,i._)([(0,a.MZ)()],t.prototype,"view",void 0),(0,i._)([(0,a.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,i._)([(0,l.$)("esri.views.3d.layers.LayerView3D")],t),t}},91196:(e,t,s)=>{s.d(t,{A:()=>g});var i=s(35143),r=s(91967),o=s(54099),n=s(5632),a=s(76460),l=s(30726),c=s(91291),d=s(46053),u=(s(81806),s(47249),s(85842)),h=s(19451),p=s(90992);let f=class extends((0,n.sA)((0,c.g)(o.A.EventedMixin(r.A)))){constructor(e){super(e),this._updatingHandles=new h.U,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",s=this.layer?.title||"no title";a.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${s}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,l.pR)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,p.g7)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.g7)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,i._)([(0,d.MZ)()],f.prototype,"view",void 0),(0,i._)([(0,d.MZ)()],f.prototype,"fullOpacity",null),(0,i._)([(0,d.MZ)()],f.prototype,"layer",void 0),(0,i._)([(0,d.MZ)()],f.prototype,"parent",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],f.prototype,"suspended",null),(0,i._)([(0,d.MZ)({readOnly:!0})],f.prototype,"suspendInfo",null),(0,i._)([(0,d.MZ)({readOnly:!0})],f.prototype,"legendEnabled",null),(0,i._)([(0,d.MZ)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),(0,i._)([(0,d.MZ)({readOnly:!0})],f.prototype,"updatingProgress",null),(0,i._)([(0,d.MZ)()],f.prototype,"updateSuspended",null),(0,i._)([(0,d.MZ)()],f.prototype,"visible",null),(0,i._)([(0,d.MZ)({readOnly:!0})],f.prototype,"visibleAtCurrentScale",null),(0,i._)([(0,d.MZ)({readOnly:!0})],f.prototype,"visibleAtCurrentTimeExtent",null),f=(0,i._)([(0,u.$)("esri.views.layers.LayerView")],f);const g=f}}]);
//# sourceMappingURL=947.24cee53e.chunk.js.map