"use strict";(self.webpackChunksc_viaduct=self.webpackChunksc_viaduct||[]).push([[4137,8156],{45667:(e,t,i)=>{i.d(t,{b:()=>u});const n=2654435761,r=2246822519,s=3266489917,a=668265263,l=374761393;function o(e){const t=[];for(let i=0,n=e.length;i<n;i++){let n=e.charCodeAt(i);n<128?t.push(n):n<2048?t.push(192|n>>6,128|63&n):n<55296||n>=57344?t.push(224|n>>12,128|n>>6&63,128|63&n):(i++,n=65536+((1023&n)<<10|1023&e.charCodeAt(i)),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return new Uint8Array(t)}class u{constructor(e){this._seed=e,this._totallen=0,this._bufs=[],this.init()}init(){return this._bufs=[],this._totallen=0,this}updateFloatArray(e){const t=[];for(const i of e)isNaN(i)?t.push("NaN"):i===1/0?t.push("Infinity"):i===-1/0?t.push("-Infinity"):0===i?t.push("0"):t.push(i.toString(16));this.update(o(t.join("")))}updateIntArray(e){const t=Int32Array.from(e);this.update(new Uint8Array(t.buffer))}updateUint8Array(e){this.update(Uint8Array.from(e))}updateWithString(e){return this.update(o(e))}update(e){return this._bufs.push(e),this._totallen+=e.length,this}digest(){const e=new Uint8Array(this._totallen);let t=0;for(const i of this._bufs)e.set(i,t),t+=i.length;return this.init(),this._xxHash32(e,this._seed)}_xxHash32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e;let o=t+l&4294967295,u=0;if(i.length>=16){const i=[t+n+r&4294967295,t+r&4294967295,t+0&4294967295,t-n&4294967295],s=e,a=s.length-16;let l=0;for(u=0;(4294967280&u)<=a;u+=4){const e=u,t=s[e]+(s[e+1]<<8),a=s[e+2]+(s[e+3]<<8),o=t*r+(a*r<<16);let d=i[l]+o&4294967295;d=d<<13|d>>>19;const p=65535&d,h=d>>>16;i[l]=p*n+(h*n<<16)&4294967295,l=l+1&3}o=(i[0]<<1|i[0]>>>31)+(i[1]<<7|i[1]>>>25)+(i[2]<<12|i[2]>>>20)+(i[3]<<18|i[3]>>>14)&4294967295}o=o+e.length&4294967295;const d=e.length-4;for(;u<=d;u+=4){const e=u,t=i[e]+(i[e+1]<<8),n=i[e+2]+(i[e+3]<<8);o=o+(t*s+(n*s<<16))&4294967295,o=o<<17|o>>>15,o=(65535&o)*a+((o>>>16)*a<<16)&4294967295}for(;u<i.length;++u)o+=i[u]*l,o=o<<11|o>>>21,o=(65535&o)*n+((o>>>16)*n<<16)&4294967295;return o^=o>>>15,o=((65535&o)*r&4294967295)+((o>>>16)*r<<16),o^=o>>>13,o=((65535&o)*s&4294967295)+((o>>>16)*s<<16),o^=o>>>16,o<0?o+4294967296:o}}},46530:(e,t,i)=>{function n(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?s(e.view.floors,t.floorInfo.floorField):null}function r(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(!e?.length)return null;const i=e.filter((e=>""!==e)).map((e=>`'${e}'`));return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}i.d(t,{E:()=>n,f:()=>r})},43543:(e,t,i)=>{i.d(t,{F:()=>r});var n=i(98156);function r(e,t,i){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:r=!1,timeOffset:s,useViewTime:a}=e;let l=e.timeExtent;r&&(l=(0,n.YU)(l));let o=a?t&&l?t.intersection(l):t||l:l;return!o||o.isEmpty||o.isAllTime?o:(s&&(o=o.offset(-s.value,s.unit)),r&&(o=(0,n.h3)(o)),o.equals(i)?i:o)}},98156:(e,t,i)=>{i.d(t,{getTimeSliderSettingsFromWebDocument:()=>c,YU:()=>g,h3:()=>y});var n=i(18690),r=(i(63241),i(53084)),s=(i(76460),i(18288)),a=i(59187),l=i(2515),o=i(72027);function u(e){return void 0!==e.timeInfo}async function d(e,t){return e.widgets?.timeSlider?.fullTimeExtent??async function(e,t){if(0===e.length)return a.A.allTime;await Promise.all(e.map((e=>e.load({signal:t}))));const i=e.filter(u),r=e.filter((e=>!u(e)&&null!=e.visibilityTimeExtent));if(0===i.length&&0===r.length)return a.A.allTime;const s=[],l=[];for(const n of i)"feature"!==n?.type&&"map-image"!==n?.type||!n.timeInfo?.hasLiveData?l.push(n):s.push(n);const o=e=>null==e||e.isAllTime,d=[...l.map((e=>{const t=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=e;return t?.intersection(i)??i})),...r.map((e=>e.visibilityTimeExtent))];if(d.some(o))return a.A.allTime;const p=s.map((async e=>{const i=(await e.fetchRecomputedExtents({signal:t}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=e;return i?.intersection(n)??n})),h=(await Promise.allSettled(p)).map((e=>"fulfilled"===e.status?e.value:null));if(h.some(o))return a.A.allTime;const c=[...h,...d].filter(n.Ru);return 0===c.length?a.A.allTime:c.reduce(((e,t)=>e.union(t)))}(e.allLayers,t)}function p(e){const{numStops:t,stopInterval:i,stops:n}=e;return n?{dates:(0,r.o8)(n)}:i?{interval:i.clone()}:{count:t??5}}function h(e,t){const i=e.currentTimeExtent;if(!i)return null;const{start:n,end:r}=i,s=n??r??null;switch(t){case"time-window":return new a.A({start:n,end:r});case"cumulative-from-start":return new a.A({start:null,end:s});case"cumulative-from-end":return new a.A({start:s,end:null});case"instant":return new a.A({start:s,end:s})}}async function c(e,t){if(!(0,l.r)(e)&&!function(e){return null!=e&&"object"==typeof e&&o.X in e}(e))return null;await e.load({signal:t});const i=e?.widgets?.timeSlider;if(!i)return null;const n=await d(e,t),r=i.loop,s=function(e){const t=e.numThumbs??2,i=e.currentTimeExtent;if(i){const{start:e,end:n}=i;return null!=e&&null!=n&&e.getTime()===n.getTime()?"instant":2===t?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===t?"time-window":"cumulative-from-start"}(i);return{fullTimeExtent:n,loop:r,mode:s,playRate:i.stopDelay??2e3,stops:p(i),timeExtent:h(i,s)}}function y(e){if(!e)return e;const{start:t,end:i}=e;return new a.A({start:null!=t?(0,s.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,s.S1)(i,-i.getTimezoneOffset(),"minutes"):i})}function g(e){if(!e)return e;const{start:t,end:i}=e;return new a.A({start:null!=t?(0,s.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,s.S1)(i,i.getTimezoneOffset(),"minutes"):i})}},83491:(e,t,i)=>{i.d(t,{w:()=>d});var n=i(35143),r=i(54901),s=i(50346),a=i(68134),l=i(46053),o=(i(81806),i(76460),i(47249),i(85842)),u=i(47700);const d=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,u.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,r.hA)((()=>e.abort()))),await(0,a.C_)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,s.Te)(t);const i=(0,u.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,n._)([(0,l.MZ)()],t.prototype,"view",void 0),(0,n._)([(0,l.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,n._)([(0,o.$)("esri.views.3d.layers.LayerView3D")],t),t}},21010:(e,t,i)=>{i.d(t,{n:()=>V});var n=i(35143),r=i(39356),s=i(45667),a=i(4212),l=i(54901),o=i(30726),u=i(91291),d=i(50346),p=i(68134),h=i(46053),c=(i(76460),i(47249),i(85842)),y=i(15011),g=i(19451),f=i(45417),m=i(50008),_=i(86486),b=i(68295),v=i(57662),w=i(38865),E=i(86079),x=i(29257),C=i(35148),S=i(31329),M=i(90592),I=i(93788),R=i(36423),O=i(18083),A=i(88536),Z=i(42123),F=i(44513),T=i(1723);let V=class extends u.Z{constructor(e){super(e),this.type="graphics-3d",this._randomRotationRenderers=null,this._updatingHandles=new g.U,this.elevationFeatureExpressionEnabled=!1,this.scaleVisibilityEnabled=!1,this.filterVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this.elevationAlignmentEnabled=!1,this.timeExtentEnabled=!1,this.setUidToIdOnAdd=!0,this.dataExtent=null,this.drapeSourceType=v.Om.Features,this.preferredUpdatePolicy=F.q.ASYNC,this._suspendResumeExtent=null}initialize(){const e=this.owner,t=(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==e.layer.geometryType,i=new x.w({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.hasZ,hasM:e.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:t=>e.view.deconflictor.addGraphicsOwner(t),labeler:(t,i)=>e.view.labeler.addGraphicsOwner(t,i),elevationAlignment:this.elevationAlignmentEnabled?(t,i)=>new C.V({graphicsCoreOwner:this,graphicsCore:t,queryGraphicUIDsInExtent:i,elevationProvider:e.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(t,i)=>new I.N({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:i,graphicsCore:t,basemapTerrain:e.view.basemapTerrain}):null,filterVisibility:t?t=>new A.t({context:{...t,configuration:e}}):null,objectStates:e=>new M.w(e)}});this._set("graphicsCore",i),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new S.p({graphicsCoreOwner:this})),this.elevationAlignment&&this._updatingHandles.add((()=>this.layer.elevationInfo),((e,t)=>{(0,y.Ui)(e,t)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())})),this._updatingHandles.add((()=>this.layer.labelsVisible),(()=>this.graphicsCore.updateVisibilityInfo())),this._updatingHandles.add((()=>this.layer.labelingInfo),((e,t)=>{(0,y.Ui)(e,t)&&this.graphicsCore.updateLabelingInfo()})),this._updatingHandles.add((()=>this.preferredUpdatePolicy),(e=>this.graphicsCore.preferredUpdatePolicy=e)),this.addResolvingPromise(this._initializeAsync())}async _initializeAsync(){await(0,d.Qg)(this.graphicsCore.initializePromise);const e=this.owner;this._updatingHandles.add((()=>this.renderer),(e=>this._updatingHandles.addPromise(this.graphicsCore.rendererChange(e)))),this._updatingHandles.add((()=>e.fullOpacity),(()=>this.graphicsCore.opacityChange())),this._setupSuspendResumeExtent(),this.updateClippingExtent&&(this._updatingHandles.add((()=>e.view.clippingArea),(()=>this._updateClippingExtent())),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled&&await(0,d.Qg)(this.graphicsCore.updateLabelingInfo())}destroy(){this._updatingHandles.destroy(),this._set("frustumVisibility",(0,o.pR)(this.frustumVisibility)),this._set("graphicsCore",(0,o.pR)(this.graphicsCore)),this._set("owner",null)}get layer(){return this.owner.layer}get dataUpdating(){return this.graphicsCore?.dataUpdating??!1}get renderer(){const{renderer:e,objectIdField:t}=this.layer;if(!e||!t||"heatmap"===e.type||!e.visualVariables)return e;const i=e.visualVariables.findIndex((e=>"rotation"===e.type&&null!=e.valueExpression&&(0,m.D)(e.valueExpression)===t&&(null==e.axis||"heading"===e.axis)&&"geographic"===e.rotationType));if(i<0)return e;const n=e.clone();return n.visualVariables?(n.visualVariables.splice(i,1),this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap),this._randomRotationRenderers.set(n,t),n):e}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get filterVisibility(){return this.graphicsCore?.filterVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get suspendResumeExtentMode(){return this.owner.suspendResumeExtentMode??"computed"}get scaleVisibilitySuspended(){return null!=this.scaleVisibility&&this.scaleVisibility.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return null==this.frustumVisibility||!this.frustumVisibility.suspended}get suspendInfo(){const e={};return this.scaleVisibilitySuspended&&(e.outsideScaleRange=!0),null!=this.frustumVisibility&&this.frustumVisibility.suspended&&(e.outsideOfView=!0),e}get updating(){return!!(this.graphicsCore?.updating||this.frustumVisibility?.updating||this._updatingHandles.updating)}get updatingRemaining(){return this.graphicsCore?.updatingRemaining??0}get featureStore(){return this.graphicsCore?.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner?.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}get featureSpatialReference(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get symbolUpdateType(){return this.graphicsCore?.symbolUpdateType}get displayFeatureLimit(){const e=this.view.quality,t=this.graphicsCore?.displayFeatureLimit;if(1===e)return t;const i=Math.ceil(t.maximumNumberOfFeatures*e);return new E.o(t.maximumTotalNumberOfVertices,i,t.averageSymbolComplexity)}get usedMemory(){return this.graphicsCore?.usedMemory??0}get loadedFeatures(){return this.graphicsCore?.numberOfGraphics??0}get usedMemoryPerFeature(){return this.graphicsCore?.usedMemoryPerGraphic??0}get unprocessedMemoryEstimate(){return this.graphicsCore?.unprocessedMemoryEstimate??0}get performanceInfo(){return this.graphicsCore.performanceInfo}maskOccludee(e){const t=this.graphicsCore?.objectStates;if(!t)return(0,l.hA)();const{set:i,handle:n}=t.acquireOccludeeSet(null);return t.setUid(i,e.uid),n}highlight(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const n=this.graphicsCore?.objectStates;if(!n)return Z.Wg;if(i??=T.Tv,e instanceof b.A){const{set:r,handle:s}=n.acquireHighlightSet(i,t);return this.owner.queryObjectIds(e).then((e=>n.setObjectIds(r,e))),s}let s=(0,Z.UX)(e);if(0===s.length)return Z.Wg;if(s[0]instanceof r.A){const e=s;if(null==(0,O.f)(this.layer.fieldsIndex,e[0].attributes,t)){const t=e.map((e=>e.uid)),{set:r,handle:s}=n.acquireHighlightSet(i,null);return n.setUids(r,t),s}s=e.map((e=>(0,O.f)(this.layer.fieldsIndex,e.attributes,t)))}if((0,Z.TS)(s[0])){const e=s,{set:r,handle:a}=n.acquireHighlightSet(i,t);return n.setObjectIds(r,e),a}return Z.Wg}resetObjectStates(){this.graphicsCore?.objectStates?.reset()}whenGraphicBounds(e,t){return this.graphicsCore?.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.graphicsCore?.computeAttachmentOrigin(e,t)}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}getRenderingInfo(e,t,i){const n=(0,_.vl)(e,{renderer:t,arcade:i});if(n?.color){const e=n.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}if(null!=n&&null!=t&&this._randomRotationRenderers?.has(t)){const i=this._randomRotationRenderers.get(t),r=e.attributes[i],a=new s.b(0);a.updateFloatArray([r]),a.updateUint8Array([173]),n.heading=8.381e-8*a.digest()}return n}getRenderingInfoAsync(e,t,i,n){return(0,_.LO)(e,{renderer:t,arcade:i,...n})}getSymbolLayerSize(e,t){return this.graphicsCore?.getSymbolLayerSize(e,t)}setObjectIdVisibility(e,t){this.graphicsCore?.setObjectIdVisibility(e,t)}refreshFilter(){null!=this.filterVisibility&&this.filterVisibility.reapply()}getGraphics3DGraphicByObjectId(e){return this.graphicsCore?.getGraphics3DGraphicByObjectId(e)}_updateClippingExtent(){const e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this.addHandles((0,p.wB)((()=>this.suspendResumeExtentMode),(()=>{switch(this.removeHandles(Q),this.suspendResumeExtentMode){case"computed":this.addHandles([(0,p.wB)((()=>this.graphicsCore.computedExtent),(e=>this._updateSuspendResumeExtent(e)),p.Vh),(0,p.wB)((()=>this.graphicsCore.extentPadding),(()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent)))],Q);break;case"data":this.addHandles([(0,p.z7)((()=>this.dataExtent),(e=>this._updateSuspendResumeExtent(e)),p.Vh),(0,p.wB)((()=>this.graphicsCore.extentPadding),(()=>this._updateSuspendResumeExtent(this.dataExtent)))],Q);break;default:(0,a.Xb)(this.suspendResumeExtentMode)}}),p.Vh))}_updateSuspendResumeExtent(e){e?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(e,this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)}_extentToSuspendResumeRect(e,t){const i=this.owner.view.spatialReference;if(!e.spatialReference.equals(i)){if(!(0,f.y7)(e,i))return;e=(0,f.Cv)(e,i)}return(0,R.t8)(e,t,w.qD,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(e){null!=this.frustumVisibility&&this.frustumVisibility.setExtent(e),null!=this.scaleVisibility&&this.scaleVisibility.setExtent(e)}};(0,n._)([(0,h.MZ)()],V.prototype,"type",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"owner",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"layer",null),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"dataUpdating",null),(0,n._)([(0,h.MZ)()],V.prototype,"renderer",null),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"updateClippingExtent",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"elevationFeatureExpressionEnabled",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"graphicsCore",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"scaleVisibilityEnabled",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"filterVisibilityEnabled",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"frustumVisibilityEnabled",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"elevationAlignmentEnabled",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"timeExtentEnabled",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"setUidToIdOnAdd",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"scaleVisibility",null),(0,n._)([(0,h.MZ)()],V.prototype,"filterVisibility",null),(0,n._)([(0,h.MZ)()],V.prototype,"elevationAlignment",null),(0,n._)([(0,h.MZ)({constructOnly:!0})],V.prototype,"frustumVisibility",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"suspendResumeExtentMode",null),(0,n._)([(0,h.MZ)()],V.prototype,"dataExtent",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"scaleVisibilitySuspended",null),(0,n._)([(0,h.MZ)()],V.prototype,"suspended",null),(0,n._)([(0,h.MZ)()],V.prototype,"legendEnabled",null),(0,n._)([(0,h.MZ)()],V.prototype,"suspendInfo",null),(0,n._)([(0,h.MZ)()],V.prototype,"updating",null),(0,n._)([(0,h.MZ)()],V.prototype,"updatingRemaining",null),(0,n._)([(0,h.MZ)()],V.prototype,"featureStore",null),(0,n._)([(0,h.MZ)()],V.prototype,"view",null),(0,n._)([(0,h.MZ)()],V.prototype,"loadedGraphics",null),(0,n._)([(0,h.MZ)()],V.prototype,"fullOpacity",null),(0,n._)([(0,h.MZ)()],V.prototype,"filter",null),(0,n._)([(0,h.MZ)()],V.prototype,"slicePlaneEnabled",null),(0,n._)([(0,h.MZ)()],V.prototype,"drapeSourceType",void 0),(0,n._)([(0,h.MZ)()],V.prototype,"updatePolicy",null),(0,n._)([(0,h.MZ)()],V.prototype,"preferredUpdatePolicy",void 0),(0,n._)([(0,h.MZ)({readOnly:!0})],V.prototype,"displayFeatureLimit",null),V=(0,n._)([(0,c.$)("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],V);const Q="suspendResumeExtentMode"},20170:(e,t,i)=>{i.d(t,{d:()=>y});var n=i(35143),r=(i(35238),i(91967)),s=i(46053),a=(i(81806),i(76460),i(47249),i(85842)),l=i(76797),o=i(38276),u=i(1900),d=i(77725),p=i(68295),h=i(31608);const c=o.d;let y=class extends r.A{get layer(){return this.context.layer}get spatialReference(){return this.context.spatialReference}get _queryGeometryType(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}get defaultQueryJSON(){return new p.A({outSpatialReference:this.spatialReference}).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(e){super(e),this._dataQueryEngineInstance=null}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,t,i){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e,t),i)}async executeQueryForCount(e,t){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)}async executeQueryForExtent(e,t){const{count:i,extent:n}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t);return{count:i,extent:l.A.fromJSON(n)}}async executeQueryForIds(e,t){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)}async executeQueryForLatestObservations(e,t){const i=await this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),t),n=d.A.fromJSON(i);return n.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),n}async executeQuery(e,t){const i=await this._dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t),n=d.A.fromJSON(i);return n.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),n}_ensureQueryJSON(e,t){let i=this.defaultQueryJSON;if(null!=e&&("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),i=e.toJSON()),null!=t){const e=t.geometries.map((e=>e.toJSON())).reduce(((e,t)=>(e.rings=e.rings.concat(t.rings),e)));i={...i,sceneFilter:{...t,geometry:e}}}return i}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e="timeInfo"in this.layer&&this.layer.timeInfo?.toJSON()||null,t=this.layer.objectIdField,i=h.g.toJSON(this._queryGeometryType),n=this.layer.fieldsIndex?.toJSON()||new u.A([]),r=this.priority,s=this.spatialReference.toJSON(),{hasZ:a,hasM:l,featureStore:o,scheduler:d}=this.context;return this._dataQueryEngineInstance=new c({hasZ:a,hasM:l,geometryType:i,fieldsIndex:n,timeInfo:e,spatialReference:s,objectIdField:t,featureStore:o,scheduler:d,priority:r}),this._dataQueryEngineInstance}};(0,n._)([(0,s.MZ)({constructOnly:!0})],y.prototype,"context",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],y.prototype,"priority",void 0),(0,n._)([(0,s.MZ)()],y.prototype,"layer",null),(0,n._)([(0,s.MZ)()],y.prototype,"spatialReference",null),(0,n._)([(0,s.MZ)()],y.prototype,"_queryGeometryType",null),(0,n._)([(0,s.MZ)()],y.prototype,"defaultQueryJSON",null),y=(0,n._)([(0,a.$)("esri.views.3d.layers.graphics.QueryEngine")],y)},88536:(e,t,i)=>{i.d(t,{t:()=>f});var n=i(35143),r=i(91967),s=i(76460),a=i(30726),l=i(50346),o=i(68134),u=i(46053),d=(i(81806),i(47249),i(85842)),p=i(19451),h=i(8203),c=i(46530),y=i(20170),g=i(59752);let f=class extends r.A{constructor(e){super(e),this._frameTask=null,this._queryEngine=null,this._updateRequested=!0,this._updatingHandles=new p.U,this._abortController=new AbortController}initialize(){const e=g.W6.FILTER_VISIBILITY,{layer:t,view:i}=this._configuration,{featureStore:n}=this.context,r=this._configuration.hasZ??!1,s=this._configuration.hasM??!1;this._queryEngine=new y.d({context:{spatialReference:i.spatialReference,layer:t,scheduler:i.resourceController.scheduler,featureStore:n,hasM:s,hasZ:r},priority:e}),this._frameTask=i.resourceController.scheduler.registerTask(e),this._updatingHandles.add((()=>[this._compositedFeatureFilter,this._sceneFilter]),(()=>this._updateRequested=!0),o.Vh),this._updatingHandles.addWhen((()=>!this._frameTask.updating&&this._updateRequested),(()=>{this._frameTask.schedule((()=>this._updateVisibility()),this._abortController.signal),this._updateRequested=!1}),o.Vh)}destroy(){this._abortController.abort(),this._updatingHandles.destroy(),this.clear(),this._frameTask=(0,a.xt)(this._frameTask),this._queryEngine=(0,a.pR)(this._queryEngine),this._set("context",null)}get updating(){return this._updateRequested||this._updatingHandles.updating||this._frameTask.updating}get defaultVisibility(){return null==this._compositedFeatureFilter&&null==this._sceneFilter}get _featureFilter(){return"filter"in this._configuration?this._configuration.filter:null}get _sceneFilter(){return"layerFilter"in this._configuration?this._configuration.layerFilter:null}get _floorFilter(){return(0,c.E)(this._configuration)}get _timeExtent(){return"timeExtent"in this._configuration?this._configuration.timeExtent:null}get _compositedFeatureFilter(){const{_featureFilter:e,_timeExtent:t,_floorFilter:i}=this;if(null==t&&null==i)return e;const n=e?.clone()??new h.A;if(null!=t&&(n.timeExtent=n.timeExtent?.intersection(t)??t),null!=i){const e=null==n.where||""===n.where;n.where=e?i:`(${n.where}) AND (${i})`}return n}get _configuration(){return this.context.configuration}reapply(){this._updateRequested=!0}clear(){this._queryEngine.clear(),this.context.clearFeaturesVisibility()}async _updateVisibility(){const e=this._compositedFeatureFilter,t=this._sceneFilter,{signal:i}=this._abortController,n=this._frameTask,{context:r}=this;if((0,l.Te)(i),null==e&&null==t||0===r.getFeatureCount())return await n.schedule((()=>this.clear()),i);try{const s=await this._queryEngine.executeQueryForIdSet(e,t,i);return(0,l.Te)(i),await n.schedule((()=>{r.updateFeatureVisibilities((e=>s.has(e)))}),i)}catch(a){return(0,l.QP)(a),s.A.getLogger(this).warn(`FeatureFilter query failed: ${a}`,{error:a}),await n.schedule((()=>{r.setAllFeaturesVisibility(!0)}),i)}}};(0,n._)([(0,u.MZ)({constructOnly:!0})],f.prototype,"context",void 0),(0,n._)([(0,u.MZ)()],f.prototype,"updating",null),(0,n._)([(0,u.MZ)()],f.prototype,"defaultVisibility",null),(0,n._)([(0,u.MZ)()],f.prototype,"_featureFilter",null),(0,n._)([(0,u.MZ)()],f.prototype,"_sceneFilter",null),(0,n._)([(0,u.MZ)()],f.prototype,"_floorFilter",null),(0,n._)([(0,u.MZ)()],f.prototype,"_timeExtent",null),(0,n._)([(0,u.MZ)()],f.prototype,"_compositedFeatureFilter",null),(0,n._)([(0,u.MZ)()],f.prototype,"_configuration",null),(0,n._)([(0,u.MZ)()],f.prototype,"_updateRequested",void 0),f=(0,n._)([(0,d.$)("esri.views.3d.layers.support.FeatureVisibilityFilter")],f)},18083:(e,t,i)=>{function n(e,t,i){if(!i||null==t)return null;if(!e)return function(e,t){const i=t.toLowerCase();for(const n in e)if(n.toLowerCase()===i)return e[n];return null}(t,i);const n=e.get(i);return n?t[n.name]:null}i.d(t,{f:()=>n})},91196:(e,t,i)=>{i.d(t,{A:()=>g});var n=i(35143),r=i(91967),s=i(54099),a=i(5632),l=i(76460),o=i(30726),u=i(91291),d=i(46053),p=(i(81806),i(47249),i(85842)),h=i(19451),c=i(90992);let y=class extends((0,a.sA)((0,u.g)(s.A.EventedMixin(r.A)))){constructor(e){super(e),this._updatingHandles=new h.U,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer?.title||"no title";l.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,o.pR)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,c.g7)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,c.g7)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,n._)([(0,d.MZ)()],y.prototype,"view",void 0),(0,n._)([(0,d.MZ)()],y.prototype,"fullOpacity",null),(0,n._)([(0,d.MZ)()],y.prototype,"layer",void 0),(0,n._)([(0,d.MZ)()],y.prototype,"parent",void 0),(0,n._)([(0,d.MZ)({readOnly:!0})],y.prototype,"suspended",null),(0,n._)([(0,d.MZ)({readOnly:!0})],y.prototype,"suspendInfo",null),(0,n._)([(0,d.MZ)({readOnly:!0})],y.prototype,"legendEnabled",null),(0,n._)([(0,d.MZ)({type:Boolean,readOnly:!0})],y.prototype,"updating",null),(0,n._)([(0,d.MZ)({readOnly:!0})],y.prototype,"updatingProgress",null),(0,n._)([(0,d.MZ)()],y.prototype,"updateSuspended",null),(0,n._)([(0,d.MZ)()],y.prototype,"visible",null),(0,n._)([(0,d.MZ)({readOnly:!0})],y.prototype,"visibleAtCurrentScale",null),(0,n._)([(0,d.MZ)({readOnly:!0})],y.prototype,"visibleAtCurrentTimeExtent",null),y=(0,n._)([(0,p.$)("esri.views.layers.LayerView")],y);const g=y},2515:(e,t,i)=>{i.d(t,{r:()=>s});var n=i(19898);class r extends n.R{constructor(e,t){super(e,t,"webmap")}}function s(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}new r(2,32)}}]);
//# sourceMappingURL=4137.eed0a203.chunk.js.map