"use strict";(self.webpackChunksc_viaduct=self.webpackChunksc_viaduct||[]).push([[474],{9854:(e,t,i)=>{function n(){return new Float32Array(4)}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(e,t,i,n){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=n,s}function a(){return n()}function o(){return r(1,1,1,1)}function l(){return r(1,0,0,0)}function h(){return r(0,1,0,0)}function c(){return r(0,0,1,0)}function u(){return r(0,0,0,1)}i.d(t,{c:()=>s,f:()=>r});const d=a(),_=o(),f=l(),p=h(),m=c(),g=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:_,UNIT_W:g,UNIT_X:f,UNIT_Y:p,UNIT_Z:m,ZEROS:d,clone:s,create:n,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:r,ones:o,unitW:u,unitX:l,unitY:h,unitZ:c,zeros:a},Symbol.toStringTag,{value:"Module"}))},29234:(e,t,i)=>{i.d(t,{A:()=>c});var n,s,r=i(81806),a=i(3789);(s=n||(n={}))[s.varint=0]="varint",s[s.fixed64=1]="fixed64",s[s.delimited=2]="delimited",s[s.fixed32=5]="fixed32",s[s.unknown=99]="unknown";const o=4294967296,l=new TextDecoder("utf-8"),h=(0,r.A)("safari")||(0,r.A)("ios")?6:(0,r.A)("ff")?12:32;class c{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e?e.byteLength:0;this._tag=0,this._dataType=n.unknown,this._init(e,t,i,s)}_init(e,t,i,n){this._data=e,this._dataView=t,this._pos=i,this._end=n}asUnsafe(){return this}clone(){return new c(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();if(void 0!==e)return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+e.getUint32(t+4,!0)*o;return this._skip(8),i}getSFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+e.getInt32(t+4,!0)*o;return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,i=this._toString(this._data,t,t+e);return this._skip(e),i}getBytes(){const e=this._getLength(),t=this._pos,i=this._toBytes(this._data,t,t+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,i,n){const s=this.getMessage(),r=e(s,t,i,n);return s.release(),r}processMessage(e){const t=this.getMessage(),i=e(t);return t.release(),i}getMessage(){const e=this._getLength(),t=c.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){c.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t=this._pos,i=0,n=0;if(this._end-t>=10)do{if(n=e[t++],i|=127&n,0==(128&n))break;if(n=e[t++],i|=(127&n)<<7,0==(128&n))break;if(n=e[t++],i|=(127&n)<<14,0==(128&n))break;if(n=e[t++],i|=(127&n)<<21,0==(128&n))break;if(n=e[t++],i+=268435456*(127&n),0==(128&n))break;if(n=e[t++],i+=34359738368*(127&n),0==(128&n))break;if(n=e[t++],i+=4398046511104*(127&n),0==(128&n))break;if(n=e[t++],i+=562949953421312*(127&n),0==(128&n))break;if(n=e[t++],i+=72057594037927940*(127&n),0==(128&n))break;if(n=e[t++],i+=0x8000000000000000*(127&n),0==(128&n))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;t!==this._end&&(n=e[t],0!=(128&n));)++t,i+=(127&n)*s,s*=128;if(t===this._end)throw new Error("Varint overrun!");++t,i+=n*s}return this._pos=t,i}_decodeSVarint(){const e=this._data;let t,i=0,n=0;const s=1&e[this._pos];if(n=e[this._pos++],i|=127&n,0==(128&n))return s?-(i+1)/2:i/2;if(n=e[this._pos++],i|=(127&n)<<7,0==(128&n))return s?-(i+1)/2:i/2;if(n=e[this._pos++],i|=(127&n)<<14,0==(128&n))return s?-(i+1)/2:i/2;if(n=e[this._pos++],i|=(127&n)<<21,0==(128&n))return s?-(i+1)/2:i/2;if(n=e[this._pos++],i+=268435456*(127&n),0==(128&n))return s?-(i+1)/2:i/2;if(n=e[this._pos++],i+=34359738368*(127&n),0==(128&n))return s?-(i+1)/2:i/2;if(n=e[this._pos++],i+=4398046511104*(127&n),0==(128&n))return s?-(i+1)/2:i/2;if(t=BigInt(i),n=e[this._pos++],t+=0x2000000000000n*BigInt(127&n),0==(128&n))return Number(s?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x100000000000000n*BigInt(127&n),0==(128&n))return Number(s?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x8000000000000000n*BigInt(127&n),0==(128&n))return Number(s?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,i){if((i=Math.min(this._end,i))-t>h){const n=e.subarray(t,i);return l.decode(n)}let n="",s="";for(let r=t;r<i;++r){const t=e[r];128&t?s+="%"+t.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(t),s="")}return s.length&&(n+=decodeURIComponent(s)),n}_toBytes(e,t,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,t,i-t)}}c.pool=new a.A(c,void 0,(e=>{e._data=null,e._dataView=null}))},62032:(e,t,i)=>{i.d(t,{O3:()=>o,Ox:()=>l,bR:()=>r,dC:()=>n});var n,s;!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(n||(n={}));class r{constructor(e,t){this.x=e,this.y=t}clone(){return new r(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){this.x=e,this.y=t}normalize(){const e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);this.x/=i,this.y/=i}rightPerpendicular(){const e=this.x;this.x=this.y,this.y=-e}move(e,t){this.x+=e,this.y+=t}assign(e){this.x=e.x,this.y=e.y}assignAdd(e,t){this.x=e.x+t.x,this.y=e.y+t.y}assignSub(e,t){this.x=e.x-t.x,this.y=e.y-t.y}rotate(e,t){const i=this.x,n=this.y;this.x=i*e-n*t,this.y=i*t+n*e}scale(e){this.x*=e,this.y*=e}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}static distance(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}static add(e,t){return new r(e.x+t.x,e.y+t.y)}static sub(e,t){return new r(e.x-t.x,e.y-t.y)}}class a{constructor(e,t,i){this.ratio=e,this.x=t,this.y=i}}class o{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=s,this._tileSize=512*n,this._dz=e,this._yPos=t,this._xPos=i}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;const i=e>>this._dz;t>i&&(t=i),this._margin=t,this._xmin=i*this._xPos-t,this._ymin=i*this._yPos-t,this._xmax=this._xmin+i+2*t,this._ymax=this._ymin+i+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new r(e,t),this._firstPt=new r(e,t),this._dist=0}lineTo(e,t){const i=this._isIn(e,t),n=new r(e,t),s=r.distance(this._prevPt,n);let o,l,h,c,u,d,_,f;if(i)this._prevIsIn?this._lineTo(e,t,!0):(o=this._prevPt,l=n,h=this._intersect(l,o),this._start=this._dist+s*(1-this._r),this._lineTo(h.x,h.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,o=n,h=this._intersect(l,o),this._lineTo(h.x,h.y,!0),this._lineTo(o.x,o.y,!1);else{const e=this._prevPt,t=n;if(e.x<=this._xmin&&t.x<=this._xmin||e.x>=this._xmax&&t.x>=this._xmax||e.y<=this._ymin&&t.y<=this._ymin||e.y>=this._ymax&&t.y>=this._ymax)this._lineTo(t.x,t.y,!1);else{const i=[];if((e.x<this._xmin&&t.x>this._xmin||e.x>this._xmin&&t.x<this._xmin)&&(c=(this._xmin-e.x)/(t.x-e.x),f=e.y+c*(t.y-e.y),f<=this._ymin?d=!1:f>=this._ymax?d=!0:i.push(new a(c,this._xmin,f))),(e.x<this._xmax&&t.x>this._xmax||e.x>this._xmax&&t.x<this._xmax)&&(c=(this._xmax-e.x)/(t.x-e.x),f=e.y+c*(t.y-e.y),f<=this._ymin?d=!1:f>=this._ymax?d=!0:i.push(new a(c,this._xmax,f))),(e.y<this._ymin&&t.y>this._ymin||e.y>this._ymin&&t.y<this._ymin)&&(c=(this._ymin-e.y)/(t.y-e.y),_=e.x+c*(t.x-e.x),_<=this._xmin?u=!1:_>=this._xmax?u=!0:i.push(new a(c,_,this._ymin))),(e.y<this._ymax&&t.y>this._ymax||e.y>this._ymax&&t.y<this._ymax)&&(c=(this._ymax-e.y)/(t.y-e.y),_=e.x+c*(t.x-e.x),_<=this._xmin?u=!1:_>=this._xmax?u=!0:i.push(new a(c,_,this._ymax))),0===i.length)u?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this._start=this._dist+s*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this._start=this._dist+s*i[0].ratio;for(let e=0;e<i.length;e++)this._lineTo(i[e].x,i[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=s,this._prevIsIn=i,this._prevPt=n}close(){if(this._line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const i=this._line;let n=i.length;for(;n>=4&&(i[0].x===i[1].x&&i[0].x===i[n-2].x||i[0].y===i[1].y&&i[0].y===i[n-2].y);)i.pop(),i[0].x=i[n-2].x,i[0].y=i[n-2].y,--n}}result(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._pushLine(),0===this._lines.length?null:(this._type===n.Polygon&&e&&h.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==n.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,t=e.length;if(0===t)return null;const i=[];for(let n=0;n<t;n++)i.push({line:e[n],start:this._starts[n]||0});return i}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,t){let i,n,s;if(t.x>=this._xmin&&t.x<=this._xmax)n=t.y<=this._ymin?this._ymin:this._ymax,s=(n-e.y)/(t.y-e.y),i=e.x+s*(t.x-e.x);else if(t.y>=this._ymin&&t.y<=this._ymax)i=t.x<=this._xmin?this._xmin:this._xmax,s=(i-e.x)/(t.x-e.x),n=e.y+s*(t.y-e.y);else{n=t.y<=this._ymin?this._ymin:this._ymax,i=t.x<=this._xmin?this._xmin:this._xmax;const r=(i-e.x)/(t.x-e.x),a=(n-e.y)/(t.y-e.y);r<a?(s=r,n=e.y+r*(t.y-e.y)):(s=a,i=e.x+a*(t.x-e.x))}return this._r=s,new r(i,n)}_pushLine(){this._line&&(this._type===n.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,t,i){this._type!==n.Polygon?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new r(e,t))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new r(e,t)),this._isH=!1,this._isV=!1)}_lineTo(e,t,i){let s,a;if(this._type!==n.Polygon)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,t)))return;this._line.push(new r(e,t))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const i=s.x===e,n=s.y===t;if(i&&n)return;this._isH&&i||this._isV&&n?(s.x=e,s.y=t,a=this._line[this._line.length-2],a.x===e&&a.y===t?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(a=this._line[this._line.length-2],this._isH=a.x===e,this._isV=a.y===t)):(this._isH=a.x===e,this._isV=a.y===t)):(this._line.push(new r(e,t)),this._isH=i,this._isV=n)}else this._line.push(new r(e,t))}}class l{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,t){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new r(e*i,t*i))}lineTo(e,t){const i=this._ratio;this._line.push(new r(e*i,t*i))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(e){e[e.sideLeft=0]="sideLeft",e[e.sideRight=1]="sideRight",e[e.sideTop=2]="sideTop",e[e.sideBottom=3]="sideBottom"}(s||(s={}));class h{static simplify(e,t,i){if(!i)return;const n=-t,r=e+t,a=-t,o=e+t,l=[],c=[],u=i.length;for(let h=0;h<u;++h){const e=i[h];if(!e||e.length<2)continue;let t,u=e[0];const d=e.length;for(let i=1;i<d;++i)t=e[i],u.x===t.x&&(u.x<=n&&(u.y>t.y?(l.push(h),l.push(i),l.push(s.sideLeft),l.push(-1)):(c.push(h),c.push(i),c.push(s.sideLeft),c.push(-1))),u.x>=r&&(u.y<t.y?(l.push(h),l.push(i),l.push(s.sideRight),l.push(-1)):(c.push(h),c.push(i),c.push(s.sideRight),c.push(-1)))),u.y===t.y&&(u.y<=a&&(u.x<t.x?(l.push(h),l.push(i),l.push(s.sideTop),l.push(-1)):(c.push(h),c.push(i),c.push(s.sideTop),c.push(-1))),u.y>=o&&(u.x>t.x?(l.push(h),l.push(i),l.push(s.sideBottom),l.push(-1)):(c.push(h),c.push(i),c.push(s.sideBottom),c.push(-1)))),u=t}if(0===l.length||0===c.length)return;h.fillParent(i,c,l),h.fillParent(i,l,c);const d=[];h.calcDeltas(d,c,l),h.calcDeltas(d,l,c),h.addDeltas(d,i)}static fillParent(e,t,i){const n=i.length,r=t.length;for(let a=0;a<r;a+=4){const r=t[a],o=t[a+1],l=t[a+2],h=e[r][o-1],u=e[r][o];let d=8092,_=-1;for(let t=0;t<n;t+=4){if(i[t+2]!==l)continue;const n=i[t],r=i[t+1],a=e[n][r-1],o=e[n][r];switch(l){case s.sideLeft:case s.sideRight:if(c(h.y,a.y,o.y)&&c(u.y,a.y,o.y)){const e=Math.abs(o.y-a.y);e<d&&(d=e,_=t)}break;case s.sideTop:case s.sideBottom:if(c(h.x,a.x,o.x)&&c(u.x,a.x,o.x)){const e=Math.abs(o.x-a.x);e<d&&(d=e,_=t)}}}t[a+3]=_}}static calcDeltas(e,t,i){const n=t.length;for(let s=0;s<n;s+=4){const n=[],r=h.calcDelta(s,t,i,n);e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]),e.push(r)}}static calcDelta(e,t,i,n){const s=t[e+3];if(-1===s)return 0;const r=n.length;return r>1&&n[r-2]===s?0:(n.push(s),h.calcDelta(s,i,t,n)+1)}static addDeltas(e,t){const i=e.length;let n=0;for(let s=0;s<i;s+=4){const t=e[s+3];t>n&&(n=t)}for(let r=0;r<i;r+=4){const i=t[e[r]],a=e[r+1],o=n-e[r+3];switch(e[r+2]){case s.sideLeft:i[a-1].x-=o,i[a].x-=o,1===a&&(i[i.length-1].x-=o),a===i.length-1&&(i[0].x-=o);break;case s.sideRight:i[a-1].x+=o,i[a].x+=o,1===a&&(i[i.length-1].x+=o),a===i.length-1&&(i[0].x+=o);break;case s.sideTop:i[a-1].y-=o,i[a].y-=o,1===a&&(i[i.length-1].y-=o),a===i.length-1&&(i[0].y-=o);break;case s.sideBottom:i[a-1].y+=o,i[a].y+=o,1===a&&(i[i.length-1].y+=o),a===i.length-1&&(i[0].y+=o)}}}}const c=(e,t,i)=>e>=t&&e<=i||e>=i&&e<=t},83367:(e,t,i)=>{i.d(t,{k:()=>o,r:()=>a});var n=i(14522),s=i(15941);const r=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function a(e,t,i){const n=(0,s.yR)(Math.ceil(i)),a=r(t)?8*n:16*n,o=2*n;e.width=a,e.height=a;const l=e.getContext("2d");l.strokeStyle="#FFFFFF",l.lineWidth=n,l.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(l.moveTo(a/2,-o),l.lineTo(a/2,a+o)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(l.moveTo(-o,a/2),l.lineTo(a+o,a/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(l.moveTo(-o,-o),l.lineTo(a+o,a+o),l.moveTo(a-o,-o),l.lineTo(a+o,o),l.moveTo(-o,a-o),l.lineTo(o,a+o)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(l.moveTo(a+o,-o),l.lineTo(-o,a+o),l.moveTo(o,-o),l.lineTo(-o,o),l.moveTo(a+o,a-o),l.lineTo(a-o,a+o)),l.stroke();const h=l.getImageData(0,0,e.width,e.height),c=new Uint8Array(h.data);let u;for(let s=0;s<c.length;s+=4)u=c[s+3]/255,c[s]=c[s]*u,c[s+1]=c[s+1]*u,c[s+2]=c[s+2]*u;return[c,e.width,e.height]}function o(e,t){const i="Butt"===t,s="Square"===t,r=!i&&!s;e.length%2==1&&(e=[...e,...e]);const a=15.5;let o=0;for(const n of e)o+=n;const l=Math.round(o*a),h=new Float32Array(31*l),c=7.75;let u=0,d=0,_=.5,f=!0;for(const n of e){for(u=d,d+=n*a;_<=d;){let e=.5;for(;e<31;){const t=(e-.5)*l+_-.5,n=r?(e-a)*(e-a):Math.abs(e-a);h[t]=f?i?Math.max(Math.max(u+c-_,n),Math.max(_-d+c,n)):n:r?Math.min((_-u)*(_-u)+n,(_-d)*(_-d)+n):s?Math.min(Math.max(_-u,n),Math.max(d-_,n)):Math.min(Math.max(_-u+c,n),Math.max(d+c-_,n)),e++}_++}f=!f}const p=h.length,m=new Uint8Array(4*p);for(let g=0;g<p;++g){const e=(r?Math.sqrt(h[g]):h[g])/a;(0,n.U)(e,m,4*g)}return[m,l,31]}},55033:(e,t,i)=>{i.d(t,{GW:()=>d,Jo:()=>s,MG:()=>n,Wh:()=>h,os:()=>o,p6:()=>u,pJ:()=>r,z0:()=>c});const n=Number.POSITIVE_INFINITY,s=Math.PI,r=2*s,a=128/s,o=s/180,l=1/Math.LN2;function h(e,t){return(e%=t)>=0?e:e+t}function c(e){return h(e*a,256)}function u(e){return Math.log(e)*l}function d(e,t,i){return e*(1-i)+t*i}},40480:(e,t,i)=>{i.d(t,{wV:()=>r});Math.PI;const n=256/360;Math.LN2;function s(e,t){return(e%=t)>=0?e:e+t}function r(e){return s(e*n,256)}},15671:(e,t,i)=>{i.d(t,{A:()=>n});class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=e,this.y=t,this.width=i,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},61551:(e,t,i)=>{var n,s,r,a,o,l,h;i.d(t,{S5:()=>s,ZG:()=>n,q0:()=>o,rU:()=>a,w4:()=>h}),function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(s||(s={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.ROTATION=4]="ROTATION",e[e.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",e[e.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",e[e.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",e[e.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(a||(a={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(o||(o={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(l||(l={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SIMPLE=1]="SIMPLE",e[e.DOT_DENSITY=2]="DOT_DENSITY",e[e.OUTLINE_FILL=3]="OUTLINE_FILL",e[e.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",e[e.HEATMAP=5]="HEATMAP",e[e.PIE_CHART=6]="PIE_CHART"}(h||(h={}))},99588:(e,t,i)=>{i.d(t,{M9:()=>r,Pl:()=>s,Ss:()=>a});const n=new Float32Array(1);new Uint32Array(n.buffer);function s(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function r(e,t){return 65535&e|t<<16}function a(e,t,i,n){return 255&e|(255&t)<<8|(255&i)<<16|n<<24}},83491:(e,t,i)=>{i.d(t,{w:()=>c});var n=i(35143),s=i(54901),r=i(50346),a=i(68134),o=i(46053),l=(i(40565),i(18690),i(81806),i(85842)),h=i(47700);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),(0,h.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,s.hA)((()=>e.abort()))),await(0,a.C_)((()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),t),(0,r.Te)(t);const i=(0,h.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!(null!==e&&void 0!==e&&e.minScale)||!e.maxScale||e.minScale>=e.maxScale)}getSuspendInfo(){const e=super.getSuspendInfo(),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}};return(0,n._)([(0,o.MZ)()],t.prototype,"view",void 0),(0,n._)([(0,o.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,n._)([(0,l.$)("esri.views.3d.layers.LayerView3D")],t),t}},96453:(e,t,i)=>{i.d(t,{E:()=>c});var n=i(35143),s=i(50076),r=i(68134),a=i(46053),o=(i(40565),i(18690),i(81806),i(85842)),l=i(93938),h=i(4225);const c=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataScaleRange(){const e=this.tileInfo.lods;let t=e[0].scale,i=e[e.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const{effectiveMinLOD:e,effectiveMaxLOD:n}=this.layer.tilemapCache;t=this.tileInfo.lodAt(e).scale,i=this.tileInfo.lodAt(n).scale}return{minScale:t,maxScale:i}}get dataLevelRange(){const{minScale:e,maxScale:t}=this.dataScaleRange;return this.levelRangeFromScaleRange(e,t)}get displayLevelRange(){const e=this.layer.minScale||this.dataScaleRange.minScale,t=this.layer.maxScale||this.dataScaleRange.maxScale,i=this.levelRangeFromScaleRange(e,t);return this.layer.maxScale&&i.maxLevel++,i}getTileUrl(e,t,i){return this.layer.getTileUrl(e,t,i)}_addTilingSchemeMatchPromise(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new s.A("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(null!=e)return this.addResolvingPromise(Promise.reject(e));const t=(0,r.C_)((()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.basemapTerrain)||void 0===e?void 0:e.tilingSchemeLocked})).then((()=>{const e=this.view.basemapTerrain.tilingScheme,t=this._getTileInfoCompatibilityError(this.tileInfo,e);if(t)throw t}));this.addResolvingPromise(t)}_getTileInfoSupportError(e,t){const i=(0,h._y)(e,t,this.view.spatialReference,this.view.state.viewingMode);if(i){const e={layer:this.layer,error:i};let t;switch(i.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":t=new s.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",e);break;default:t=new s.A("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",e)}return t}return null}_getTileInfoCompatibilityError(e,t){return null!=e&&t.compatibleWith(e)?null:new s.A("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const i={minLevel:0,maxLevel:1/0},n=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!n)return i;const s=n.levels[0],r=e=>{const t=Math.log(s.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(i.minLevel=Math.max(0,r(e))),null!=t&&t>0&&(i.maxLevel=Math.max(0,r(t))),i}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"updating",void 0),(0,n._)([(0,a.MZ)(l.S)],t.prototype,"updatingProgress",void 0),(0,n._)([(0,a.MZ)(l.b)],t.prototype,"updatingProgressValue",void 0),(0,n._)([(0,a.MZ)()],t.prototype,"fullExtent",null),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"isOpaque",null),(0,n._)([(0,a.MZ)()],t.prototype,"dataScaleRange",null),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"dataLevelRange",null),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"displayLevelRange",null),(0,n._)([(0,a.MZ)()],t.prototype,"layer",void 0),(0,n._)([(0,a.MZ)()],t.prototype,"tileInfo",void 0),t=(0,n._)([(0,o.$)("esri.views.3d.layers.TiledLayerView3D")],t),t}},65037:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Oe});var n=i(35143),s=i(50076),r=i(81806),a=i(30726),o=i(50346),l=i(68134),h=i(46053),c=(i(40565),i(18690),i(85842));class u{constructor(e,t,i){this._scale=e,this._shift=t,this._levelShift=i}getLevelRowColumn(e){const t=this.getLevelShift(e[0]),i=this._shift+t;return i?[e[0]-t,e[1]>>i,e[2]>>i]:e}getLevelShift(e){return Math.min(e,this._levelShift)}getOffset(e,t){let i=0,n=0;const s=this._shift+this.getLevelShift(e[0]);if(s){const r=(1<<s)-1,a=t/(this._scale*(1<<s-1));i=(e[2]&r)*a,n=(e[1]&r)*a}return[i,n]}getScale(e){return this._scale*(1<<this._shift+this.getLevelShift(e))}}var d=i(79369),_=i(67533),f=i(2413),p=i(90534),m=i(16783),g=i(15671);class y{constructor(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new g.A(0,0,e,t))}get width(){return this._width}get height(){return this._height}allocate(e,t){if(e>this._width||t>this._height)return new g.A;let i=null,n=-1;for(let s=0;s<this._free.length;++s){const r=this._free[s];e<=r.width&&t<=r.height&&(null===i||r.y<=i.y&&r.x<=i.x)&&(i=r,n=s)}return null===i?new g.A:(this._free.splice(n,1),i.width<i.height?(i.width>e&&this._free.push(new g.A(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new g.A(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new g.A(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new g.A(i.x,i.y+t,e,i.height-t))),new g.A(i.x,i.y,e,t))}release(e){for(let t=0;t<this._free.length;++t){const i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}var v=i(93345),x=i(98433),w=i(96673);class S{constructor(e,t,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=e,this.height=t,this._glyphSource=i,this._binPack=new y(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(e,t){const i=[],n=this._glyphSource,s=new Set;for(const a of t){const e=Math.floor(.00390625*a);s.add(e)}const r=[];return s.forEach((t=>{const i=e+t;if(this._rangePromises.has(i))r.push(this._rangePromises.get(i));else{const s=n.getRange(e,t).then((()=>{this._rangePromises.delete(i)}),(()=>{this._rangePromises.delete(i)}));this._rangePromises.set(i,s),r.push(s)}})),Promise.all(r).then((()=>{let s=this._glyphIndex[e];s||(s={},this._glyphIndex[e]=s);for(const r of t){const t=s[r];if(t){i[r]={sdf:!0,rect:t.rect,metrics:t.metrics,page:t.page,code:r};continue}const a=n.getGlyph(e,r);if(null===a||void 0===a||!a.metrics)continue;const o=a.metrics;let l;if(0===o.width)l=new g.A(0,0,0,0);else{const e=3,t=o.width+2*e,i=o.height+2*e;let n=t%4?4-t%4:4,s=i%4?4-i%4:4;1===n&&(n=5),1===s&&(s=5),l=this._binPack.allocate(t+n,i+s),l.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new y(this.width-4,this.height-4),l=this._binPack.allocate(t+n,i+s));const r=this._glyphData[this._currentPage],h=a.bitmap;let c,u;if(h)for(let a=0;a<i;a++){c=t*a,u=this.width*(l.y+a+1)+l.x;for(let e=0;e<t;e++)r[u+e+1]=h.at(c+e)}}s[r]={rect:l,metrics:o,tileIDs:null,page:this._currentPage},i[r]={sdf:!0,rect:l,metrics:o,page:this._currentPage,code:r},this._dirties[this._currentPage]=!0}return i}))}removeGlyphs(e){for(const t in this._glyphIndex){const i=this._glyphIndex[t];if(!i)continue;let n;for(const t in i)if(n=i[t],n.tileIDs.delete(e),0===n.tileIDs.size){const e=this._glyphData[n.page],s=n.rect;let r,a;for(let t=0;t<s.height;t++)for(r=this.width*(s.y+t)+s.x,a=0;a<s.width;a++)e[r+a]=0;delete i[t],this._dirties[n.page]=!0}}}bind(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this._textures[i]){const t=new w.R;t.pixelFormat=v.Ab.ALPHA,t.wrapMode=v.pF.CLAMP_TO_EDGE,t.width=this.width,t.height=this.height,this._textures[i]=new x.g(e,t,new Uint8Array(this.width*this.height))}const s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(this._glyphData[i]),e.bindTexture(s,n),this._dirties[i]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0,this._binPack=null;for(const e of this._textures)e&&e.dispose();this._textures.length=0}}var T=i(3825),b=i(29234);class I{constructor(e){if(this._metrics=[],!e)return void(this._allBitmaps=null);const t=new Map;let i=0;for(;e.next();)switch(e.tag()){case 1:{const r=e.getMessage();for(;r.next();)switch(r.tag()){case 3:{const e=r.getMessage();let a,o,l,h,c,u,d;for(;e.next();)switch(e.tag()){case 1:a=e.getUInt32();break;case 2:o=e.getBytes();break;case 3:l=e.getUInt32();break;case 4:h=e.getUInt32();break;case 5:c=e.getSInt32();break;case 6:u=e.getSInt32();break;case 7:d=e.getUInt32();break;default:e.skip()}if(e.release(),a){var n,s;const e=null!==(n=null===(s=o)||void 0===s?void 0:s.length)&&void 0!==n?n:0;this._metrics[a]={width:l,height:h,left:c,top:u,advance:d,startOffset:i,length:e},t.set(a,o),i+=e}break}default:r.skip()}r.release();break}default:e.skip()}const r=new Uint8Array(i),a=this._metrics;for(const[o,l]of t){const{startOffset:e,length:t}=a[o];if(l)for(let i=0;i<t;++i)r[e+i]=l[i]}this._allBitmaps=r}getMetrics(e){return this._metrics[e]}getBitmap(e){if(!this._allBitmaps)return;const t=this._metrics[e];if(void 0===t)return;const{startOffset:i,length:n}=t;return 0!==n?new R(this._allBitmaps,i,n):void 0}}class M{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}class P{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(e,t){const i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();const n=256*t,s=n+255;if(this._baseURL){const r=this._baseURL.replace("{fontstack}",e).replace("{range}",n+"-"+s);return(0,T.A)(r,{responseType:"array-buffer"}).then((e=>{i.addRange(t,new I(new b.A(new Uint8Array(e.data),new DataView(e.data))))})).catch((()=>{i.addRange(t,new I)}))}return i.addRange(t,new I),Promise.resolve()}getGlyph(e,t){const i=this._getFontStack(e);if(!i)return;const n=Math.floor(t/256),s=i.getRange(n);return s?{metrics:s.getMetrics(t),bitmap:s.getBitmap(t)}:void 0}_getFontStack(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new M),t}}class R{constructor(e,t,i){this._array=e,this._start=t,this.length=i}at(e){return 0<=e&&e<this.length?this._array[this._start+e]:void 0}}var E=i(83367);class L{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this._binPack=new y(e-4,t-4)}destroy(){this.dispose()}dispose(){this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={};for(const e of this._textures)e&&e.dispose();this._textures.length=0}getWidth(e){return e>=this._size.length?-1:this._size[e][0]}getHeight(e){return e>=this._size.length?-1:this._size[e][1]}getPageSize(e){return e>=this._size.length?null:this._size[e]}setSpriteSource(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new y(this._pageWidth-4,this._pageHeight-4);const e=Math.floor(this._pageWidth),t=Math.floor(this._pageHeight),i=new Uint32Array(e*t);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}getSpriteItem(e){var t;let i,n,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._mosaicRects[e];if(r)return r;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith("dasharray-")?([i,n]=this._rasterizeDash(e),s=!0):i=this._sprites.getSpriteInfo(e),null===(t=i)||void 0===t||!t.width||!i.height||i.width<0||i.height<0)return null;const a=i.width,o=i.height,[l,h,c]=this._allocateImage(a,o);return l.width<=0?null:(this._copy(l,i,h,c,s,n),r={rect:l,width:a,height:o,sdf:i.sdf,simplePattern:!1,pixelRatio:i.pixelRatio,page:h},this._mosaicRects[e]=r,r)}getSpriteItems(e){const t={};for(const i of e)t[i.name]=this.getSpriteItem(i.name,i.repeat);return t}getMosaicItemPosition(e,t){const i=this.getSpriteItem(e,t),n=i&&i.rect;if(!n)return null;n.width=i.width,n.height=i.height;const s=i.width,r=i.height;return{tl:[n.x+2,n.y+2],br:[n.x+2+s,n.y+2+r],page:i.page}}bind(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(i>=this._size.length||i>=this._mosaicsData.length)return;if(!this._textures[i]){const t=new w.R;t.wrapMode=v.pF.CLAMP_TO_EDGE,t.width=this._size[i][0],t.height=this._size[i][1],this._textures[i]=new x.g(e,t,new Uint8Array(this._mosaicsData[i].buffer))}const s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(s,n),this._dirties[i]=!1}static _copyBits(e,t,i,n,s,r,a,o,l,h,c){let u=n*t+i,d=o*r+a;if(c){d-=r;for(let a=-1;a<=h;a++,u=((a+h)%h+n)*t+i,d+=r)for(let t=-1;t<=l;t++)s[d+t]=e[u+(t+l)%l]}else for(let _=0;_<h;_++){for(let t=0;t<l;t++)s[d+t]=e[u+t];u+=t,d+=r}}_copy(e,t,i,n,s,r){if(!this._sprites||"loaded"!==this._sprites.loadStatus||i>=this._mosaicsData.length)return;const a=new Uint32Array(r?r.buffer:this._sprites.image.buffer),o=this._mosaicsData[i];o&&a||console.error("Source or target images are uninitialized!");const l=r?t.width:this._sprites.width;L._copyBits(a,l,t.x,t.y,o,n[0],e.x+2,e.y+2,t.width,t.height,s),this._dirties[i]=!0}_allocateImage(e,t){e+=2,t+=2;const i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){const i=new g.A(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}let n=e%4?4-e%4:4,s=t%4?4-t%4:4;1===n&&(n=5),1===s&&(s=5);const r=this._binPack.allocate(e+n,t+s);return r.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new y(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[r,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(e){const t=e.match(/\[(.*?)\]/);if(!t)return null;const i=t[1].split(",").map(Number),n=e.slice(e.lastIndexOf("-")+1),[s,r,a]=(0,E.k)(i,n);return[{x:0,y:0,width:r,height:a,sdf:!0,pixelRatio:1},new Uint8Array(s.buffer)]}}var C=i(93453);class A{constructor(e,t,i){this._layer=e,this._styleRepository=t,this.devicePixelRatio=i,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}destroy(){var e,t,i;null!==(e=this._connection)&&void 0!==e&&e.close(),this._connection=null,this._styleRepository=null,this._layer=null,null!==(t=this._spriteMosaic)&&void 0!==t&&t.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=(0,a.DC)(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&null!==(i=this._startOptionsInputSignal)&&void 0!==i&&i.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}get spriteMosaic(){return this._spriteSourcePromise.then((()=>this._spriteMosaic))}get glyphMosaic(){return this._glyphMosaic}async start(e){this._requestSprite(e);const t=this._layer.currentStyleInfo.glyphsUrl,i=new P(t?(0,p.a6)(t,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new S(1024,1024,i),this._broadcastPromise=(0,m.ho)("WorkerTileHandler",{client:this,schedule:e.schedule,signal:e.signal}).then((t=>{var i;if(this._layer&&(null!==(i=this._connection)&&void 0!==i&&i.close(),this._connection=t,this._layer&&!this._connection.closed)){const i=t.broadcast("setStyle",this._layer.currentStyleInfo.style,e);Promise.all(i).catch((e=>(0,o.jH)(e)))}}))}_requestSprite(e){var t,i;null===(t=this._spriteSourceAbortController)||void 0===t||t.abort();const n=new AbortController;this._spriteSourceAbortController=n;const s=null===e||void 0===e?void 0:e.signal;this._inputSignalEventListener&&null!==(i=this._startOptionsInputSignal)&&void 0!==i&&i.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,s&&(this._inputSignalEventListener=function(e){return()=>e.abort()}(n),s.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const{signal:r}=n,a={...e,signal:r};this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,a),this._spriteSourcePromise.then((e=>{(0,o.QP)(r),this._spriteMosaic=new L(1024,1024,250),this._spriteMosaic.setSpriteSource(e)}))}async updateStyle(e){return await this._broadcastPromise,this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",e)),this._broadcastPromise}setSpriteSource(e){const t=new L(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),this._spriteSourceAbortController=null,t}async setStyle(e,t){await this._broadcastPromise,this._styleRepository=e,this._requestSprite();const i=new P(this._layer.currentStyleInfo.glyphsUrl?(0,p.a6)(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);return this._glyphMosaic=new S(1024,1024,i),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",t)),this._broadcastPromise}fetchTileData(e,t){return this._getRefKeys(e,t).then((e=>{const i=this._layer.sourceNameToSource,n=[];for(const t in i)n.push(t);return this._getSourcesData(n,e,t)}))}parseTileData(e,t){const i=e&&e.data;if(!i)return Promise.resolve(null);const{sourceName2DataAndRefKey:n,transferList:s}=i;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((()=>this._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},{...t,transferList:s})))}async getSprites(e){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(e)}getGlyphs(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}async _getTilePayload(e,t,i){const n=C.A.pool.acquire(e.id),s=this._layer.sourceNameToSource[t],{level:r,row:a,col:l}=n;C.A.pool.release(n);try{return{protobuff:await s.requestTile(r,a,l,i),sourceName:t}}catch(A){if((0,o.zf)(A))throw A;return{protobuff:null,sourceName:t}}}_getRefKeys(e,t){const i=this._layer.sourceNameToSource,n=new Array;for(const s in i){const r=i[s].getRefKey(e,t);n.push(r)}return Promise.allSettled(n)}_getSourcesData(e,t,i){const n=[];for(let s=0;s<t.length;s++){const r=t[s],a="fulfilled"===r.status?r.value:null;if(null==a||null==e[s])n.push(null);else{const t=this._getTilePayload(a,e[s],i);n.push(t)}}return Promise.allSettled(n).then((e=>{const i={},n=[];for(let s=0;s<e.length;s++){const r=e[s],a="fulfilled"===r.status?r.value:null,o=null===a||void 0===a?void 0:a.protobuff;if(!a||null===o||void 0===o||!o.byteLength)continue;const l=t[s],h="fulfilled"===l.status?l.value:null;if(h){const e=h.id;i[a.sourceName]={refKey:e,protobuff:o},n.push(o)}}return{sourceName2DataAndRefKey:i,transferList:n}}))}}var D=i(542),U=i(36458),k=i(62887),O=i(6645),N=i(76418);function z(e,t,i,n,s,r){const{iconRotationAlignment:a,textRotationAlignment:o,iconTranslate:l,iconTranslateAnchor:h,textTranslate:c,textTranslateAnchor:u}=n;let d=0;for(const _ of e.colliders){const[e,n]=0===_.partIndex?l:c,f=0===_.partIndex?h:u,p=_.minLod<=r&&r<=_.maxLod;d+=p?0:1,_.enabled=p,_.xScreen=_.xTile*s[0]+_.yTile*s[3]+s[6],_.yScreen=_.xTile*s[1]+_.yTile*s[4]+s[7],f===N.Cq.MAP?(_.xScreen+=i*e-t*n,_.yScreen+=t*e+i*n):(_.xScreen+=e,_.yScreen+=n),N.I5.VIEWPORT===(0===_.partIndex?a:o)?(_.dxScreen=_.dxPixels,_.dyScreen=_.dyPixels):(_.dxScreen=i*(_.dxPixels+_.width/2)-t*(_.dyPixels+_.height/2)-_.width/2,_.dyScreen=t*(_.dxPixels+_.width/2)+i*(_.dyPixels+_.height/2)-_.height/2)}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}class F{constructor(e,t,i,n,s,r){this._symbols=e,this._styleRepository=n,this._zoom=s,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new O.xT(t,i,k.o2),this._si=Math.sin(Math.PI*r/180),this._co=Math.cos(Math.PI*r/180);for(const a of e)for(const e of a.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,(0,_.a)(e.tile.transforms.tileUnitsToPixels))}work(e){const t=this._gridIndex;function i(e){const i=e.xScreen+e.dxScreen,n=e.yScreen+e.dyScreen,s=i+e.width,r=n+e.height,[a,o,l,h]=t.getCellSpan(i,n,s,r);for(let c=o;c<=h;c++)for(let e=a;e<=l;e++){const a=t.cells[c][e];for(const e of a){const t=e.xScreen+e.dxScreen,a=e.yScreen+e.dyScreen,o=t+e.width,l=a+e.height;if(!(s<t||i>o||r<a||n>l))return!0}}return!1}const n=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const t=this._symbols[this._currentLayerCursor],s=this._getProperties(t.styleLayerUID);for(;this._currentSymbolCursor<t.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-n>e)return!1;const r=t.symbols[this._currentSymbolCursor];if(!r.unique.show)continue;z(r,this._si,this._co,s,this._allNeededMatrices.get(r.tile),this._zoom);const a=r.unique;if(!a.show)continue;const{iconAllowOverlap:o,iconIgnorePlacement:l,textAllowOverlap:h,textIgnorePlacement:c}=s;for(const e of r.colliders){if(!e.enabled)continue;const t=a.parts[e.partIndex];t.show&&(!(e.partIndex?h:o)&&i(e)&&(e.hard?a.show=!1:t.show=!1))}if(a.show)for(const e of r.colliders){if(!e.enabled)continue;if(e.partIndex?c:l)continue;if(!a.parts[e.partIndex].show)continue;const t=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,n=t+e.width,s=i+e.height,[r,o,h,u]=this._gridIndex.getCellSpan(t,i,n,s);for(let a=o;a<=u;a++)for(let t=r;t<=h;t++)this._gridIndex.cells[a][t].push(e)}}}return!0}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const i=this._zoom,n=this._styleRepository.getStyleLayerByUID(e),s=n.getLayoutValue("symbol-placement",i)!==N.kt.POINT;let r=n.getLayoutValue("icon-rotation-alignment",i);r===N.I5.AUTO&&(r=s?N.I5.MAP:N.I5.VIEWPORT);let a=n.getLayoutValue("text-rotation-alignment",i);a===N.I5.AUTO&&(a=s?N.I5.MAP:N.I5.VIEWPORT);const o=n.getPaintValue("icon-translate",i),l=n.getPaintValue("icon-translate-anchor",i),h=n.getPaintValue("text-translate",i),c=n.getPaintValue("text-translate-anchor",i),u={iconAllowOverlap:n.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:n.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:n.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:n.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:r,textRotationAlignment:a,iconTranslateAnchor:l,iconTranslate:o,textTranslateAnchor:c,textTranslate:h};return this._styleProps.set(e,u),u}}function V(e,t){if(e.priority-t.priority)return e.priority-t.priority;const i=e.tile.key,n=t.tile.key;return i.world-n.world?i.world-n.world:i.level-n.level?i.level-n.level:i.row-n.row?i.row-n.row:i.col-n.col?i.col-n.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class H{get running(){return this._running}constructor(e,t,i,n,s,r){this._visibleTiles=e,this._symbolRepository=t,this._createCollisionJob=i,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=s,this._isLayerVisible=r,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let a=0;a<e.length;a++){const t=e[a];for(let e=0;e<t.uniqueSymbols.length;e++){const i=t.uniqueSymbols[e];for(const e of i.tileSymbols)e.selectedForRendering=!1}}const t=[];let i=0,n=0;const s=this._isLayerVisible;const r=this._symbolLayerSorter;return{work:function(r){let a;const o=performance.now();for(;n<e.length;n++,i=0){const l=e[n],h=l.styleLayerUID;if(!s(h)){t[n]||(t[n]={styleLayerUID:h,symbols:[]});continue}t[n]=t[n]||{styleLayerUID:h,symbols:[]};const c=t[n];for(;i<l.uniqueSymbols.length;i++){if(a=l.uniqueSymbols[i],i%100==99&&performance.now()-o>r)return!1;let e=null,t=!1,n=!1;for(const i of a.tileSymbols)if(!n||!t){const s=i.tile;(!e||s.isCoverage||s.neededForCoverage&&!t)&&(e=i,(s.neededForCoverage||s.isCoverage)&&(n=!0),s.isCoverage&&(t=!0))}if(e.selectedForRendering=!0,n){c.symbols.push(e),a.show=!0;for(const e of a.parts)e.show=!0}else a.show=!1}}for(const e of t)e.symbols.sort(V);return!0},get sortedSymbols(){return t.sort(r)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let i=0;function n(t,i){const s=t.symbols;for(const[e,n]of s)q(n,i);e(t,i);for(const e of t.childrenTiles)n(e,i)}return{work(e){const s=performance.now();for(;i<t.length;i++){if(performance.now()-s>e)return!1;const r=t[i];null==r.parentTile&&n(r,performance.now())}return!0}}}}function q(e,t){for(const i of e){const e=i.unique;for(const i of e.parts){const n=i.targetOpacity>.5?1:-1;i.startOpacity+=n*((t-i.startTime)/k.zk),i.startOpacity=Math.min(Math.max(i.startOpacity,0),1),i.startTime=t,i.targetOpacity=e.show&&i.show?1:0}}}class W{constructor(e,t,i){this.tileCoordRange=e,this._visibleTiles=t,this._createUnique=i,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}add(e,t){this._uniqueSymbolLayerArray=null;let i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));const n=new Map;if(t)for(const a of t)i.symbols.has(a)&&(n.set(a,i.symbols.get(a)),i.symbols.delete(a));else for(const[a,o]of e.layerData)i.symbols.has(a)&&(n.set(a,i.symbols.get(a)),i.symbols.delete(a));this._removeSymbols(n);const s=e.symbols,r=new Map;for(const[a,o]of s){let e=o.length;if(e>=32){let t=this.tileCoordRange;do{t/=2,e/=4}while(e>8&&t>64);const n=new O.xT(this.tileCoordRange,this.tileCoordRange,t);r.set(a,{flat:o,index:n}),i.symbols.set(a,{flat:o,index:n});for(const e of o)n.getCell(e.xTile,e.yTile).push(e)}else r.set(a,{flat:o}),i.symbols.set(a,{flat:o})}this._addSymbols(e.key,s)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[t,i]of this._tiles){const n=new Map;for(const t of e)i.symbols.has(t)&&(n.set(t,i.symbols.get(t)),i.symbols.delete(t));this._removeSymbols(n),0===i.symbols.size&&this._tiles.delete(t)}}removeTile(e){this._uniqueSymbolLayerArray=null;const t=this._tiles.get(e.id);if(!t)return;const i=new Map;for(const[n,s]of e.symbols)t.symbols.has(n)&&(i.set(n,t.symbols.get(n)),t.symbols.delete(n));this._removeSymbols(i),0===t.symbols.size&&this._tiles.delete(e.id)}_removeSymbols(e){for(const[t,{flat:i}]of e)for(const e of i){const i=e.unique,n=i.tileSymbols,s=n.length-1;for(let t=0;t<s;t++)if(n[t]===e){n[t]=n[s];break}if(n.length=s,0===s){const e=this._uniqueSymbolsReferences.get(t);e.delete(i),0===e.size&&this._uniqueSymbolsReferences.delete(t)}e.unique=null}}_addSymbols(e,t){if(0===t.size)return;const i=this._visibleTiles;for(const n of i)n.parentTile||n.key.world!==e.world||n.key.level===e.level&&!n.key.equals(e)||this._matchSymbols(n,e,t);for(const[n,s]of t)for(const e of s)if(null==e.unique){const t=this._createUnique();e.unique=t,t.tileSymbols.push(e);let i=this._uniqueSymbolsReferences.get(n);i||(i=new Set,this._uniqueSymbolsReferences.set(n,i)),i.add(t)}}_matchSymbols(e,t,i){if(e.key.level>t.level){const i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){const i=t.level-e.key.level;if(t.row>>i!==e.key.row||t.col>>i!==e.key.col)return}if(t.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,t,i);return}const n=new Map;for(const[s,r]of i){const i=[];for(const n of r){const s=(0,O.I)(this.tileCoordRange,n.xTile,t.level,t.col,e.key.level,e.key.col),r=(0,O.I)(this.tileCoordRange,n.yTile,t.level,t.row,e.key.level,e.key.row);s>=0&&s<this.tileCoordRange&&r>=0&&r<this.tileCoordRange&&i.push({symbol:n,xTransformed:s,yTransformed:r})}const a=[],o=e.key.level<t.level?1:1<<e.key.level-t.level,l=this._tiles.get(e.id).symbols.get(s);if(l){const e=l.flat;for(const t of i){let i,n=!1;const s=t.xTransformed,r=t.yTransformed;i=null!=l.index?l.index.getCell(s,r):e;const h=t.symbol,c=h.hash;for(const e of i)if(c===e.hash&&Math.abs(s-e.xTile)<=o&&Math.abs(r-e.yTile)<=o){const t=e.unique;h.unique=t,t.tileSymbols.push(h),n=!0;break}n||a.push(h)}}a.length>0&&n.set(s,a)}for(const s of e.childrenTiles)this._matchSymbols(s,t,n)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,t=new Array(e.size);let i,n=0;for(const[s,r]of e){const e=new Array(r.size);i=0;for(const t of r)e[i++]=t;t[n]={styleLayerUID:s,uniqueSymbols:e},n++}return t}}function B(e){const t=[],i=new W(4096,t,(()=>{const e=new U.S;return e.show=!1,e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e})),n=new H(t,i,((t,i,n)=>new F(t,i,n,e.styleRepository,e.key.level,0)),((e,t)=>{(0,O.jy)(e,t,!1)}),(()=>0),(t=>{const i=e.styleRepository.getStyleLayerByUID(t).getLayoutProperty("visibility");return!i||i.getValue()!==N.bv.NONE}));t.push(e),i.add(e),n.setScreenSize(512,512),n.continue(1/0)}var G=i(88235),Z=i(40181);class J extends Z.A{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(e){const t=C.A.pool.acquire(e),i=0===t.level?null:C.A.getId(t.level-1,t.row>>1,t.col>>1,t.world);return C.A.pool.release(t),i}getTileCoverage(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0;const s=super.getTileCoverage(e,t,i,n);if(!s)return s;const r=1<<s.lodInfo.level;return s.spans=s.spans.filter((e=>e.row>=0&&e.row<r)),s}scaleToLevel(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];{const t=this._fullCacheLodInfos;if(e>t[0].scale)return t[0].level;let i,n;for(let s=0;s<t.length-1;s++)if(n=t[s+1],e>n.scale)return i=t[s],i.level+(i.scale-e)/(i.scale-n.scale);return t[t.length-1].level}}_initializeFullCacheLODs(e){let t;if(0===e[0].level)t=e.map((e=>({level:e.level,resolution:e.resolution,scale:e.scale})));else{const e=this.tileInfo.size[0],i=this.tileInfo.spatialReference;t=G.A.create({size:e,spatialReference:i}).lods.map((e=>({level:e.level,resolution:e.resolution,scale:e.scale})))}for(let i=0;i<t.length;i++)this._levelByScale[t[i].scale]=t[i].level;this._fullCacheLodInfos=t}}class Y extends A{constructor(e,t,i,n){super(e,t,i),this._memCache=n,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map,this._tileInfoView=new J(e.tileInfo,e.fullExtent)}destroy(){super.destroy(),this._ongoingRequestToController.forEach((e=>e.abort())),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}async getVectorTile(e,t,i,n){const s=new C.A(e,t,i,0);let r=this._memCache.get(s.id);if(null!=r)return r.retain(),r;const a=await this._getVectorTileData(s);if((0,o.Te)(n),!this._layer)return null;if(r=this._memCache.get(s.id),null!=r)return r.retain(),r;const l=this._layer.tileInfo.getTileBounds((0,f.vt)(),s),h=this._tileInfoView.getTileResolution(e);return r=new D.c(s,h,l[0],l[3],512,512,this._styleRepository,this._memCache),a?(r.setData(a),r.retain(),this._memCache.put(s.id,r,r.memoryUsed,d.Xs)):r.setData(null),r.neededForCoverage=!0,r.transforms.tileUnitsToPixels=(0,_.f)(1/8,0,0,0,1/8,0,0,0,1),B(r),r}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const i=new AbortController,n={signal:i.signal},s=this._getParsedVectorTileData(e,n).then((e=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),e))).catch((()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null)));return this._ongoingTileRequests.set(t,s),this._ongoingRequestToController.set(t,i),s}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then((i=>this.parseTileData({key:e,data:i},t)))}}var K=i(15941),X=i(9854),j=i(5095),$=i(61551),Q=i(99588);class ee{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,i){}drawMany(e,t,i){for(const n of t)n.visible&&this.draw(e,n,i)}}var te=i(76718),ie=i(36911);const ne=1/65536;var se=i(8640),re=i(40480);const ae={vtlBackground:class extends ee{constructor(){super(...arguments),this._color=(0,X.f)(1,0,0,1),this._patternMatrix=(0,_.c)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(e,t){const{context:i,painter:n,styleLayerUID:s,requestRender:r,allowDelayedRender:a}=e;this._loadWGLResources(e);const o=e.displayLevel,l=e.styleLayer,h=l.backgroundMaterial,c=n.vectorTilesMaterialManager,u=l.getPaintValue("background-color",o),d=l.getPaintValue("background-opacity",o),_=l.getPaintValue("background-pattern",o),f=void 0!==_,p=u[3]*d,m=1|window.devicePixelRatio,g=e.spriteMosaic;let y,x;const w=m>j.C_?2:1,S=e.drawPhase===$.S5.HITTEST,T=this._programOptions;T.id=S,T.pattern=f;const b=c.getMaterialProgram(i,h,T);if(!a||null==r||b.compiled){if(i.bindVAO(this._vao),i.useProgram(b),f){const e=g.getMosaicItemPosition(_,!0);if(null!=e){const{tl:t,br:n,page:s}=e;y=n[0]-t[0],x=n[1]-t[1];const r=g.getPageSize(s);null!=r&&(g.bind(i,v.Cj.LINEAR,s,j.$U),b.setUniform4f("u_tlbr",t[0],t[1],n[0],n[1]),b.setUniform2fv("u_mosaicSize",r),b.setUniform1i("u_texture",j.$U))}b.setUniform1f("u_opacity",d)}else this._color[0]=p*u[0],this._color[1]=p*u[1],this._color[2]=p*u[2],this._color[3]=p,b.setUniform4fv("u_color",this._color);if(b.setUniform1f("u_depth",l.z||0),S){const e=(0,Q.Pl)(s+1);b.setUniform4fv("u_id",e)}for(const e of t){if(b.setUniform1f("u_coord_range",e.rangeX),b.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),f){const t=Math.max(2**(Math.round(o)-e.key.level),1),i=w*e.width*t,n=i/(0,K.yR)(y),s=i/(0,K.yR)(x);this._patternMatrix[0]=n,this._patternMatrix[4]=s,b.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(v.MT.EQUAL,0,255),i.drawArrays(v.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:i}=e,n=i.backgroundMaterial,s=new Int8Array([0,0,1,0,0,1,1,1]),r=te.g.createVertex(t,v._U.STATIC_DRAW,s),a=new ie.Z(t,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:r});this._vao=a}},vtlFill:class extends ee{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:i,drawPhase:n,renderPass:s,spriteMosaic:r,styleLayerUID:a}=e;let o=!1;for(const x of t)if(x.layerData.has(a)){const e=x.layerData.get(a);if(e.fillIndexCount>0||e.outlineIndexCount>0){o=!0;break}}if(!o)return;const l=e.styleLayer,h=l.getPaintProperty("fill-pattern"),c=void 0!==h,u=c&&h.isDataDriven;let d;if(c&&!u){const e=h.getValue(i);d=r.getMosaicItemPosition(e,!0)}const _=!c&&l.getPaintValue("fill-antialias",i);let f,p=!0,m=1;if(!c){const e=l.getPaintProperty("fill-color"),t=l.getPaintProperty("fill-opacity");if((null===e||void 0===e||!e.isDataDriven)&&(null===t||void 0===t||!t.isDataDriven)){const e=l.getPaintValue("fill-color",i);m=l.getPaintValue("fill-opacity",i)*e[3],m>=1&&(p=!1)}}if(p&&"opaque"===s)return;n===$.S5.HITTEST&&(f=(0,Q.Pl)(a+1));const g=l.getPaintValue("fill-translate",i),y=l.getPaintValue("fill-translate-anchor",i);(p||"translucent"!==s)&&this._drawFill(e,a,l,t,g,y,c,d,u,f);const v=!l.hasDataDrivenOutlineColor&&l.outlineUsesFillColor&&m<1;_&&"opaque"!==s&&!v&&this._drawOutline(e,a,l,t,g,y,f)}_drawFill(e,t,i,n,s,r,a,o,l,h){if(a&&!l&&null==o)return;const{context:c,displayLevel:u,state:d,drawPhase:_,painter:f,pixelRatio:p,spriteMosaic:m,requestRender:g,allowDelayedRender:y}=e,x=i.fillMaterial,w=f.vectorTilesMaterialManager,S=p>j.C_?2:1,T=_===$.S5.HITTEST,b=this._fillProgramOptions;b.id=T,b.pattern=a;const I=w.getMaterialProgram(c,x,b);if(y&&null!=g&&!I.compiled)return void g();if(c.useProgram(I),null!=o){const{page:e}=o,t=m.getPageSize(e);null!=t&&(m.bind(c,v.Cj.LINEAR,e,j.$U),I.setUniform2fv("u_mosaicSize",t),I.setUniform1i("u_texture",j.$U))}I.setUniformMatrix3fv("u_displayMat3",r===N.Cq.VIEWPORT?d.displayMat3:d.displayViewMat3),I.setUniform2fv("u_fillTranslation",s),I.setUniform1f("u_depth",i.z+ne),T&&I.setUniform4fv("u_id",h);let M=-1;for(const P of n){if(!P.layerData.has(t))continue;P.key.level!==M&&(M=P.key.level,x.setDataUniforms(I,u,i,M,m));const e=P.layerData.get(t);if(!e.fillIndexCount)continue;e.prepareForRendering(c);const n=e.fillVAO;if(null!=n){if(c.bindVAO(n),I.setUniformMatrix3fv("u_dvsMat3",P.transforms.dvs),c.setStencilFunction(v.MT.EQUAL,P.stencilRef,255),a){const e=Math.max(2**(Math.round(u)-P.key.level),1),t=P.rangeX/(S*P.width*e);I.setUniform1f("u_patternFactor",t)}if(l){const t=e.patternMap;if(!t)continue;for(const[e,i]of t){const t=m.getPageSize(e);null!=t&&(m.bind(c,v.Cj.LINEAR,e,j.$U),I.setUniform2fv("u_mosaicSize",t),I.setUniform1i("u_texture",j.$U),c.drawElements(v.WR.TRIANGLES,i[1],v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else c.drawElements(v.WR.TRIANGLES,e.fillIndexCount,v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.fillIndexStart);P.triangleCount+=e.fillIndexCount/3}}}_drawOutline(e,t,i,n,s,r,a){const{context:o,displayLevel:l,state:h,drawPhase:c,painter:u,pixelRatio:d,spriteMosaic:_,requestRender:f,allowDelayedRender:p}=e,m=i.outlineMaterial,g=u.vectorTilesMaterialManager,y=.75/d,x=c===$.S5.HITTEST,w=this._outlineProgramOptions;w.id=x;const S=g.getMaterialProgram(o,m,w);if(p&&null!=f&&!S.compiled)return void f();o.useProgram(S),S.setUniformMatrix3fv("u_displayMat3",r===N.Cq.VIEWPORT?h.displayMat3:h.displayViewMat3),S.setUniform2fv("u_fillTranslation",s),S.setUniform1f("u_depth",i.z+ne),S.setUniform1f("u_outline_width",y),x&&S.setUniform4fv("u_id",a);let T=-1;for(const b of n){if(!b.layerData.has(t))continue;b.key.level!==T&&(T=b.key.level,m.setDataUniforms(S,l,i,T,_));const e=b.layerData.get(t);if(e.prepareForRendering(o),!e.outlineIndexCount)continue;const n=e.outlineVAO;null!=n&&(o.bindVAO(n),S.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs),o.setStencilFunction(v.MT.EQUAL,b.stencilRef,255),o.drawElements(v.WR.TRIANGLES,e.outlineIndexCount,v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.outlineIndexStart),b.triangleCount+=e.outlineIndexCount/3)}}},vtlLine:class extends ee{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:n,state:s,drawPhase:r,painter:a,pixelRatio:o,spriteMosaic:l,styleLayerUID:h,requestRender:c,allowDelayedRender:u}=e;if(!t.some((e=>{var t,i;return null!==(t=null===(i=e.layerData.get(h))||void 0===i?void 0:i.lineIndexCount)&&void 0!==t&&t})))return;const d=e.styleLayer,_=d.lineMaterial,f=a.vectorTilesMaterialManager,p=d.getPaintValue("line-translate",n),m=d.getPaintValue("line-translate-anchor",n),g=d.getPaintProperty("line-pattern"),y=void 0!==g,x=y&&g.isDataDriven;let w,S;if(y&&!x){const e=g.getValue(n);w=l.getMosaicItemPosition(e)}let T=!1;if(!y){const e=d.getPaintProperty("line-dasharray");if(S=void 0!==e,T=S&&e.isDataDriven,S&&!T){const t=e.getValue(n),i=d.getDashKey(t,d.getLayoutValue("line-cap",n));w=l.getMosaicItemPosition(i)}}const b=1/o,I=r===$.S5.HITTEST,M=this._programOptions;M.id=I,M.pattern=y,M.sdf=S;const P=f.getMaterialProgram(i,_,M);if(u&&null!=c&&!P.compiled)return void c();if(i.useProgram(P),P.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),P.setUniformMatrix3fv("u_displayMat3",m===N.Cq.VIEWPORT?s.displayMat3:s.displayViewMat3),P.setUniform2fv("u_lineTranslation",p),P.setUniform1f("u_depth",d.z),P.setUniform1f("u_antialiasing",b),I){const e=(0,Q.Pl)(h+1);P.setUniform4fv("u_id",e)}if(w&&null!=w){const{page:e}=w,t=l.getPageSize(e);null!=t&&(l.bind(i,v.Cj.LINEAR,e,j.$U),P.setUniform2fv("u_mosaicSize",t),P.setUniform1i("u_texture",j.$U))}let R=-1;for(const E of t){if(!E.layerData.has(h))continue;E.key.level!==R&&(R=E.key.level,_.setDataUniforms(P,n,d,R,l));const e=2**(n-R)/o;P.setUniform1f("u_zoomFactor",e);const t=E.layerData.get(h);if(!t.lineIndexCount)continue;t.prepareForRendering(i);const s=t.vao;if(null!=s){if(i.bindVAO(s),P.setUniformMatrix3fv("u_dvsMat3",E.transforms.dvs),i.setStencilFunction(v.MT.EQUAL,E.stencilRef,255),x||T){const e=t.patternMap;if(!e)continue;for(const[t,n]of e){const e=l.getPageSize(t);null!=e&&(l.bind(i,v.Cj.LINEAR,t,j.$U),P.setUniform2fv("u_mosaicSize",e),P.setUniform1i("u_texture",j.$U),i.drawElements(v.WR.TRIANGLES,n[1],v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else i.drawElements(v.WR.TRIANGLES,t.lineIndexCount,v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.lineIndexStart);E.triangleCount+=t.lineIndexCount/3}}}},vtlCircle:class extends ee{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:n,requiredLevel:s,state:r,drawPhase:a,painter:o,spriteMosaic:l,styleLayerUID:h,requestRender:c,allowDelayedRender:u}=e;if(!t.some((e=>{var t,i;return null!==(t=null===(i=e.layerData.get(h))||void 0===i?void 0:i.circleIndexCount)&&void 0!==t&&t})))return;const d=e.styleLayer,_=d.circleMaterial,f=o.vectorTilesMaterialManager,p=d.getPaintValue("circle-translate",n),m=d.getPaintValue("circle-translate-anchor",n),g=a===$.S5.HITTEST,y=this._programOptions;y.id=g;const x=f.getMaterialProgram(i,_,y);if(u&&null!=c&&!x.compiled)return void c();i.useProgram(x),x.setUniformMatrix3fv("u_displayMat3",m===N.Cq.VIEWPORT?r.displayMat3:r.displayViewMat3),x.setUniform2fv("u_circleTranslation",p),x.setUniform1f("u_depth",d.z),x.setUniform1f("u_antialiasingWidth",1.2);let w=-1;if(g){const e=(0,Q.Pl)(h+1);x.setUniform4fv("u_id",e)}for(const S of t){if(!S.layerData.has(h))continue;S.key.level!==w&&(w=S.key.level,_.setDataUniforms(x,n,d,w,l));const e=S.layerData.get(h);if(!e.circleIndexCount)continue;e.prepareForRendering(i);const t=e.vao;null!=t&&(i.bindVAO(t),x.setUniformMatrix3fv("u_dvsMat3",S.transforms.dvs),s!==S.key.level?i.setStencilFunction(v.MT.EQUAL,S.stencilRef,255):i.setStencilFunction(v.MT.GREATER,255,255),i.drawElements(v.WR.TRIANGLES,e.circleIndexCount,v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),S.triangleCount+=e.circleIndexCount/3)}}},vtlSymbol:class extends ee{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,se.c)()}dispose(){}drawMany(e,t){const{drawPhase:i,styleLayerUID:n}=e,s=e.styleLayer;let r;i===$.S5.HITTEST&&(r=(0,Q.Pl)(n+1)),this._drawIcons(e,s,t,r),this._drawText(e,s,t,r)}_drawIcons(e,t,i,n){const{context:s,displayLevel:r,drawPhase:a,painter:o,spriteMosaic:l,state:h,styleLayerUID:c,requestRender:u,allowDelayedRender:d}=e,_=t.iconMaterial,f=o.vectorTilesMaterialManager;let p,m=!1;for(const P of i)if(P.layerData.has(c)&&(p=P.layerData.get(c),p.iconPerPageElementsMap.size>0)){m=!0;break}if(!m)return;const g=t.getPaintValue("icon-translate",r),y=t.getPaintValue("icon-translate-anchor",r);let v=t.getLayoutValue("icon-rotation-alignment",r);v===N.I5.AUTO&&(v=t.getLayoutValue("symbol-placement",r)===N.kt.POINT?N.I5.VIEWPORT:N.I5.MAP);const x=v===N.I5.MAP,w=t.getLayoutValue("icon-keep-upright",r)&&x,S=p.isIconSDF,T=a===$.S5.HITTEST,b=this._iconProgramOptions;b.id=T,b.sdf=S;const I=f.getMaterialProgram(s,_,b);if(d&&null!=u&&!I.compiled)return void u();s.useProgram(I),I.setUniformMatrix3fv("u_displayViewMat3",v===N.I5.MAP?h.displayViewMat3:h.displayMat3),I.setUniformMatrix3fv("u_displayMat3",y===N.Cq.VIEWPORT?h.displayMat3:h.displayViewMat3),I.setUniform2fv("u_iconTranslation",g),I.setUniform1f("u_depth",t.z),I.setUniform1f("u_mapRotation",(0,re.wV)(h.rotation)),I.setUniform1f("u_keepUpright",w?1:0),I.setUniform1f("u_level",10*r),I.setUniform1i("u_texture",j.$U),I.setUniform1f("u_fadeDuration",k.zk/1e3),T&&I.setUniform4fv("u_id",n);let M=-1;for(const P of i){if(!P.layerData.has(c))continue;if(P.key.level!==M&&(M=P.key.level,_.setDataUniforms(I,r,t,M,l)),p=P.layerData.get(c),0===p.iconPerPageElementsMap.size)continue;p.prepareForRendering(s),p.updateOpacityInfo();const i=p.iconVAO;if(null!=i){s.bindVAO(i),I.setUniformMatrix3fv("u_dvsMat3",P.transforms.dvs),I.setUniform1f("u_time",(performance.now()-p.lastOpacityUpdate)/1e3);for(const[t,i]of p.iconPerPageElementsMap)this._renderIconRange(e,I,i,t,P)}}}_renderIconRange(e,t,i,n,s){const{context:r,spriteMosaic:a}=e;this._spritesTextureSize[0]=a.getWidth(n)/4,this._spritesTextureSize[1]=a.getHeight(n)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),a.bind(r,v.Cj.LINEAR,n,j.$U),this._setStencilState(e,s),r.drawElements(v.WR.TRIANGLES,i[1],v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),s.triangleCount+=i[1]/3}_drawText(e,t,i,n){const{context:s,displayLevel:r,drawPhase:a,glyphMosaic:o,painter:l,pixelRatio:h,spriteMosaic:c,state:u,styleLayerUID:d,requestRender:_,allowDelayedRender:f}=e,p=t.textMaterial,m=l.vectorTilesMaterialManager;let g,y=!1;for(const k of i)if(k.layerData.has(d)&&(g=k.layerData.get(d),g.glyphPerPageElementsMap.size>0)){y=!0;break}if(!y)return;const v=t.getPaintProperty("text-opacity");if(v&&!v.isDataDriven&&0===v.getValue(r))return;const x=t.getPaintProperty("text-color"),w=!x||x.isDataDriven||x.getValue(r)[3]>0,S=t.getPaintProperty("text-halo-width"),T=t.getPaintProperty("text-halo-color"),b=(!S||S.isDataDriven||S.getValue(r)>0)&&(!T||T.isDataDriven||T.getValue(r)[3]>0);if(!w&&!b)return;let I=t.getLayoutValue("text-rotation-alignment",r);I===N.I5.AUTO&&(I=t.getLayoutValue("symbol-placement",r)===N.kt.POINT?N.I5.VIEWPORT:N.I5.MAP);const M=I===N.I5.MAP,P=t.getLayoutValue("text-keep-upright",r)&&M,R=a===$.S5.HITTEST,E=.8*3/h;this._glyphTextureSize||(this._glyphTextureSize=(0,se.f)(o.width/4,o.height/4));const L=t.getPaintValue("text-translate",r),C=t.getPaintValue("text-translate-anchor",r),A=this._sdfProgramOptions;A.id=R;const D=m.getMaterialProgram(s,p,A);if(f&&null!=_&&!D.compiled)return void _();s.useProgram(D),D.setUniformMatrix3fv("u_displayViewMat3",I===N.I5.MAP?u.displayViewMat3:u.displayMat3),D.setUniformMatrix3fv("u_displayMat3",C===N.Cq.VIEWPORT?u.displayMat3:u.displayViewMat3),D.setUniform2fv("u_textTranslation",L),D.setUniform1f("u_depth",t.z+152587890625e-16),D.setUniform2fv("u_mosaicSize",this._glyphTextureSize),D.setUniform1f("u_mapRotation",(0,re.wV)(u.rotation)),D.setUniform1f("u_keepUpright",P?1:0),D.setUniform1f("u_level",10*r),D.setUniform1i("u_texture",j.mg),D.setUniform1f("u_antialiasingWidth",E),D.setUniform1f("u_fadeDuration",k.zk/1e3),R&&D.setUniform4fv("u_id",n);let U=-1;for(const k of i){if(!k.layerData.has(d))continue;if(k.key.level!==U&&(U=k.key.level,p.setDataUniforms(D,r,t,U,c)),g=k.layerData.get(d),0===g.glyphPerPageElementsMap.size)continue;g.prepareForRendering(s),g.updateOpacityInfo();const i=g.textVAO;if(null==i)continue;s.bindVAO(i),D.setUniformMatrix3fv("u_dvsMat3",k.transforms.dvs),this._setStencilState(e,k);const n=(performance.now()-g.lastOpacityUpdate)/1e3;D.setUniform1f("u_time",n),g.glyphPerPageElementsMap.forEach(((e,t)=>{this._renderGlyphRange(s,e,t,o,D,b,w,k)}))}}_renderGlyphRange(e,t,i,n,s,r,a,o){n.bind(e,v.Cj.LINEAR,i,j.mg),r&&(s.setUniform1f("u_halo",1),e.drawElements(v.WR.TRIANGLES,t[1],v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),o.triangleCount+=t[1]/3),a&&(s.setUniform1f("u_halo",0),e.drawElements(v.WR.TRIANGLES,t[1],v.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),o.triangleCount+=t[1]/3)}_setStencilState(e,t){const{context:i,is3D:n,stencilSymbols:s}=e;if(i.setStencilTestEnabled(!0),s)return i.setStencilWriteMask(255),void i.setStencilFunction(v.MT.ALWAYS,t.stencilRef,255);i.setStencilWriteMask(0),n?i.setStencilFunction(v.MT.EQUAL,t.stencilRef,255):i.setStencilFunction(v.MT.GREATER,255,255)}}};var oe=i(8254);const le={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};const he=new class{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(t.has(e))return t.get(e);const i=this._read(e);if(!i)throw new Error("cannot find shader file ".concat(e));const n=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let s=n.exec(i);const r=[];for(;null!=s;)r.push({path:s[1],start:s.index,length:s[0].length}),s=n.exec(i);let a=0,o="";return r.forEach((e=>{o+=i.slice(a,e.start),o+=t.has(e.path)?"":this._resolve(e.path,t),a=e.start+e.length})),o+=i.slice(a),t.set(e,o),o}_read(e){return this._readFile(e)}}((function(e){let t=le;return e.split("/").forEach((e=>{t&&(t=t[e])})),t}));function ce(e){return he.resolveIncludes(e)}function ue(e){const{options:t,value:i}=e;return"number"==typeof t[i]}function de(e){let t="";for(const i in e){const n=e[i];if("boolean"==typeof n)n&&(t+="#define ".concat(i,"\n"));else if("number"==typeof n)t+="#define ".concat(i," ").concat(n.toFixed(),"\n");else if("object"==typeof n)if(ue(n)){const{value:e,options:s,namespace:r}=n,a=r?"".concat(r,"_"):"";for(const i in s)t+="#define ".concat(a).concat(i," ").concat(s[i].toFixed(),"\n");t+="#define ".concat(i," ").concat(a).concat(e,"\n")}else{const e=n.options;let s=0;for(const i in e)t+="#define ".concat(e[i]," ").concat((s++).toFixed(),"\n");t+="#define ".concat(i," ").concat(e[n.value],"\n")}}return t}const _e=e=>de({ID:e.id,PATTERN:e.pattern}),fe={shaders:e=>({vertexShader:_e(e)+ce("background/background.vert"),fragmentShader:_e(e)+ce("background/background.frag")})},pe=e=>de({ID:e.id}),me={shaders:e=>({vertexShader:pe(e)+ce("circle/circle.vert"),fragmentShader:pe(e)+ce("circle/circle.frag")})},ge=e=>de({ID:e.id,PATTERN:e.pattern}),ye={shaders:e=>({vertexShader:ge(e)+ce("fill/fill.vert"),fragmentShader:ge(e)+ce("fill/fill.frag")})},ve=e=>de({ID:e.id}),xe={shaders:e=>({vertexShader:ve(e)+ce("outline/outline.vert"),fragmentShader:ve(e)+ce("outline/outline.frag")})},we=e=>de({ID:e.id,SDF:e.sdf}),Se={shaders:e=>({vertexShader:we(e)+ce("icon/icon.vert"),fragmentShader:we(e)+ce("icon/icon.frag")})},Te=e=>de({ID:e.id,PATTERN:e.pattern,SDF:e.sdf}),be={shaders:e=>({vertexShader:Te(e)+ce("line/line.vert"),fragmentShader:Te(e)+ce("line/line.frag")})},Ie=e=>de({ID:e.id}),Me={shaders:e=>({vertexShader:Ie(e)+ce("text/text.vert"),fragmentShader:Ie(e)+ce("text/text.frag")})};class Pe{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach((e=>e.dispose())),this._programByKey.clear()}getMaterialProgram(e,t,i){const n=t.key<<3|this._getMaterialOptionsValue(t.type,i);if(this._programByKey.has(n))return this._programByKey.get(n);const s=this._getProgramTemplate(t.type),{shaders:r}=s,{vertexShader:a,fragmentShader:o}=r(i),l=t.getShaderHeader(),h=t.getShaderMain(),c=a.replace("#pragma header",l).replace("#pragma main",h),u=e.programCache.acquire(c,o,t.getAttributeLocations());return this._programByKey.set(n,u),u}_getMaterialOptionsValue(e,t){switch(e){case oe.kh.BACKGROUND:{const e=t;return(e.pattern?1:0)<<1|(e.id?1:0)}case oe.kh.FILL:{const e=t;return(e.pattern?1:0)<<1|(e.id?1:0)}case oe.kh.OUTLINE:return t.id?1:0;case oe.kh.LINE:{const e=t;return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1|(e.id?1:0)}case oe.kh.ICON:{const e=t;return(e.sdf?1:0)<<1|(e.id?1:0)}case oe.kh.CIRCLE:case oe.kh.TEXT:return t.id?1:0;default:return 0}}_getProgramTemplate(e){switch(e){case oe.kh.BACKGROUND:return fe;case oe.kh.CIRCLE:return me;case oe.kh.FILL:return ye;case oe.kh.ICON:return Se;case oe.kh.LINE:return be;case oe.kh.OUTLINE:return xe;case oe.kh.TEXT:return Me;default:return null}}}const Re=1e-6;class Ee{constructor(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache=new Map,this._vtlMaterialManager=new Pe}dispose(){this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache=null),this._vtlMaterialManager=(0,a.WD)(this._vtlMaterialManager),this.spriteMosaic.dispose(),this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawSymbols(e,t,i){const n=i.layers;e.renderPass="translucent";for(let s=0;s<n.length;s++){const i=n[s];if(i.type!==N.Dc.SYMBOL)continue;const r=i.getLayoutProperty("visibility");if(r&&r.getValue()===N.bv.NONE)continue;const a=e.displayLevel;void 0!==i.minzoom&&i.minzoom>a+Re||void 0!==i.maxzoom&&i.maxzoom<=a-Re||(e.styleLayerUID=i.uid,e.styleLayer=i,this._drawWithBrush(e,t,"vtlSymbol"))}}drawBackground(e,t,i){if(0===i.backgroundBucketIds.length)return;const{context:n,displayLevel:s,requiredLevel:r}=e;t.key.level=r,n.setBlendingEnabled(!0),n.setDepthTestEnabled(!1),n.setStencilTestEnabled(!1),e.renderPass="background",i.backgroundBucketIds.forEach((n=>{const r=i.getLayerById(n);if(r.type!==N.Dc.BACKGROUND)return;const a=r.getLayoutProperty("visibility");a&&a.getValue()===N.bv.NONE||void 0!==r.minzoom&&r.minzoom>s+Re||void 0!==r.maxzoom&&r.maxzoom<=s-Re||(e.styleLayerUID=r.uid,e.styleLayer=r,this._drawWithBrush(e,t,"vtlBackground"))}))}drawTile(e,t,i,n){const{context:s}=e,r=i.layers;s.setBlendingEnabled(!1),s.setDepthTestEnabled(!0),s.setDepthWriteEnabled(!0),s.setDepthFunction(v.MT.LEQUAL),e.renderPass="opaque";for(let a=r.length-1;a>=0;a--){const i=r[a];null!=n&&n!==i.type||this._renderStyleLayer(i,e,t,!1)}s.setDepthWriteEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunctionSeparate(v.dn.ONE,v.dn.ONE_MINUS_SRC_ALPHA,v.dn.ONE,v.dn.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(let a=0;a<r.length;a++){const i=r[a];null!=n&&n!==i.type||this._renderStyleLayer(i,e,t,!1)}s.setDepthTestEnabled(!1),s.bindVAO()}_renderStyleLayer(e,t,i,n){if(!(n||e&&i.layerData.has(e.uid)))return;const s=e.getLayoutProperty("visibility");if(s&&s.getValue()===N.bv.NONE)return;const{renderPass:r}=t;let a;switch(e.type){case N.Dc.BACKGROUND:if("background"!==r)return;a="vtlBackground";break;case N.Dc.FILL:if("opaque"!==r&&"translucent"!==t.renderPass)return;a="vtlFill";break;case N.Dc.LINE:if("translucent"!==r)return;a="vtlLine";break;case N.Dc.CIRCLE:if("translucent"!==r)return;a="vtlCircle";break;case N.Dc.SYMBOL:if("translucent"!==r)return;a="vtlSymbol"}const o=t.displayLevel;if(void 0!==e.minzoom&&e.minzoom>o+Re||void 0!==e.maxzoom&&e.maxzoom<=o-Re)return;const{context:l}=t;l.setStencilTestEnabled(!1),l.setStencilWriteMask(0),t.styleLayerUID=e.uid,t.styleLayer=e,this._drawWithBrush(t,i,a)}_drawWithBrush(e,t,i){if(!this._brushCache.has(i)){const e=ae[i];this._brushCache.set(i,new e)}this._brushCache.get(i).drawMany(e,[t])}}var Le=i(45995),Ce=i(83491),Ae=i(96453),De=i(4225),Ue=i(91196);let ke=class extends((0,Ae.E)((0,Ce.w)(Ue.A))){constructor(){super(...arguments),this._tileHandlerController=null,this.type="vector-tile-3d",this.levelShift=(0,r.A)("disable-feature:vtl-level-shift")?0:1}initialize(){if(null==this.layer.fullExtent)return void this.addResolvingPromise(Promise.reject(new s.A("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));const{basemapTerrain:e,spatialReference:t,state:i,viewingMode:n}=this.view,r="local"===n&&!(0,De.bA)(t)||De.t6.force512VTL,a=this.layer.tileInfo.spatialReference.isGeographic,h=r?this.layer.tileInfo:this.layer.tileInfo.getOrCreateCompatible(256,a?1:2),c=this._getTileInfoSupportError(h,this.layer.fullExtent);if(null!=c)return this.addResolvingPromise(Promise.reject(c));const d=(0,l.C_)((()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.basemapTerrain)||void 0===e?void 0:e.tilingSchemeLocked})).then((()=>{var t,i,n;const s=e.tilingScheme,r=s.pixelSize,a=256===r?1:2,o=null!==(t=e.spatialReference)&&void 0!==t&&t.isGeographic&&256===r?1:0,l=null!==(i=e.spatialReference)&&void 0!==i&&i.isGeographic||256!==r?0:1;let h;if(this.schemaHelper=new u(a,o,this.levelShift+l),256===r){const e=this.layer.tileInfo.spatialReference.isGeographic;h=this.layer.tileInfo.getOrCreateCompatible(256,e?1:2)}else h=null!==(n=this.view.spatialReference)&&void 0!==n&&n.isGeographic?this.layer.tileInfo.getOrCreateCompatible(512,.5):this.layer.tileInfo;const c=this._getTileInfoCompatibilityError(h,s);if(c)throw c;this.tileInfo=h}));this._tileHandlerController=new AbortController;const _=this.view.resourceController;this._memCache=_.memoryController.newCache("vtl-".concat(this.layer.uid),(e=>{e.release()})),this.addHandles((0,l.wB)((()=>this.view.qualitySettings.memoryLimit),(e=>this._memCache.maxSize=Math.ceil(e/10*1048576)),l.pc));const f=new Le.A(this.layer.currentStyleInfo.style);this._tileHandler=new Y(this.layer,f,i.contentPixelRatio,this._memCache);const p=this._tileHandlerController.signal,m=function(e){return t=>e.immediate.schedule(t)}(_),g=this._tileHandler.start({signal:p,schedule:m}),y=this._tileHandler.spriteMosaic;y.then((e=>{!(0,o.G4)(p)&&this._tileHandler&&(this.painter=new Ee(e,this._tileHandler.glyphMosaic))})),g.then((()=>this._tileHandlerController=null)),this._updatingHandles.add((()=>{var e;return{style:this.layer.currentStyleInfo.style,pixelRatio:null===(e=this.view.state)||void 0===e?void 0:e.contentPixelRatio}}),(e=>{let{style:t,pixelRatio:i}=e;this._tileHandlerController&&this._tileHandlerController.abort(),this._tileHandlerController=new AbortController,this._memCache.clear();const n=new Le.A(t),s=new Y(this.layer,n,i,this._memCache),r=s.start({signal:this._tileHandlerController.signal,schedule:m}),a=s.spriteMosaic;r.then((()=>this._tileHandlerController=null)),this._updatingHandles.addPromise(Promise.all([r,a]).then((e=>{let[,t]=e;const i=this._tileHandler,n=this.painter;this.painter=new Ee(t,s.glyphMosaic),this._tileHandler=s,this.emit("data-changed"),i.destroy(),n&&n.dispose()})))}));const v=Promise.all([d,g,y]);this.addResolvingPromise(v)}destroy(){this.painter=(0,a.WD)(this.painter),this._tileHandlerController=(0,a.DC)(this._tileHandlerController),this._tileHandler=(0,a.pR)(this._tileHandler),this._memCache=(0,a.pR)(this._memCache)}get contentZoom(){return(0,r.A)("disable-feature:vtl-level-shift")?1:this.view.qualitySettings.tiledSurface.vtlContentZoom}get displayLevelRange(){const e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,i=this.layer.maxScale||e[e.length-1].scale,n=this.levelRangeFromScaleRange(t,i);return this.layer.maxScale?n.maxLevel++:n.maxLevel+=this.levelShift,n}get dataScaleRange(){const e=this.tileInfo.lods;return{minScale:e[0].scale,maxScale:e[e.length-1].scale}}get dataLevelRange(){const{minScale:e,maxScale:t}=this.dataScaleRange,i=this.levelRangeFromScaleRange(e,t);return 1===i.minLevel&&256===this.tileInfo.size[0]&&(i.minLevel=0),i.maxLevel+=this.levelShift,i}async fetchTile(e,t,i,n){return this._tileHandler.getVectorTile(e,t,i,n)}};(0,n._)([(0,h.MZ)()],ke.prototype,"layer",void 0),(0,n._)([(0,h.MZ)()],ke.prototype,"levelShift",void 0),(0,n._)([(0,h.MZ)()],ke.prototype,"contentZoom",null),(0,n._)([(0,h.MZ)()],ke.prototype,"displayLevelRange",null),(0,n._)([(0,h.MZ)()],ke.prototype,"tileInfo",void 0),(0,n._)([(0,h.MZ)()],ke.prototype,"dataScaleRange",null),(0,n._)([(0,h.MZ)()],ke.prototype,"dataLevelRange",null),(0,n._)([(0,h.MZ)()],ke.prototype,"updatingProgressValue",void 0),ke=(0,n._)([(0,c.$)("esri.views.3d.layers.VectorTileLayerView3D")],ke);const Oe=ke},91196:(e,t,i)=>{i.d(t,{A:()=>f});var n=i(35143),s=i(91967),r=i(54099),a=i(5632),o=i(76460),l=i(30726),h=i(91291),c=i(46053),u=(i(40565),i(18690),i(81806),i(85842)),d=i(19451);let _=class extends((0,a.sA)((0,h.g)(r.A.EventedMixin(s.A)))){constructor(e){super(e),this._updatingHandles=new d.U,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t;const i=this.layer&&this.layer.id||"no id",n=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";o.A.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(i,"')"),e)}}))}destroy(){this._updatingHandles=(0,l.pR)(this._updatingHandles)}get fullOpacity(){var e,t,i,n;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(i=null===(n=this.parent)||void 0===n?void 0:n.fullOpacity)&&void 0!==i?i:1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}canResume(){var e,t,i;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(i=this.view)||void 0===i?void 0:i.ready)||!1}getSuspendInfo(){var e,t;const i=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};return null!==(t=this.view)&&void 0!==t&&t.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,n._)([(0,c.MZ)()],_.prototype,"fullOpacity",null),(0,n._)([(0,c.MZ)()],_.prototype,"layer",void 0),(0,n._)([(0,c.MZ)()],_.prototype,"parent",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],_.prototype,"suspended",null),(0,n._)([(0,c.MZ)({readOnly:!0})],_.prototype,"suspendInfo",null),(0,n._)([(0,c.MZ)({readOnly:!0})],_.prototype,"legendEnabled",null),(0,n._)([(0,c.MZ)({type:Boolean,readOnly:!0})],_.prototype,"updating",null),(0,n._)([(0,c.MZ)({readOnly:!0})],_.prototype,"updatingProgress",null),(0,n._)([(0,c.MZ)()],_.prototype,"visible",null),(0,n._)([(0,c.MZ)()],_.prototype,"view",void 0),_=(0,n._)([(0,u.$)("esri.views.layers.LayerView")],_);const f=_}}]);
//# sourceMappingURL=474.2063e213.chunk.js.map