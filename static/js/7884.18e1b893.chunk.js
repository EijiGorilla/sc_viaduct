"use strict";(self.webpackChunksc_viaduct=self.webpackChunksc_viaduct||[]).push([[7884],{56567:(e,t,i)=>{i.d(t,{A:()=>f});var n=i(35143),r=(i(35238),i(23458)),s=i(69098),o=i(73582),a=i(42553),l=i(46053),c=i(21403),d=(i(18690),i(81806),i(85842)),u=i(40565),h=i(13904);let p=class extends((0,a.Te)(s.P)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=r.L.Direct,this.offset=0,this.orientation=0}};(0,n._)([(0,l.MZ)({type:["length"],json:{write:{isRequired:!0}}})],p.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:h.A,json:{write:!0}})],p.prototype,"startPoint",void 0),(0,n._)([(0,l.MZ)({type:h.A,json:{write:!0}})],p.prototype,"endPoint",void 0),(0,n._)([(0,l.MZ)({type:r.h,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"measureType",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"offset",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.w)((e=>o.ie.normalize((0,u.GB)(e),0,!0)))],p.prototype,"orientation",void 0),p=(0,n._)([(0,d.$)("esri.analysis.LengthDimension")],p);const f=p},23458:(e,t,i)=>{var n;i.d(t,{L:()=>n,h:()=>r}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(n||(n={}));const r=[n.Horizontal,n.Vertical,n.Direct]},9854:(e,t,i)=>{function n(){return new Float32Array(4)}function r(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,i,n){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function o(){return n()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function d(){return s(0,0,1,0)}function u(){return s(0,0,0,1)}i.d(t,{c:()=>r,f:()=>s});const h=o(),p=a(),f=l(),_=c(),m=d(),g=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:g,UNIT_X:f,UNIT_Y:_,UNIT_Z:m,ZEROS:h,clone:r,create:n,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:u,unitX:l,unitY:c,unitZ:d,zeros:o},Symbol.toStringTag,{value:"Module"}))},56002:(e,t,i)=>{function n(e){let t,i,n=[],r=!1;return function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(o,n)||(i=e.apply(this,o),t=this,n=o,r=!0),i}}i.d(t,{B:()=>n})},46530:(e,t,i)=>{function n(e){var t;const i=e.layer;return"floorInfo"in i&&null!==(t=i.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?s(e.view.floors,i.floorInfo.floorField):null}function r(e,t){var i;return"floorInfo"in t&&null!==(i=t.floorInfo)&&void 0!==i&&i.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(null===e||void 0===e||!e.length)return null;const i=e.filter((e=>""!==e)).map((e=>"'".concat(e,"'")));return i.push("''"),"".concat(t," IN (").concat(i.join(","),") OR ").concat(t," IS NULL")}i.d(t,{E:()=>n,f:()=>r})},7884:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ar});var n,r=i(35143),s=i(91967),o=i(54901),a=i(76460),l=i(30726),c=i(68134),d=i(46053),u=(i(40565),i(18690),i(81806),i(85842)),h=i(2522),p=i(23458),f=i(31633),_=i(19747),m=i(15941),g=i(24648),v=i(95941),y=i(23209),S=i(45136),w=i(83670),M=i(5568),b=i(75762),P=i(18117),x=i(32535),O=i(25191),R=i(14487),T=i(80963),E=i(41868);function C(e,t,i){const r=D(e,t,i,n.Direct);return null!=r?(0,g.d_)(r.direct,r.unit):null}function D(e,t,i,r){const s=(0,E.l)(i),o=(0,f._H)(s);if(null==o)return null;const a=t[2]-e[2];if(r===n.Vertical)return{verticalSigned:a,unit:o};if(!(0,R.F)(e,i,z,s)||!(0,R.F)(t,i,H,s))return null;if(r===n.Direct)return{direct:(0,S.o)(H,z),unit:o};if((0,S.s)(V,e[0],e[1],t[2]),!(0,R.F)(V,i,V,s))return null;const l=(0,S.o)(V,H);return r===n.Horizontal?{horizontal:l,unit:o}:{direct:(0,S.o)(H,z),horizontal:l,vertical:Math.abs(a),unit:o}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(n||(n={}));const A=(0,w.c)(),L=(0,w.c)(),z=(0,w.c)(),H=(0,w.c)(),V=(0,w.c)();function Z(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:r,orientation:s}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,offset:n,measureType:r,orientation:s}}function G(e,t){let{elevationAlignedStartPoint:i,elevationAlignedEndPoint:n,offset:r,measureType:s,orientation:o}=e,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==i||null==n)return null;const l=I(null!=a?a.directSegment:new O.C,{elevationAlignedStartPoint:i,elevationAlignedEndPoint:n},t),c=null!=a?a.primaryOffsetAxis:(0,w.c)();U(c,{measureType:s,elevationAlignedStartPoint:i,elevationAlignedEndPoint:n,directSegment:l,orientation:o,renderCoordsHelper:t});const d=null!=a?a.dimensionSegment:new O.C;return $({elevationAlignedStartPoint:i,elevationAlignedEndPoint:n})&&s===p.L.Vertical?((0,S.c)(d.startRenderSpace,l.startRenderSpace),(0,S.c)(d.endRenderSpace,l.endRenderSpace)):W(d,{offsetAxis:c,offset:r,relativeToSegment:l,renderCoordsHelper:t}),{directSegment:l,dimensionSegment:d,primaryOffsetAxis:c,spatialReference:t.spatialReference}}function j(e,t,i,n){return t===F.Start?((0,S.c)(e.startRenderSpace,i.startRenderSpace),(0,S.c)(e.endRenderSpace,n.startRenderSpace)):((0,S.c)(e.startRenderSpace,i.endRenderSpace),(0,S.c)(e.endRenderSpace,n.endRenderSpace)),e}var F;function q(e,t,i,n){switch(t){case p.L.Direct:return I(e,i,n);case p.L.Horizontal:case p.L.Vertical:{const{elevationAlignedStartPoint:r,elevationAlignedEndPoint:s,dimension:o,geometry:a}=i;let l;o.measureType===p.L.Direct?(l=function(e,t){const i=e.directSegment.eval(.5,b.rq.get()),n=t.worldUpAtPosition(i,b.rq.get()),r=e.dimensionSegment.eval(.5,b.rq.get()),s=(0,S.u)(b.rq.get(),r,i);return!(0,S.G)(s,w.Z)&&(0,S.j)(s,n)>0}(a,n)===r.z>s.z,t===p.L.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:i}=e.dimensionSegment,{startRenderSpace:n,endRenderSpace:r}=e.directSegment;return(0,S.y)(n,t)<(0,S.y)(r,i)}(a);const[c,d]=l?[r,s]:[s,r],u=(0,x.EL)(d,N);return t===p.L.Horizontal?u.z=c.z:(u.x=c.x,u.y=c.y),n.toRenderCoords(c,e.startRenderSpace),n.toRenderCoords(u,e.endRenderSpace),e}}}function I(e,t,i){return i.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),i.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(F||(F={}));const N=(0,P.T)(0,0,0,null);const k=new O.C;function U(e,t){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:r,directSegment:{startRenderSpace:s,endRenderSpace:o},directSegment:a,renderCoordsHelper:l}=t,c=a.eval(.5,b.rq.get()),d=l.worldUpAtPosition(c,b.rq.get()),u=l.worldBasisAtPosition(c,M._.Y,b.rq.get());switch(i){case p.L.Horizontal:(0,S.c)(e,d);break;case p.L.Vertical:(0,S.j)(s,d)<(0,S.j)(o,d)?(0,S.u)(e,o,s):(0,S.u)(e,s,o),(0,S.b)(e,e,d),(0,S.b)(e,e,d);break;case p.L.Direct:{var h;const i=null!==(h=t.orientation)&&void 0!==h?h:0;if($({elevationAlignedStartPoint:n,elevationAlignedEndPoint:r}))(0,v.c)(B,-(0,m.kU)(i),d),(0,S.e)(e,u,B);else{const t=(0,S.u)(b.rq.get(),o,s),n=(0,S.b)(b.rq.get(),t,d);(0,S.b)(n,n,t),(0,v.c)(B,(0,m.kU)(i),t),(0,S.e)(e,n,B)}break}}return(0,S.G)(e,w.Z)?(0,S.c)(e,u):(0,S.n)(e,e)}const B=(0,y.a)();function $(e){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i}=e;return null!=t&&null!=i&&t.x===i.x&&t.y===i.y}function W(e,t){const{offsetAxis:i,offset:n,relativeToSegment:{startRenderSpace:r,endRenderSpace:s},relativeToSegment:o,renderCoordsHelper:a}=t,l=n/a.unitInMeters,[c,d]=function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=(0,S.j)(t,i),s=(0,S.j)(e,i),o=Math.abs(r-s)+n;return r>s?[o,n]:[n,o]}(r,s,i,l);return(0,S.q)(e.startRenderSpace,o.startRenderSpace,i,c),(0,S.q)(e.endRenderSpace,o.endRenderSpace,i,d),e}function X(e,t,i){const n=t.directSegment.eval(.5,b.rq.get());return i.worldUpAtPosition(n,e)}function Y(e,t){const{startRenderSpace:i,endRenderSpace:n}=t.directSegment;return(0,S.u)(e,n,i)}function Q(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:n,endRenderSpace:r}=t.dimensionSegment;return i.invert?(0,S.u)(e,n,r):(0,S.u)(e,r,n)}function J(e,t){const i=e.directSegment.eval(.5,b.rq.get());return t.headingAtPosition(i,e.primaryOffsetAxis)}const K=(0,w.c)();function ee(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i}=e;if(null==t||null==i)return!1;const n=function(e,t){const{spatialReference:i}=e;return(0,T.aI)(i,t.spatialReference)?(A[0]=e.x,A[1]=e.y,A[2]=e.hasZ?e.z:0,L[0]=t.x,L[1]=t.y,L[2]=t.hasZ?t.z:0,C(A,L,i)):null}(t,i);return null!=n&&(0,g.kM)(n,"meters").value>te}const te=1e5;function ie(e){return null!=e.geometry}let ne=class extends s.A{constructor(e){super(e)}initialize(){const e=(0,c.LF)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._watchComputation(t)}));this.addHandles((0,o.DQ)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,_.c)(this.view)}_watchComputation(e){return(0,c.wB)((()=>Z(e)),(t=>{const{measureType:i}=t;if(ee(t)&&i!==p.L.Direct){const t=Math.round((0,f.oU)(te,"meters","kilometers"));return a.A.getLogger(this).warnOnce("A ".concat(i," dimension in the analysis (id: '").concat(this.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(t,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}const n=G(t,this.view.renderCoordsHelper,e.geometry);e.geometry=n,e.result.length=function(e,t,i){if(null==e)return null;const n=C(e.dimensionSegment.startRenderSpace,e.dimensionSegment.endRenderSpace,e.spatialReference);if(null==n)return null;const r=t===p.L.Vertical?(0,f.jE)(n.value,n.unit,i):(0,f.Vs)(n.value,n.unit,i);return(0,g.kM)(n,r)}(n,i,this._defaultUnit)}),c.pc)}};(0,r._)([(0,d.MZ)({constructOnly:!0})],ne.prototype,"analysisViewData",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],ne.prototype,"view",void 0),(0,r._)([(0,d.MZ)()],ne.prototype,"analysis",null),(0,r._)([(0,d.MZ)()],ne.prototype,"_defaultUnit",null),ne=(0,r._)([(0,u.$)("esri.views.3d.analysis.Dimension.support.DimensionController")],ne);var re=i(50176),se=i(69539),oe=(i(35238),i(73582)),ae=i(76931),le=i(83529),ce=i(13927),de=i(59784);function ue(e){return(0,de._L)(e.accentColor,.5)}function he(e){return(0,de.bJ)(e.accentColor)}const pe=new se.A([127,127,127,.5]),fe=6,_e=5;var me=i(56121),ge=i(38317),ve=i(91175),ye=i(7947),Se=i(99443),we=i(50468),Me=i(51799),be=i(62577),Pe=i(45463),xe=i(66470),Oe=i(77447),Re=i(425),Te=i(70825),Ee=i(76336),Ce=i(13904);class De{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of p.h)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case p.L.Direct:return this.direct;case p.L.Horizontal:return this.horizontal;case p.L.Vertical:return this.vertical}}}class Ae extends me.q{constructor(e,t){const i=(0,ge.UM)(se.A.toUnitRGBA(ue(e.effectiveTheme))),n=[new ve.M((0,be.CM)(i,1,32,32),Xe)];super({view:e,renderObjects:n,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,c.wB)((()=>({color:se.A.toUnitRGBA(ue(e.effectiveTheme))})),(e=>i.setParameters(e)))}destroy(){this._themeHandle.remove(),super.destroy()}}class Le extends me.q{constructor(e,t){let{lineSizePt:i,material:n,metadata:r}=t;super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:r}),this._options={calloutColor:(0,le.c)(),lineSizePt:i,material:n},this._themeHandle=(0,c.wB)((()=>se.A.toUnitRGBA(ue(e.effectiveTheme))),(e=>{this._options.calloutColor=e,We(this,ze({...this._options,metadata:this.metadata}))}),c.Vh)}update(e){let{lineSizePt:t,material:i}=e;this._options.lineSizePt=t,this._options.material=i,We(this,ze({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function ze(e){let{calloutColor:t,lineSizePt:i,material:n,metadata:r}=e;return{calloutLength:.25*Se.PV*.8*(0,ae.Lz)(i)+18,calloutColor:t,calloutWidth:2,customStateMask:Xe,discScale:.3,focusMultiplier:2,material:n,metadata:r}}function He(e,t){let{computation:i,view:n}=t;return[(0,Te.Xt)(e,((e,t,r)=>{Ve({cancel:r,computation:i,settingHeading:!1,steps:t,view:n})})),e.events.on("immediate-click",(e=>{!function(e,t,i){const{dimension:n,geometry:r}=t;if(90===n.orientation||270===n.orientation)return n.orientation=0,void e.stopPropagation();if(null==r)return;const{renderCoordsHelper:s}=i,o=G({...Z(t),orientation:90},s),a=G({...Z(t),orientation:270},s);if(null==o||null==a)return;const l=J(o,s),c=J(a,s),d=je(r,i),u=oe.ie.shortestSignedDiff(d,l),h=oe.ie.shortestSignedDiff(d,c);n.orientation=Math.abs(u)<Math.abs(h)?90:270,e.stopPropagation()}(e,i,n)}))]}function Ve(e){var t,i;const{cancel:n,computation:r,settingHeading:s,steps:o,view:a}=e;if(!ie(r))return;const{renderCoordsHelper:l}=a,{dimension:c,geometry:d}=r,u=(0,w.c)(),h=Ne((0,w.c)(),d,d.directSegment,l),p=ke(b.rq.get(),{forHeading:s,geometry:d,renderCoordsHelper:l}),f=(0,ce.O_)(h,p,(0,ce.vt)()),_=s?null!==(t=c.orientation)&&void 0!==t?t:J(d,a.renderCoordsHelper):null!==(i=c.orientation)&&void 0!==i?i:0;o.next((0,ye.AA)(a,f)).next((e=>{"start"===e.action&&(0,S.c)(u,e.renderStart);const t=(0,ce.qb)(f),i=(0,ge.FY)(u,e.renderEnd,h,t);let n=_-(0,m.KJ)(i);s||(n=function(e){const t=oe.ie.normalize(e)%90;return t<_e?e-t:90-t<_e?e+(90-t):e}(n)),c.orientation=n})),n.next((0,Te.VG)(c,["orientation"]))}function Ze(e,t){let{computation:i,manipulatorMeasureType:n,view:r}=t,s=p.L.Direct,o=0,a=0;return[e.events.on("grab-changed",(t=>{if("start"!==t.action||!ie(i))return;const{dimension:l,geometry:c}=i;s=l.measureType,o=l.offset,a=l.orientation;const d=(0,S.c)(b.rq.get(),e.renderLocation);l.measureType=n,l.offset=function(e,t,i,n){const{directSegment:r}=i,s=U(b.rq.get(),{measureType:t,directSegment:r,renderCoordsHelper:n}),o=W(k,{offsetAxis:s,offset:0,relativeToSegment:r,renderCoordsHelper:n}).eval(.5,b.rq.get()),a=(0,S.u)(b.rq.get(),e,o);return(0,S.j)(a,s)*n.unitInMeters}(d,n,c,r.renderCoordsHelper),l.orientation=0})),(0,Te.Xt)(e,((e,t,l)=>{if(!ie(i))return;const{geometry:c,dimension:d}=i,{renderCoordsHelper:u}=r,h=q(Ke,n,i,u),p=U(b.rq.get(),{measureType:n,directSegment:c.directSegment,renderCoordsHelper:u}),f=(0,ye.z7)(e);t.next(f).next(Ge(r,d,h,p)),l.next(f).next((e=>(d.measureType=s,d.offset=o,d.orientation=a,e)))}))]}function Ge(e,t,i,n){const r=(0,S.f)(b.rq.get(),i.endRenderSpace,i.startRenderSpace);(0,S.b)(r,r,n);const s=(0,ce.O_)(i.startRenderSpace,r,(0,ce.vt)()),o=(0,ce.O_)(i.startRenderSpace,n,(0,ce.vt)()),a=t.offset;let l,c=0;const d=new Te.rh;return d.next((0,ye.AA)(e,s)).next((i=>{"start"===i.action&&(c=(0,ce.mN)(o,i.renderStart));const n=((0,ce.mN)(o,i.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=a+n,l=i})),e=>(d.execute(e),l)}function je(e,t){const{directSegment:i}=e,{renderCoordsHelper:n}=t,r=X(b.rq.get(),e,n),s=Y(b.rq.get(),e),o=(0,S.b)(b.rq.get(),s,r),{viewForward:a}=t.state.camera;(0,S.j)(o,a)>0&&(0,S.i)(o,o,-1);const l=i.eval(.5,b.rq.get());return n.headingAtPosition(l,o)}function Fe(e,t,i,n){let{forHeading:r}=n;const{dimension:s,geometry:o}=t,{primaryOffsetAxis:a}=o,l=(0,S.i)(qe,a,s.offset>=0?1:-1),c=ke(Ie,{forHeading:r,geometry:o,renderCoordsHelper:i});(0,S.b)(c,c,l);const d=(0,ge.wQ)(l,c,w.Z,Je);e.modelTransform=d,e.renderLocation=Ne(Ye,o,o.dimensionSegment,i)}const qe=(0,w.c)(),Ie=(0,w.c)();function Ne(e,t,i,n){const{startRenderSpace:r,endRenderSpace:s}=i,o=function(e,t){const i=Y(Ue,e),n=X(Be,e,t);return(0,S.j)(i,n)>0}(t,n)?r:s;return(0,S.c)(e,o)}function ke(e,t){let{forHeading:i,geometry:n,renderCoordsHelper:r}=t;return i?X(e,n,r):Q(e,n,{invert:!0})}const Ue=(0,w.c)(),Be=(0,w.c)();function $e(e){return(0,ae.Lz)(e)+fe}function We(e,t){var i,n,r,s,o,a,l;const c=null!==(i=t.material)&&void 0!==i?i:new Oe.r({transparent:!0,writeDepth:!1,textureId:null===(n=t.texture)||void 0===n?void 0:n.id,renderOccluded:Pe.m$.Opaque,isDecoration:!0}),d=null!==(r=t.focusMultiplier)&&void 0!==r?r:ge.eO.focusMultiplier,u=null!==(s=t.calloutLength)&&void 0!==s?s:ge.eO.calloutLength,h=ge.eO.discRadius*(null!==(o=t.discScale)&&void 0!==o?o:1),p=h*d,f=(e,t)=>{const i=[0,1,2,2,3,0];return new Me.V(t,[[xe.r.POSITION,new we.n([u-e,-e,0,u+e,-e,0,u+e,e,0,u-e,e,0],i,3,!0)],[xe.r.UV0,new we.n([0,0,1,0,1,1,0,1],i,2,!0)]])},_=null!==(a=t.calloutWidth)&&void 0!==a?a:ge.eO.calloutWidth,m=new Re.W({width:_,color:t.calloutColor,renderOccluded:Pe.m$.OccludeAndTransparent,isDecoration:!0}),g=(0,be.Z8)(m,[[0,0,0],[u-h,0,0]]),v=(0,be.Z8)(m,[[0,0,0],[u-p,0,0]]),y=null!==(l=t.customStateMask)&&void 0!==l?l:Ee.SJ.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[u,0,0]},e.focusMultiplier=d,e.metadata=t.metadata,e.radius=h,e.renderObjects=[new ve.M(f(h,c),Ee.p7.Unfocused|y),new ve.M(g,Ee.p7.Unfocused|y),new ve.M(f(p,c),Ee.p7.Focused|y),new ve.M(v,Ee.p7.Focused|y)]}const Xe=Ee.SJ.Custom1,Ye=(0,w.c)(),Qe=(0,w.c)(),Je=(0,y.a)(),Ke=new O.C;var et,tt=i(56567),it=i(88321),nt=i(53084),rt=i(56002),st=i(50346),ot=i(19451);function at(e,t,i){const{constraint:n,elevationAlignedStartPoint:r,elevationAlignedEndPoint:s,unconstrainedGeometry:o,view:a}=i,{dimension:l,previousConstraint:c,preConstraintProperties:d}=e;if(null==r||null==s)return;const u=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==n)u(),null!=c&&null!=d&&(l.measureType=d.measureType,l.orientation=d.orientation);else switch(l.measureType=p.L.Direct,n){case et.Horizontal:if(n!==c&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=s.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=r.z),l.endPoint=e}break;case et.Vertical:if(n!==c&&(l.orientation=je(o,a)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=s.x,e.y=s.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=r.x,e.y=r.y),l.endPoint=e}break;case et.Direct:n!==c&&null!=d&&(l.orientation=d.orientation),u()}e.previousConstraint=n,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(et||(et={}));var lt=i(59962),ct=i(12482),dt=i(11461),ut=i(9854),ht=i(49595),pt=i(4763),ft=i(44230),_t=i(95925),mt=i(85746),gt=i(99469),vt=i(33169),yt=i(442);class St extends mt.X{constructor(e){super(e),this._ray=(0,_t.vt)(),this._isWorldDown=!1,this._start=(0,w.c)(),this._end=(0,w.f)(1,0,0),this._width=1,this._color=(0,ut.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,ut.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=xt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Pe.m$.OccludeAndTransparent,this._fadedExtensions=Rt,this._laserline=new gt.o({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,S.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,S.f)(this._end,e,this._end),(0,_t.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,S.h)(this._start,e)||((0,S.c)(this._start,e),(0,_t.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,S.h)(this._end,e)||((0,S.c)(this._end,e),(0,_t.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,dt.h)(e,this._color)||((0,dt.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,dt.h)(e,this._innerColor)||((0,dt.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,dt.h)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,ut.c)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Pe.m$.OccludeAndTransparentStencil?Pe.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:Rt,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new Re.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const n=this._createGeometry(e);i.push(n),t.addGeometry(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Re.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new yt.$(t)}_createGeometry(e){const t=this.extensionType===xt.FADED,i=t?[(0,w.c)(),(0,w.c)(),(0,w.c)(),(0,w.c)()]:[(0,w.c)(),(0,w.c)()];return(0,be.Z8)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===xt.FADED?this._updateLineSegmentFinite(Pt):this._updateLineSegmentInfinite(this._extensionType,Pt)}_updateLineSegmentFinite(e){return(0,ft.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,ht.$e)(this._ray,wt),e){case xt.LINE:wt.c0=-Number.MAX_VALUE;break;case xt.RAY:case xt.GROUND_RAY:{var n;const e=this._ray.origin,t=null!==(n=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==n?n:0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,S.E)(wt.ray.direction,wt.ray.direction),this._extensionType===xt.GROUND_RAY&&null!=t&&(wt.c1=Math.abs(i-t));break}}if(!(0,pt.ig)(i.frustum,wt))return this._updateLineSegmentFinite(t);const r=(0,ht.j1)(wt,Mt),s=(0,ht.mO)(wt,bt);return(0,ft.Cr)(r,s,t)}_updateVertexAttributesObject3D(e,t){var i;const n=null===(i=e.geometries[0].getMutableAttribute(xe.r.POSITION))||void 0===i?void 0:i.data;if(!n)return;let r=0;for(const s of this._lineVertices(t))n[r++]=s[0],n[r++]=s[1],n[r++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],xe.r.POSITION)}_updateVertexAttributesDraped(e,t){var i;const n=null===(i=e.getMutableAttribute(xe.r.POSITION))||void 0===i?void 0:i.data;if(!n)return;let r=0;for(const s of this._lineVertices(t))n[r++]=s[0],n[r++]=s[1],n[r++]=vt.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===xt.FADED?(yield(0,ft.sd)(e,-this.fadedExtensions.start,Mt),yield(0,ft.sd)(e,0,Mt),yield(0,ft.sd)(e,1,Mt),yield(0,ft.sd)(e,1+this.fadedExtensions.end,Mt)):(yield(0,ft.sd)(e,0,Mt),yield(0,ft.sd)(e,1,Mt))}}const wt=(0,ht.vt)(),Mt=(0,w.c)(),bt=(0,w.c)(),Pt=(0,ft.vt)();var xt;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(xt||(xt={}));const Ot=1/3,Rt={start:Ot,end:Ot};var Tt=i(52007),Et=i(9711);class Ct extends mt.X{constructor(e){super(e),this._location=(0,w.c)(),this._direction=(0,w.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,ut.f)(1,0,1,1),this._renderOccluded=Pe.m$.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,S.h)(this._location,e)||((0,S.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,S.h)(this._direction,e)||((0,S.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,S.n)(this._direction,(0,S.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,dt.h)(e,this._color)||((0,dt.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new Re.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[n,r]=this._createGeometries(e);t.addGeometry(n),t.addGeometry(r),i.push(n),i.push(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Re.W(this.materialParameters),t=(0,c.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new yt.$(e)))}_createGeometries(e){return[(0,be.Z8)(e,[(0,w.c)(),(0,w.c)()]),(0,be.Z8)(e,[(0,w.c)(),(0,w.c)()])]}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,Ht),(0,S.g)(Dt,this.location,this.direction),t.projectToScreen(Dt,Vt),(0,Tt.e)(Vt,(0,Tt.c)(Vt,Vt,Ht)),this._updateVertexAttributesObject3D(t,e,0,Ht,Vt,1),this._updateVertexAttributesObject3D(t,e,1,Ht,Vt,-1)}_updateVertexAttributesObject3D(e,t,i,n,r,s){var o;const a=t.geometries[i],l=null===(o=a.getMutableAttribute(xe.r.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:d}=this._computeStartEnd(r,n,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,ae.PR)(c),Dt),l[0]=Dt[0],l[1]=Dt[1],l[2]=Dt[2],e.unprojectFromScreen((0,ae.PR)(d),Dt),l[3]=Dt[0],l[4]=Dt[1],l[5]=Dt[2],t.geometryVertexAttributeUpdated(a,xe.r.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:n,width:r,length:s,offset:o}=this,a=Zt;a.spatialReference=t.renderer.spatialReference,a.x=n[0],a.y=n[1];const l=this.view.overlayPixelSizeInMapUnits(a)*i,c=r*l,d=s*l,u=o*l;this._updateVertexAttributesDraped(e[0],c,d,u,-1),this._updateVertexAttributesDraped(e[1],c,d,u,1)}_updateVertexAttributesDraped(e,t,i,n,r){var s;const o=null===(s=e.getMutableAttribute(xe.r.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:c,end:d}=this._computeStartEnd(l,a,r,n,t,i);o[0]=c[0],o[1]=c[1],o[2]=vt.bi,o[3]=d[0],o[4]=d[1],o[5]=vt.bi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,n,r,s){const o=(0,Tt.a)(At,(0,Tt.s)(At,e[1]*i,e[0]*-i),n+r/2),a=(0,Tt.i)(Lt,(0,Tt.i)(Lt,(0,Tt.i)(Lt,t,(0,Tt.a)(Lt,e,s/2)),o),o);return{start:a,end:(0,Tt.i)(zt,a,(0,Tt.a)(zt,e,-s))}}}const Dt=(0,w.c)(),At=(0,Et.a)(),Lt=(0,Et.a)(),zt=(0,Et.a)(),Ht=(0,ae.gs)(),Vt=(0,ae.gs)(),Zt=(0,P.T)(0,0,void 0,null);var Gt=i(83574),jt=i(47996),Ft=i(57662),qt=i(23862),It=i(42553);let Nt=class extends It.oY{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,d.MZ)({type:Boolean})],Nt.prototype,"enabled",void 0),Nt=(0,r._)([(0,u.$)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Nt);let kt=class extends It.oY{constructor(e){super(e),this.lineSnapper=new Nt,this.parallelLineSnapper=new Nt,this.rightAngleSnapper=new Nt,this.rightAngleTriangleSnapper=new Nt,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThreshold=.1,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new se.A([255,127,0]),this.orangeTransparent=new se.A([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,r._)([(0,d.MZ)({type:Nt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],kt.prototype,"lineSnapper",void 0),(0,r._)([(0,d.MZ)({type:Nt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],kt.prototype,"parallelLineSnapper",void 0),(0,r._)([(0,d.MZ)({type:Nt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],kt.prototype,"rightAngleSnapper",void 0),(0,r._)([(0,d.MZ)({type:Nt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],kt.prototype,"rightAngleTriangleSnapper",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],kt.prototype,"shortLineThreshold",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],kt.prototype,"distance",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],kt.prototype,"pointThreshold",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],kt.prototype,"intersectionParallelLineThreshold",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],kt.prototype,"parallelLineThreshold",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],kt.prototype,"verticalLineThreshold",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],kt.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],kt.prototype,"pointOnLineThreshold",void 0),(0,r._)([(0,d.MZ)({type:se.A,nonNullable:!0})],kt.prototype,"orange",void 0),(0,r._)([(0,d.MZ)({type:se.A,nonNullable:!0})],kt.prototype,"orangeTransparent",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],kt.prototype,"lineHintWidthReference",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],kt.prototype,"lineHintWidthTarget",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],kt.prototype,"lineHintFadedExtensions",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],kt.prototype,"parallelLineHintWidth",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],kt.prototype,"parallelLineHintLength",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],kt.prototype,"parallelLineHintOffset",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],kt.prototype,"rightAngleHintSize",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],kt.prototype,"rightAngleHintOutlineSize",void 0),(0,r._)([(0,d.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],kt.prototype,"satisfiesConstraintScreenThreshold",void 0),kt=(0,r._)([(0,u.$)("esri.views.interactive.snapping.Settings.Defaults")],kt);const Ut=new kt;var Bt=i(99791),$t=i(70330),Wt=i(64753);class Xt extends Wt.m{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bt.n.ALL),this.intersectionPoint=e}equals(e){return e instanceof Xt&&(0,S.h)(this.intersectionPoint,e.intersectionPoint)}}var Yt=i(23543);class Qt extends Wt.m{constructor(e,t,i){super(i,arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bt.n.ALL),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof Qt&&(0,S.h)(this.lineStart,e.lineStart)&&(0,S.h)(this.lineEnd,e.lineEnd)}}var Jt=i(23241);class Kt extends Wt.m{constructor(e,t,i,n){super(n,arguments.length>4&&void 0!==arguments[4]?arguments[4]:Bt.n.ALL),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof Kt&&(0,S.h)(this.previousVertex,e.previousVertex)&&(0,S.h)(this.centerVertex,e.centerVertex)&&(0,S.h)(this.nextVertex,e.nextVertex)}}class ei{draw(e,t){const i=this._getUniqueHints(e),n=this.sortUniqueHints(i),r=[];for(const s of n)s instanceof Xt&&r.push(this.visualizeIntersectionPoint(s,t)),s instanceof Yt.c&&r.push(this.visualizeLine(s,t)),s instanceof Qt&&r.push(this.visualizeParallelSign(s,t)),s instanceof Kt&&r.push(this.visualizeRightAngleQuad(s,t)),s instanceof Jt._&&r.push(this.visualizePoint(s,t));return(0,o.vE)(r)}sortUniqueHints(e){return e}_getUniqueHints(e){const t=[];for(const i of e){let e=!0;for(const n of t)if(i.equals(n)){e=!1;break}e&&t.push(i)}return t}}var ti=i(17072);class ii extends ei{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof Yt.c?t.length:0)-(e instanceof Yt.c?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:n}=t,r=ni(t);return(0,o.DQ)(new Gt.l({view:n,primitive:"circle",geometry:(0,qt.io)(e.intersectionPoint,i),elevationInfo:e.isDraped?ct.Tq:ct.qt,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:n}=t,r=ni(t),s=ri(e.point,e.domain,t);return(0,o.DQ)(new Gt.l({view:i,primitive:"circle",geometry:(0,qt.io)(s,n),elevationInfo:si(e,t),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:n}=t,r=ni(t),s=ri(e.lineStart,e.domain,t),a=ri(e.lineEnd,e.domain,t);return(0,o.DQ)(this._createLineSegmentHint(e.type,s,a,n,si(e,t),i,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:n}=t,r=ni(t),{isDraped:s}=e,a=si(e,t),l=ri(e.lineStart,e.domain,t),c=ri(e.lineEnd,e.domain,t),d=ai(l,n,a,i,s),u=ai(c,n,a,i,s),h=(0,S.p)(u,d,u,.5),p=new Ct({view:i,attached:!1,offset:Ut.parallelLineHintOffset,length:Ut.parallelLineHintLength,width:Ut.parallelLineHintWidth,color:r.parallelSignColor,location:h,renderOccluded:s?Pe.m$.OccludeAndTransparent:Pe.m$.Opaque,isDraped:s,renderGroup:Ft.O7.SnappingHint,isDecoration:!0});return p.setDirectionFromPoints(d,h),p.attached=!0,(0,o.DQ)(p)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:n}=t,r=ni(t),s=si(e,t),{isDraped:a}=e,l=ri(e.previousVertex,e.domain,t),c=ri(e.centerVertex,e.domain,t),d=ri(e.nextVertex,e.domain,t),u=ai(l,n,s,i,a),h=ai(c,n,s,i,a),p=ai(d,n,s,i,a);return(0,o.DQ)(new jt.n({view:i,attached:!0,color:a?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:a?Pe.m$.OccludeAndTransparent:Pe.m$.Transparent,outlineRenderOccluded:a?Pe.m$.OccludeAndTransparent:Pe.m$.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:Ut.rightAngleHintOutlineSize,size:Ut.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:h,next:p},renderGroup:Ft.O7.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,i,n,r,s,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const d=ai(t,n,r,s,a),u=ai(i,n,r,s,a),h=new St({view:s,extensionType:xt.FADED,start:d,end:u,isDraped:a,color:o.lineColor,renderOccluded:a?Pe.m$.OccludeAndTransparent:Pe.m$.Opaque,renderGroup:Ft.O7.SnappingHint,isDecoration:!0});switch(e){case $t.H3.TARGET:h.width=Ut.lineHintWidthTarget,h.fadedExtensions={start:0,end:Ut.lineHintFadedExtensions};break;case $t.H3.REFERENCE_EXTENSION:h.width=Ut.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case $t.H3.REFERENCE:h.width=Ut.lineHintWidthReference,h.fadedExtensions={start:l?Ut.lineHintFadedExtensions:0,end:c?Ut.lineHintFadedExtensions:0}}return h.attached=!0,h}}function ni(e){const{effectiveTheme:t}=e.view,i=se.A.toUnitRGBA(t.accentColor),n=[0,0,0,0];return{intersectionPointColor:n,intersectionPointOutlineColor:i,pointColor:n,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:se.A.toUnitRGBA((0,de._L)(t.accentColor,.5)),rightAngleOutlineColor:i}}function ri(e,t,i){const n=oi(t,i);return null==n?e:(0,qt.vt)(e[0],e[1],n)}function si(e,t){return null!=oi(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?ct.Tq:ct.qt}function oi(e,t){let{selfSnappingZ:i}=t;return e===Bt.n.SELF&&null!=i?i.value:null}function ai(e,t,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,w.c)();if(r){const i=n.basemapTerrain.overlayManager.renderer.spatialReference;(0,R.F)(e,t,s,i)}else(0,ti.XG)(e,t,i,n,s);return s}var li=i(7256),ci=i(32314),di=i(49296),ui=i(44815),hi=i(67425);var pi=i(83490),fi=i(84294);class _i extends ci.X{constructor(e){super(e),this.view=null,this._renderOccluded=Pe.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,le.b)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,le.b)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,dt.h)(e,this._color)||((0,dt.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,dt.h)(e,this._outlineColor)||((0,dt.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,i,n,r){const s=(0,ui.jh)(3*e.length),o=(0,ui.jh)(s.length);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const a=(0,hi.au)(s,t,0,o,0,s,0,s.length/3,i,n,r),l=null!=a;return{numVertices:e.length,position:s,mapPositions:o,projectionSuccess:l,sampledElevation:a}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,di.F.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,r=t.position;for(let s=0;s<n;++s){const e=(0,S.s)(mi,r[3*s],r[3*s+1],r[3*s+2]),t=gi(this._vertexMaterial,.5,e),n=gi(this._vertexOutlineMaterial,.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:n})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of t)e.addGeometry(i),e.addGeometry(n)}createExternalResources(){this._vertexMaterial=new fi.A({...this._vertexMaterialParameters,writeDepth:!0,cullFace:pi.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new fi.A({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:pi.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const mi=(0,w.c)();function gi(e,t,i){return(0,be.CM)(e,t,16,16,{offset:i})}var vi=i(35925),yi=i(89238),Si=i(974),wi=i(39612),Mi=i(77944),bi=i(19276);let Pi=class extends s.A{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,r._)([(0,d.MZ)({constructOnly:!0})],Pi.prototype,"layer",void 0),(0,r._)([(0,d.MZ)()],Pi.prototype,"enabled",void 0),(0,r._)([(0,d.MZ)()],Pi.prototype,"updating",void 0),(0,r._)([(0,d.MZ)()],Pi.prototype,"availability",void 0),Pi=(0,r._)([(0,u.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Pi);const xi=Pi;let Oi=class extends s.A{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new bi.A,this.distance=Ut.distance,this.touchSensitivityMultiplier=Ut.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,r._)([(0,d.MZ)()],Oi.prototype,"enabled",void 0),(0,r._)([(0,d.MZ)()],Oi.prototype,"enabledToggled",void 0),(0,r._)([(0,d.MZ)()],Oi.prototype,"selfEnabled",void 0),(0,r._)([(0,d.MZ)()],Oi.prototype,"featureEnabled",void 0),(0,r._)([(0,d.MZ)({type:bi.A.ofType(xi)})],Oi.prototype,"featureSources",void 0),(0,r._)([(0,d.MZ)()],Oi.prototype,"distance",void 0),(0,r._)([(0,d.MZ)()],Oi.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],Oi.prototype,"effectiveEnabled",null),(0,r._)([(0,d.MZ)({readOnly:!0})],Oi.prototype,"effectiveSelfEnabled",null),(0,r._)([(0,d.MZ)({readOnly:!0})],Oi.prototype,"effectiveFeatureEnabled",null),Oi=(0,r._)([(0,u.$)("esri.views.interactive.snapping.SnappingOptions")],Oi);const Ri=Oi;var Ti=i(86226),Ei=i(75543),Ci=i(34154),Di=i(8203),Ai=i(46530),Li=i(31933);let zi=class extends s.A{get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){var e,t,i;const{layer:n}=this;if(!(0,Li.F2)(n)||null===(e=n.subtypes)||void 0===e||!e.length)return{mode:"not-in-use",filter:null};const r=null!==(t=null===(i=n.fieldsIndex.get(n.subtypeField))||void 0===i?void 0:i.name)&&void 0!==t?t:n.subtypeField,s=n.sublayers.filter((e=>e.visible)).map((e=>e.subtypeCode));return s.length?s.length===n.subtypes.length?{mode:"all-visible",filter:null}:1===s.length?{mode:"in-use",filter:"".concat(r," = ").concat(s.getItemAt(0))}:{mode:"in-use",filter:"".concat(r," IN (").concat(s.join(", "),")")}:{mode:"none-visible",filter:null}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,Ai.E)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,c.wB)((()=>t.updating),(e=>t.layerSource.updating=e),c.pc),(0,c.wB)((()=>t.availability),(e=>t.layerSource.availability=e),c.pc)])}getFetchCandidatesParameters(e,t,i){var n,r;if(!this.valid)return[];const{layer:s,layerView:o,floorFilter:a,rulesTable:l,subtypeFilter:c}=this,d={distance:i,mode:null!==(n=null===(r=this.view)||void 0===r?void 0:r.type)&&void 0!==n?n:"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:o&&"filter"in o?o.filter:null};if(a&&(d.filter=Hi(d.filter,a)),"not-in-use"!==c.mode&&"all-visible"!==c.mode){if("none-visible"===c.mode)return[];d.filter?d.filter.where=(0,Ci.m)(d.filter.where,c.mode):d.filter=new Di.A({where:c.filter})}if(l){var u;const e=t.feature,i=null===e||void 0===e?void 0:e.sourceLayer;if(!(e&&(0,Li.yZ)(s)&&s.layerId&&(0,Li.yZ)(i)&&"loaded"===l.loadStatus))return[];const n=[],r=s.layerId,o=null===(u=l.getFeatureSQL(i,e))||void 0===u?void 0:u[r];if(!o)return[];const a=o.anyVertex;let c=o.endVertex;return c&&a&&c===a&&(c=""),c&&n.push({...d,returnEdge:!1,vertexMode:"ends",filter:Hi(d.filter,c)}),a&&n.push({...d,returnEdge:!1,vertexMode:"all",filter:Hi(d.filter,a)}),n}return[d]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,$t.Tu)(null===t||void 0===t?void 0:t.map)&&(0,Li.yZ)(e)){var i;const r=null===(i=t.map.utilityNetworks)||void 0===i?void 0:i.find((t=>t.isUtilityLayer(e)));if(r)try{var n;this.rulesTable=await r.getRulesTable(),await(null===(n=this.rulesTable)||void 0===n?void 0:n.load()),this._valid=!0}catch(un){return void a.A.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}else this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function Hi(e,t){return null==e?new Di.A({where:t}):e.where?new Di.A({where:(0,Ci.m)(e.where,t)}):new Di.A({where:t})}(0,r._)([(0,d.MZ)({constructOnly:!0})],zi.prototype,"layer",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],zi.prototype,"snappingSource",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],zi.prototype,"view",void 0),(0,r._)([(0,d.MZ)()],zi.prototype,"layerView",null),(0,r._)([(0,d.MZ)()],zi.prototype,"rulesTable",void 0),(0,r._)([(0,d.MZ)()],zi.prototype,"valid",null),(0,r._)([(0,d.MZ)()],zi.prototype,"subtypeFilter",null),(0,r._)([(0,d.MZ)()],zi.prototype,"floorFilter",null),(0,r._)([(0,d.MZ)()],zi.prototype,"_valid",void 0),zi=(0,r._)([(0,u.$)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],zi);var Vi,Zi=i(80794),Gi=i(9876),ji=i(61751),Fi=i(30003);class qi extends Fi.C{constructor(e){let{targetPoint:t,constraint:i,previousVertex:n,otherVertex:r,otherVertexType:s,objectId:o,isDraped:a}=e;super(t,i,a,Bt.n.SELF),this.previousVertex=n,this.otherVertex=r,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===Vi.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===Vi.CENTER?this.targetPoint:this.otherVertex;return[new Yt.c($t.H3.TARGET,t,i,this.isDraped,this.domain),new Yt.c($t.H3.REFERENCE,e,t,this.isDraped,this.domain),new Kt(this.previousVertex,t,i,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(Vi||(Vi={}));let Ii=class extends s.A{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=Bt.n.FEATURE,this._updatingHandles=new ot.U,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,c.lZ)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e.featureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,o.DQ)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,n){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const r=[],s=this._computeScreenSizeDistanceParameters(e,i);for(const l of this._snappingSources){var o;if(null==l||!l.valid||!l.snappingSource.layerSource.enabled||null!==(o=l.layerView)&&void 0!==o&&o.suspended)continue;const t=l.getFetchCandidatesParameters(e,i,s);for(const e of t)r.push(l.snappingSource.fetchCandidates(e,n).then((e=>e.filter((e=>!this._candidateIsExcluded(l.snappingSource,e,i.excludeFeature))))))}const a=(await(0,st.nA)(r)).flat();return this._addRightAngleCandidates(a,e,s,i),(0,st.Te)(n),(0,$t.xX)(e,a),a}_addRightAngleCandidates(e,t,i,n){var r,s,o,a;const l=null!=n.vertexHandle?null===(r=n.vertexHandle.rightEdge)||void 0===r||null===(r=r.rightVertex)||void 0===r?void 0:r.pos:null!=n.editGeometryOperations&&"polygon"===n.editGeometryOperations.data.type?null===(s=n.editGeometryOperations.data.components[0])||void 0===s||null===(s=s.getFirstVertex())||void 0===s?void 0:s.pos:null,c=null!=n.vertexHandle?null===(o=n.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=n.editGeometryOperations?null===(a=n.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:d}=this,u=(0,qt.Lp)(l,d,n),h=(0,qt.Lp)(c,d,n),p=e.length;for(let f=0;f<p;f++)this._addRightAngleCandidate(e[f],h,t,i,e),this._addRightAngleCandidate(e[f],u,t,i,e)}_addRightAngleCandidate(e,t,i,n,r){if(null==t||!function(e){return(e instanceof Gi.z||e instanceof Zi.X)&&!function(e){let{constraint:{start:t,end:i}}=e;const n=(0,S.a)(t,i),r=(0,Tt.k)(t,i);return n<(0,Ti.g)()||r/n<Bi}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-i[0])/n.x,a=(s[1]-i[1])/n.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const i=new qi({targetPoint:s,otherVertex:t,otherVertexType:Vi.NEXT,previousVertex:(0,Tt.k)(s,l)>(0,Tt.k)(s,c)?l:c,constraint:new Ei.FX(t,s),objectId:e.objectId,isDraped:e.isDraped});r.push(i)}}_computeScreenSizeDistanceParameters(e,t){let i=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,n){const{spatialReference:r}=n;i.renderCoordsHelper.toRenderCoords(e,r,ki);const s=i.state.camera.computeScreenPixelSizeAt(ki),o=s*i.renderCoordsHelper.unitInMeters,a=o/(0,f.GA)(r),l=o/(0,f.G9)(r),c=t*a,d=t*l,u=(0,ti.jq)(e,r,ct.qt,i),h=u?Ni(u,e,a,0,0,i,n):0,p=u?Ni(u,e,0,a,0,i,n):0,_=u?Ni(u,e,0,0,l,i,n):0;return{x:0===h?0:c/h,y:0===p?0:c/p,z:0===_?0:d/_,distance:s*t}}_candidateIsExcluded(e,t,i){if(null==i)return!1;const n=this._getCandidateObjectId(t);if(null==n)return!1;const r=e.layerSource.layer;return"graphics"===r.type?i.uid===n:i.sourceLayer===r&&!(!i.attributes||!("objectIdField"in r))&&i.attributes[r.objectIdField]===n}_getCandidateObjectId(e){return e instanceof ji.w?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),(0,st.Te)(t));const{view:n}=this,r=await this._createFeatureSnappingSourceType(e);return(0,st.Te)(t),new zi(null==r?{}:{snappingSource:r,view:n,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,i;return null!==(t=null===(i=e.layer.sublayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),i={module:null,loader:t};this._sourceModules[e]=i;const n=await t,r={module:n,loader:t};return this._sourceModules[e]=r,n}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(i.e(5376).then(i.bind(i,85376)));case"featureCollection":return t.addPromise(i.e(7567).then(i.bind(i,77567)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(7216),i.e(3620),i.e(8383),i.e(2790),i.e(2547),i.e(9546)]).then(i.bind(i,99546)));case"scene":return t.addPromise(i.e(3537).then(i.bind(i,13537)))}}get test(){return{snappingSources:this._snappingSources}}};function Ni(e,t,i,n,r,s,o){let{spatialReference:a}=o;const l=(0,S.c)(Ui,t);l[0]+=i,l[1]+=n,l[2]+=r;const c=(0,ti.jq)(l,a,ct.qt,s);return c?(0,$t.Mo)(c,e):1/0}(0,r._)([(0,d.MZ)({constructOnly:!0})],Ii.prototype,"spatialReference",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],Ii.prototype,"view",void 0),(0,r._)([(0,d.MZ)()],Ii.prototype,"options",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],Ii.prototype,"updating",null),(0,r._)([(0,d.MZ)()],Ii.prototype,"_snappingSources",void 0),Ii=(0,r._)([(0,u.$)("esri.views.interactive.snapping.FeatureSnappingEngine")],Ii);const ki=(0,w.c)(),Ui=(0,w.c)(),Bi=1e-4;var $i=i(54099),Wi=i(9624);class Xi{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=Ut.shortLineThreshold*Ut.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,qt.Lp)(e.leftVertex.pos,this.view,t),(0,qt.Lp)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,i){let{spatialReference:n}=i;return 0===this.squaredShortLineThreshold||(0,$t.pM)((0,ti.jq)(t,n,ct.qt,this.view),(0,ti.jq)(e,n,ct.qt,this.view))>this.squaredShortLineThreshold}isVertical(e,t){return(0,Tt.k)(e,t)<Ut.verticalLineThreshold}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class Yi extends Fi.C{constructor(e){let{lineStart:t,lineEnd:i,targetPoint:n,isDraped:r}=e;super(n,new Ei.WG(t,i),r,Bt.n.SELF),this._referenceLineHint=new Yt.c($t.H3.REFERENCE_EXTENSION,t,i,r,this.domain)}get hints(){return[this._referenceLineHint,new Yt.c($t.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var Qi=i(79337),Ji=i(74050);class Ki extends Xi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,r=[];if(n<1)return r;const{spatialReference:s}=t,o=(0,ti.jq)(e,s,ct.qt,this.view),{view:a}=this,l=i.edges[n-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const i=(0,$t.is)(c,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,r)}c=c.leftVertex.leftEdge}while(c&&c!==l);return r}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.component;if(r.edges.length<2)return i;const{view:s}=this,{spatialReference:o}=t,a=(0,ti.jq)(e,o,ct.qt,s),l=n.leftEdge,c=n.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,qt.Lp)(l.leftVertex.pos,s,t),(0,qt.Lp)(c.rightVertex.pos,s,t),e,a,t,i);const d=r.edges[0];let u=d;do{if(u!==n.leftEdge&&u!==n.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const n=(0,$t.is)(u,s,t);this._processCandidateProposal(n.left,n.right,e,a,t,i)}u=u.rightVertex.rightEdge}while(u&&u!==d);return i}_processCandidateProposal(e,t,i,n,r,s){var o;const{spatialReference:a,pointer:l}=r,c=(0,qt._7)((0,Qi.Yv)(i,{start:e,end:t,type:Ji.Vv.LINE}));(0,$t.pM)(n,(0,ti.jq)(c,a,ct.qt,this.view))<this.squaredProximityThreshold(l)&&s.push(new Yi({lineStart:e,lineEnd:t,targetPoint:c,isDraped:"on-the-ground"===(null===(o=r.elevationInfo)||void 0===o?void 0:o.mode)}))}}class en extends Fi.C{constructor(e){let{referenceLine:t,lineStart:i,targetPoint:n,isDraped:r}=e;const s=(0,w.g)(i),{left:o,right:a}=t;(0,S.f)(s,(0,S.g)(s,s,a),o),super(n,new Ei.WG(i,(0,qt._7)(s)),r,Bt.n.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new Yt.c($t.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Qt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new Yt.c($t.H3.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{(0,S.h)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,S.h)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,S.h)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,S.h)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class tn extends Xi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,r=i.vertices.length,s=[];if(n<2)return s;const{view:o}=this,a=(0,ti.jq)(e,t.spatialReference,ct.qt,o),l=(0,qt.Lp)(i.vertices[r-1].pos,o,t),c=(0,qt.Lp)(i.vertices[0].pos,o,t),d=i.edges[n-1];let u=d;do{if(this.edgeExceedsShortLineThreshold(u,t)){const i=(0,$t.is)(u,o,t);this._checkEdgeForParallelLines(i,l,e,a,t,s),this._checkEdgeForParallelLines(i,c,e,a,t,s)}u=u.leftVertex.leftEdge}while(u&&u!==d);return s}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.component;if(r.edges.length<3)return i;const{view:s}=this,o=(0,ti.jq)(e,t.spatialReference,ct.qt,s),a=n.leftEdge,l=n.rightEdge,c=r.vertices[0],d=(0,qt.Lp)(c.pos,s,t),u=r.vertices.length,h=r.vertices[u-1],p=(0,qt.Lp)(h.pos,s,t),f=r.edges[0];let _=f;do{if(_!==a&&_!==l&&this.edgeExceedsShortLineThreshold(_,t)){const r=(0,$t.is)(_,s,t);a&&this._checkEdgeForParallelLines(r,(0,qt.Lp)(a.leftVertex.pos,s,t),e,o,t,i),l&&this._checkEdgeForParallelLines(r,(0,qt.Lp)(l.rightVertex.pos,s,t),e,o,t,i),n===c?this._checkEdgeForParallelLines(r,p,e,o,t,i):n===h&&this._checkEdgeForParallelLines(r,d,e,o,t,i)}_=_.rightVertex.rightEdge}while(_&&_!==f);return i}_checkEdgeForParallelLines(e,t,i,n,r,s){const o=e.left,a=e.right;if((0,Ji.fg)(nn,t,o,a),(0,Tt.k)(nn,t)<Ut.parallelLineThreshold)return;(0,Ji.fg)(nn,i,o,a,t);const{spatialReference:l,pointer:c}=r,d=(0,qt.fA)(nn[0],nn[1],i[2]);if((0,$t.pM)(n,(0,ti.jq)(d,l,ct.qt,this.view))<this.squaredProximityThreshold(c)){var u;if(this.isVertical(d,t)||this.isVertical(o,a))return;if(this._parallelToPreviousCandidate(e,s))return;s.push(new en({referenceLine:e,lineStart:t,targetPoint:d,isDraped:"on-the-ground"===(null===(u=r.elevationInfo)||void 0===u?void 0:u.mode)}))}}_parallelToPreviousCandidate(e,t){const i=e.left,n=e.right;for(const r of t)if((0,Ji.fg)(nn,n,r.constraint.start,r.constraint.end,i),(0,Tt.k)(nn,n)<Ut.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}}const nn=(0,Et.a)();class rn extends Xi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.vertices.length,r=[];if(n<2)return r;const{view:s}=this,o=(0,ti.jq)(e,t.spatialReference,ct.qt,s),a=i.vertices[n-1];if(this.edgeExceedsShortLineThreshold(a.leftEdge,t)){const i=(0,qt.Lp)(a.pos,s,t),n=(0,qt.Lp)(a.leftEdge.leftVertex.pos,s,t);this._checkForSnappingCandidate(r,n,i,e,o,t)}const l=i.vertices[0];if(this.edgeExceedsShortLineThreshold(l.rightEdge,t)){const i=(0,qt.Lp)(l.pos,s,t),n=(0,qt.Lp)(l.rightEdge.rightVertex.pos,s,t);this._checkForSnappingCandidate(r,n,i,e,o,t)}return r}snapExistingVertex(e,t){const i=[],n=t.vertexHandle;if(n.component.vertices.length<3)return i;const{view:r}=this,s=(0,ti.jq)(e,t.spatialReference,ct.qt,r),o=n.leftEdge,a=n.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const n=o.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const o=(0,qt.Lp)(n.rightVertex.pos,r,t),a=(0,qt.Lp)(n.leftVertex.pos,r,t);this._checkForSnappingCandidate(i,a,o,e,s,t)}}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const n=a.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const o=(0,qt.Lp)(n.leftVertex.pos,r,t),a=(0,qt.Lp)(n.rightVertex.pos,r,t);this._checkForSnappingCandidate(i,a,o,e,s,t)}}return i}_checkForSnappingCandidate(e,t,i,n,r,s){const{spatialReference:o,pointer:a}=s;(0,Tt.c)(sn,i,t);const l=(0,S.s)(on,sn[1],-sn[0],0),c=(0,Tt.g)(l,(0,Tt.c)(sn,n,i))/(0,Tt.v)(l),d=(0,qt._7)((0,Tt.w)((0,w.g)(n),i,l,c));if((0,$t.pM)(r,(0,ti.jq)(d,o,ct.qt,this.view))<this.squaredProximityThreshold(a)){var u;if(this.isVertical(d,i)||this.isVertical(i,t))return;const n=(0,S.q)((0,w.c)(),i,l,Math.sign(c));e.push(new qi({targetPoint:d,constraint:new Ei.FX(i,(0,qt._7)(n)),previousVertex:t,otherVertex:i,otherVertexType:Vi.CENTER,isDraped:"on-the-ground"===(null===(u=s.elevationInfo)||void 0===u?void 0:u.mode)}))}}}const sn=(0,Et.a)(),on=(0,w.c)();class an extends Fi.C{constructor(e){let{targetPoint:t,point1:i,point2:n,isDraped:r}=e;super(t,new Ei.ej((0,qt._7)((0,S.p)((0,w.c)(),i,n,.5)),.5*(0,Tt.d)(i,n)),r,Bt.n.SELF),this._p1=i,this._p2=n}get hints(){return[new Yt.c($t.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new Yt.c($t.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Kt(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class ln extends Xi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=[],r=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return n;const{view:s}=this,o=i.vertices[0],a=i.vertices[r-1],l=(0,qt.Lp)(o.pos,s,t),c=(0,qt.Lp)(a.pos,s,t);return this._processCandidateProposal(l,c,e,t,n),n}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.component;if(r.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===n.index||n.index===r.vertices.length-1))return i;const{view:s}=this,o=(0,qt.Lp)(n.leftEdge.leftVertex.pos,s,t),a=(0,qt.Lp)(n.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,i),i}_processCandidateProposal(e,t,i,n,r){if(!this.exceedsShortLineThreshold(e,t,n))return;const s=(0,Tt.l)(cn,e,t,.5),o=.5*(0,Tt.d)(e,t),a=(0,w.c)();(0,Ji.Dh)(a,i,s,o),a[2]=i[2];const l=(0,qt._7)(a),{spatialReference:c,pointer:d}=n,u=(0,ti.jq)(i,c,ct.qt,this.view);if((0,$t.pM)(u,(0,ti.jq)(l,c,ct.qt,this.view))<this.squaredProximityThreshold(d)){var h;if(this.isVertical(e,l)||this.isVertical(l,t))return;r.push(new an({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(h=n.elevationInfo)||void 0===h?void 0:h.mode)}))}}}const cn=(0,Et.a)();let dn=class extends s.A{constructor(e){super(e),this.updating=!1,this._snappers=new bi.A,this._domain=Bt.n.SELF}initialize(){this._snappers.push(new tn(this.view,this.options),new Ki(this.view,this.options),new rn(this.view,this.options),new ln(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const n=[];for(const r of this._snappers.items)for(const t of r.snap(e,i))n.push(t);return(0,$t.xX)(e,n),n}};function un(e,t){return[new dn({view:e,options:t}),new Ii({view:e,options:t,spatialReference:e.spatialReference})]}function hn(e,t,i){var n;let{z:r,m:s,spatialReference:o,elevationInfo:a}=i;if(null==r&&null==s){const t=(0,P.T)(e[0],e[1],void 0,o);return null!=s&&(t.m=s,t.hasM=!0),t}if(null==t||"2d"===t.type){const t=(0,P.T)(e[0],e[1],r,o);return null!=s&&(t.m=s,t.hasM=!0),t}const l=null!==(n=(0,ct.xS)(t,e,o,ct.qt,a))&&void 0!==n?n:0,c=(0,P.T)(e[0],e[1],l,o);return null!=s&&(c.m=s,c.hasM=!0),c}(0,r._)([(0,d.MZ)({readOnly:!0})],dn.prototype,"updating",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],dn.prototype,"view",void 0),(0,r._)([(0,d.MZ)()],dn.prototype,"options",null),dn=(0,r._)([(0,u.$)("esri.views.interactive.snapping.SelfSnappingEngine")],dn);class pn extends Fi.C{constructor(e,t,i,n){super(e,new Ei.i7(e),n,Bt.n.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Xt(this.targetPoint,this.isDraped,this.domain)]}}let fn=class extends($i.A.EventedMixin(s.A)){constructor(e){super(e),this.options=new Ri,this.snappingEnginesFactory=un,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=_n.MAIN}initialize(){this.addHandles([(0,c.wB)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}}),(()=>{this.doneSnapping(),this.emit("changed")}),c.OH),(0,c.wB)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),c.OH),(0,c.wB)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:i}=e;return this._recreateEngines(t,i)}),c.pc)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:n}=this;this._engines=t(i,n)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}get _squaredSatisfiesConstraintThreshold(){return Ut.satisfiesConstraintScreenThreshold*Ut.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const n=this._currentMainCandidate;if(null==n)return t;const r=this._selectUpdateInput(e);if(null==r)return t;const{spatialReference:s}=i,o=(0,Wi.project)(r,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=i,d=[],u=(0,qt.vf)(o,a,l),h=n.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,h,i))return this._resetSnappingState(),t;n.targetPoint=h,d.push(...n.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,d.push(...p.hints);return null!=c&&this.addHandles(c.draw(d,{spatialReference:s,elevationInfo:gn(i),view:a,selfSnappingZ:i.selfSnappingZ}),mn),hn(h,a,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:l})}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:i}=e;switch(this._currentSnappedType){case _n.MAIN:return t;case _n.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=_n.MAIN}_removeVisualization(){this.removeHandles(mn)}async _snapSinglePoint(e){let{point:t,context:i,signal:n}=e;const{view:r}=this,{elevationInfo:s}=i,o=(0,qt.vf)(t,r,s),a=await this._fetchCandidates(o,Bt.n.ALL,i,n);return this._createSnapResult(o,_n.MAIN,a,r,i,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:s},n)}async _snapMultiPoint(e){var t,i;let{point:n,scenePoint:r,context:s,signal:o}=e;const{view:a}=this,{coordinateHelper:l,elevationInfo:c,spatialReference:d}=s;await(0,Wi.initializeProjection)(r.spatialReference,d);const u=(0,Wi.project)(r,d),h=(0,qt.vf)(u,a,c),p=await this._fetchCandidates(h,Bt.n.FEATURE,s,o);if(p.length>0){const e=await this._fetchCandidates(h,Bt.n.SELF,s,o);return this._createSnapResult(h,_n.SCENE,[...p,...e],a,s,{z:u.z,m:u.m,spatialReference:u.spatialReference,elevationInfo:c},o)}const f=(0,qt.vf)(n,a,c),_=await this._fetchCandidates(f,Bt.n.SELF,s,o);return this._createSnapResult(f,_n.MAIN,_,a,s,{z:l.hasZ()&&n.hasZ?null!==(t=n.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&n.hasM?null!==(i=n.m)&&void 0!==i?i:0:void 0,spatialReference:n.spatialReference,elevationInfo:c},o)}async _fetchCandidates(e,t,i,n){return(await Promise.all(this._engines.map((r=>r.fetchCandidates(e,t,i,n))))).flat()}_createSnapResult(e,t,i,n,r,s,o){return{get valid(){return!(0,st.G4)(o)},apply:()=>{const{spatialReference:o}=r,{snappedPoint:a,hints:l}=this._processCandidates(e,t,i,r);return this._removeVisualization(),null!=r.visualizer&&this.addHandles(r.visualizer.draw(l,{spatialReference:o,elevationInfo:ct.qt,view:n,selfSnappingZ:r.selfSnappingZ}),mn),hn(a,n,s)}}}_processCandidates(e,t,i,n){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,$t.xX)(e,i);const r=this._currentMainCandidate;if(null!=r){const s=this._findOldConstraintInNewCandidates(r,i);if(s>=0){if(!(i[s]instanceof pn))return this._intersectWithOtherCandidates(s,i,e,t,n);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,n))return this._updateSnappingCandidate(r,t,i,n)}}return this._intersectWithOtherCandidates(0,i,e,t,n)}_findOldConstraintInNewCandidates(e,t){return e instanceof pn?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,n,r){const{coordinateHelper:s}=r,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const n=t[l],r=o.constraint.intersect(n.constraint);if(r)for(const e of r.closestPoints(o.targetPoint))a.push([new pn(e,o,n,n.isDraped),this._squaredScreenDistance(i,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(a[0][0],n,t,r):this._updateSnappingCandidate(o,n,t,r)}_updateSnappingCandidate(e,t,i,n){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of i){if(e instanceof pn){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(r);this._squaredScreenDistance(t,r,n.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=r,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,$t.pM)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,ti.jq)(e,t.spatialReference,ct.qt,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let n=0;n<e.length;++n)if(t.constraint.equals(e[n].constraint)){i=n;break}return i}get test(){return{visualizationsActive:this.hasHandles(mn),engines:this._engines}}};var _n;(0,r._)([(0,d.MZ)({constructOnly:!0})],fn.prototype,"view",void 0),(0,r._)([(0,d.MZ)()],fn.prototype,"options",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],fn.prototype,"updating",null),(0,r._)([(0,d.MZ)()],fn.prototype,"snappingEnginesFactory",void 0),(0,r._)([(0,d.MZ)()],fn.prototype,"_engines",void 0),(0,r._)([(0,d.MZ)()],fn.prototype,"_squaredMouseProximityTreshold",null),(0,r._)([(0,d.MZ)()],fn.prototype,"_squaredTouchProximityThreshold",null),(0,r._)([(0,d.MZ)()],fn.prototype,"_squaredSatisfiesConstraintThreshold",null),fn=(0,r._)([(0,u.$)("esri.views.interactive.snapping.SnappingManager")],fn),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(_n||(_n={}));const mn="visualization-handle";function gn(e){let{coordinateHelper:t,elevationInfo:i}=e;return t.hasZ()?ct.qt:i}const vn=new Map;function yn(e){if(!vn.has(e)){const t=function(e,t){var i,n;const r=new Ri({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(i=null===t||void 0===t?void 0:t.distance)&&void 0!==i?i:Ut.distance,touchSensitivityMultiplier:null!==(n=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==n?n:Ut.touchSensitivityMultiplier});return{...(0,c.wB)((()=>{var t,i;return null!==(t=null===(i=e.map)||void 0===i||null===(i=i.allLayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]}),(e=>{r.featureSources=new bi.A(e.map((e=>new xi({layer:e,enabled:!0}))))}),c.Vh),options:r}}(e,{distance:10}),i=function(e,t){return new fn({view:e,options:t,snappingEnginesFactory:(t,i)=>[new Ii({view:e,spatialReference:e.spatialReference,options:i})]})}(e,t.options);vn.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=vn.get(e);t.referenceCount++;const i=(0,o.hA)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,Mi.d)((()=>{0===t.referenceCount&&(t.remove(),vn.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...i}}class Sn{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}var wn=i(74e3),Mn=i(59752);function bn(e){let{predicate:t=(()=>!0),snappingManager:i,snappingContext:n,updatingHandles:r,useZ:s=!0}=e;const o=new Te.rh;if(null==i)return{snappingStep:[Rn,o],cancelSnapping:Rn};let a,d=null,u=null,h=null;const p=()=>{var e;d=(0,l.DC)(d),i.doneSnapping(),null!==(e=u)&&void 0!==e&&e.frameTask.remove(),u=null,a=(0,l.xt)(a),h=null},f=function(e,t,i){return(0,st.sg)((async(n,r)=>{let{frameTask:s,point:o,scenePoint:a,context:l,event:c,delta:d,getLastState:u}=n;const h=await s.schedule((()=>e.snap({point:o,scenePoint:a,context:l,signal:r})),r);if(h.valid){let n=await s.schedule((()=>h.apply()),r);const a=u();null!=a.point&&o!==a.point&&(n=e.update({point:a.point,scenePoint:a.scenePoint,context:l})),null!=a.updatePoint&&(0,wn.C)(n,a.updatePoint)||(On(c.mapEnd,n,d,t),i.execute(c))}}))}(i,s,o);let _=null,m=null,g=null;return{snappingStep:[e=>{if(!t(e))return e;const{action:o}=e;if("start"===o){const{info:t}=e,r=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(Mn.W6.SNAPPING):Mn.nu}(i.view);if(u=function(e,t,i){return{context:new Sn({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:i}}(n,e,r),u.context.selfSnappingZ=null,!s&&null!=t){var l;const e=function(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const r of i){const t=e.getZ(r.pos);if(null!=n&&null!=t&&Math.abs(t-n)>1e-6)return null;null==n&&(n=t)}return n}(n.coordinateHelper,t.handle.component);null!=e&&(u.context.selfSnappingZ={value:e,elevationInfo:null!==(l=n.elevationInfo)&&void 0!==l?l:ct.qt})}}if(null!=u){const{context:t,originalScenePos:n,originalPos:l}=u,{mapEnd:p,mapStart:v,scenePoints:y}=e,S=Pn(l,xn(p,v)),w=xn(v,l),M={...e,action:"update"},b=u.context,P=function(e,t){return null==e||null==t?null:Pn(e,xn(t.sceneEnd,t.sceneStart))}(n,y),x=i.update({point:S,scenePoint:P,context:t});if(g=x,On(p,x,w,s),_=S,m=P,"end"!==o){const{frameTask:e}=u;null==d&&(d=new AbortController),h=t=>{r.addPromise((0,st.QZ)(f({frameTask:e,event:M,context:b,point:S,scenePoint:P,delta:w,getLastState:()=>({point:_,scenePoint:m,updatePoint:t.forceUpdate?null:g})},d.signal)))},h({forceUpdate:!1}),null==a&&(a=(0,c.wB)((()=>i.options.effectiveEnabled),(()=>{var e;return null===(e=h)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===o&&p(),e},o],cancelSnapping:e=>(p(),e)}}function Pn(e,t){let[i,n,r]=t;const s=(0,x.EL)(e);return s.x+=i,s.y+=n,s.hasZ&&(s.z+=r),s}function xn(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function On(e,t,i,n){let[r,s,o]=i;e.x=t.x+r,e.y=t.y+s,n&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function Rn(e){return e}let Tn=class extends s.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,st.sg)((async(e,t,i,n)=>{const r=this._frameTask;if(null==r)return;const s=await r.schedule((()=>t.snap({...e,context:i,signal:n})),n);s.valid&&await r.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(Mn.W6.SNAPPING):Mn.nu}destroy(){this._abortController=(0,l.DC)(this._abortController),this._frameTask=(0,l.xt)(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:r}=e,s=t.update({point:n,scenePoint:r,context:i});return this.stagedPoint=s,s}async snap(e,t,i){const{point:n,scenePoint:r}=e;return this.stagedPoint=t.update({point:n,scenePoint:r,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async resnap(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,l.DC)(this._abortController),this._snapPoints=null}};(0,r._)([(0,d.MZ)({constructOnly:!0})],Tn.prototype,"view",void 0),(0,r._)([(0,d.MZ)()],Tn.prototype,"stagedPoint",null),(0,r._)([(0,d.MZ)()],Tn.prototype,"constrainResult",void 0),(0,r._)([(0,d.MZ)()],Tn.prototype,"_stagedPoint",void 0),Tn=(0,r._)([(0,u.$)("esri.views.interactive.snapping.SnappingOperation")],Tn);let En=class extends s.A{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new it.A,this._orientationManipulatorTexture=null,this._updatingHandles=new ot.U,this._getSnappingContext=(0,rt.B)((e=>new Sn({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new wi.p(new Si.ZE("point",(0,yi.BV)(!0,!1,this.view.spatialReference))),visualizer:new ii})));const{view:t}=e;this._snappingManagerResult=yn(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,vi.wk)(2)}),this._constraintSnappingIndicator=new li.t({view:t,attached:!0,width:1,renderOccluded:Pe.m$.OccludeAndTransparent,stipplePattern:(0,vi.wk)(5),isDecoration:!0});const i=se.A.toUnitRGBA(pe);this._stagedStartIndicator=new _i({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:i,size:10,outlineSize:0,renderOccluded:Pe.m$.OccludeAndTransparent,isDecoration:!0})}initialize(){var e;const{view:t}=this;this._snappingOperation=new Tn({view:t});const i=!(null!==(e=t._stage)&&void 0!==e&&e.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._orientationManipulatorMaterial=new Oe.r({transparent:!0,writeDepth:!1,renderOccluded:Pe.m$.Opaque,isDecoration:!0}),this.addHandles((0,c.wB)((()=>({accentColor:ue(t.effectiveTheme),contrastColor:he(t.effectiveTheme)})),(e=>{let{accentColor:n,contrastColor:r}=e;const s=this._orientationManipulatorTexture,o=(0,lt.t)(t.textures,{accentColor:n,contrastColor:r,preMultiplyAlpha:i});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,null===s||void 0===s||s.release();const a=se.A.toUnitRGBA(n);this._unfocusedOffsetManipulatorMaterial.setParameters({color:a}),this._focusedOffsetManipulatorMaterial.setParameters({color:a}),this._thinOffsetManipulatorMaterial.setParameters({color:a}),this._constraintSnappingIndicator.color=a}),c.Vh));const n=(0,c.LF)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createManipulators(t)}));this.addHandles((0,o.DQ)(n)),this.addHandles([(0,c.wB)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(e=>{let{stagedPoint:t,stagedComputation:i}=e;if(null==i||null==t)return;const n=(0,x.EL)(t,new Ce.A);this._applyPointUpdate(i,{endPoint:n})}),c.OH),(0,c.wB)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:r}=e;if(i===(null===t||void 0===t?void 0:t.stagedDimension)&&r===(null===t||void 0===t?void 0:t.firstGrabbedManipulator)){for(const s of[n,null===t||void 0===t?void 0:t.selectedComputation])if(null!=s){const t=this._computationManipulators.get(s);null!=t&&this._updateManipulators(s,t,e)}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,e)}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),c.Vh),(0,c.wB)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.wB)((()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,i=(0,w.c)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,i)?i:null}),(e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,$t.BY)(this,(()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){var i;const e=null!==(i=this.view.inputManager.latestPointerType)&&void 0!==i?i:"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,st.QZ)(this._snappingOperation.resnap(this._snappingManager,t)))}if(null!=e){const{start:t,end:i}=this._computationManipulators.get(e);if(t.grabbing||i.grabbing){!function(e,t,i){let{constraint:n,view:r}=i;const{unconstrainedGeometry:s}=e;if(null==s)return;const{renderCoordsHelper:o,spatialReference:a}=r,{startRenderSpace:l,endRenderSpace:c}=s.directSegment,d=o.fromRenderCoords(l,new Ce.A,a),u=o.fromRenderCoords(c,new Ce.A,a);let h;h="start"===t?{startPoint:d}:{endPoint:u},at(e,h,{constraint:n,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:s,view:r})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}}))}destroy(){var e;this._snappingOperation=(0,l.pR)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),null===(e=this._orientationManipulatorTexture)||void 0===e||e.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){var e;const t=this._stagedDimension,i=null===(e=this.analysisViewData.computations.at(-1))||void 0===e?void 0:e.computation;return null==t||null==i||i.dimension!==t?null:i}get _constraintHandles(){return[(0,c.z7)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=this._computeConstraint(e)}),{...c.pc,equals:nt.aI}),(0,c.wB)((()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:i}=e.dimension;return{measureType:t,orientation:i,computation:e}}),((e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:i,computation:n}=e;switch(n.previousConstraint){case et.Horizontal:n.preConstraintProperties={measureType:p.L.Horizontal,orientation:0};break;case et.Vertical:n.preConstraintProperties={measureType:p.L.Vertical,orientation:0};break;case et.Direct:n.preConstraintProperties={measureType:p.L.Direct,orientation:i};break;default:n.preConstraintProperties={measureType:t,orientation:i}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),c.OH)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,c.wB)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(t=>{let{stagedComputation:i,activeComputation:n}=t;const r=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=n)if(n===i)r.attached=!0;else{const{start:t,end:i}=this._computationManipulators.get(n),s=()=>{r.attached=t.grabbing||i.grabbing};s(),this.addHandles([t.events.on("grab-changed",s),i.events.on("grab-changed",s)],e)}else r.attached=!1})),(0,c.wB)((()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(e=>{let{geometry:t,constraint:i}=e;const n=this._constraintSnappingIndicator;null!=t&&null!=i&&i!==et.Direct?(n.visible=!0,n.setGeometryFromSegment(t.directSegment)):n.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove(e){let{mapPoint:t,pointerType:i}=e;if("touch"===i)return;const n=this._getSnappingContext(i);this._updatingHandles.addPromise((0,st.QZ)(this._snappingOperation.snap({point:t},this._snappingManager,n)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(e){let{mapPoint:t,pointerType:i}=e,n=t;if("mouse"===i){const e=this._getSnappingContext(i);n=this._snappingManager.update({point:t,context:e})}const r=new tt.A({startPoint:(0,x.EL)(n,new Ce.A),endPoint:null,measureType:p.L.Horizontal});return this._stagedDimension=r,this._resetSnappingState(),r}_onStagedClick(e){let{mapPoint:t,pointerType:i}=e;const n=this._stagedComputation;if(null==n)return;let r=t;if("mouse"===i){const e=this._getSnappingContext(i);r=this._snappingManager.update({point:t,context:e})}const s=(0,x.EL)(r,new Ce.A);this._applyPointUpdate(n,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),i=this._setupPointManipulator(e,{isStart:!1}),n=this._setupOffsetManipulator(e),r=this._setupHeadingManipulator(e),s=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,p.L.Direct),a=this._setupMeasureTypeManipulator(e,p.L.Horizontal),l=this._setupMeasureTypeManipulator(e,p.L.Vertical),c=new De({start:t,end:i,offset:n,heading:r,rotation:s,direct:o,horizontal:a,vertical:l});return this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of c.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,c.wB)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...c.pc,equals:nt.aI})],e)}_setupPointManipulator(e,t){const{view:i}=this,{dimension:n}=e,r=new Ae(i,{metadata:n}),s=function(e,t){let{isStart:i,createSnappingPipelineStep:n,dimension:r,onUpdate:s,view:o}=t;const a=i?"startPoint":"endPoint",l=(0,Te.Xt)(e,((e,t,i,l)=>{const c=(0,ye.z7)(e),{snappingStep:d,cancelSnapping:u}=n(l);i=i.next(c).next((0,Te.VG)(r,[a,"measureType","orientation"])).next(u),t.next(c).next((0,ye.xk)(o)).next(...d).next((e=>{const t=(0,x.EL)(e.mapEnd,new Ce.A);s("startPoint"===a?{startPoint:t}:{endPoint:t})}))}));return[l]}(r,{isStart:t.isStart,createSnappingPipelineStep:e=>bn({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:n,onUpdate:t=>this._applyPointUpdate(e,t),view:i});return this._computationHandles.add(s,e),r}_setupOffsetManipulator(e){const{view:t}=this,i=function(e,t){const i=[(0,w.f)(-.5,0,0),(0,w.f)(.5,0,0)],n=(0,be.Z8)(t.unfocusedMaterial,i.map((e=>(0,S.i)((0,w.c)(),e,.5)))),r=n.instantiate({material:t.focusedMaterial});return new me.q({view:e,renderObjects:[new ve.M(n,Ee.p7.Unfocused|Ee.p7.Selected|Xe),new ve.M(r,Ee.p7.Focused|Xe)],collisionType:{type:"line",paths:[i]},radius:$e(t.lineSizePt)/2,metadata:t.metadata,available:!1,...ge.MO})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),n=function(e,t){let{computation:i,view:n}=t;return[(0,Te.Xt)(e,((e,t,r)=>{if(!ie(i)||!e.selected)return;const{geometry:s,dimension:o}=i,a=(0,ye.z7)(e);t.next(a).next(Ge(n,o,s.dimensionSegment,s.primaryOffsetAxis)),r.next(a).next((0,Te.VG)(o,["offset"]))}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupHeadingManipulator(e){const{view:t}=this,i=new Le(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=function(e,t){let{computation:i,view:n}=t;return[(0,Te.Xt)(e,((e,t,r)=>{Ve({cancel:r,computation:i,settingHeading:!0,steps:t,view:n})}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupRotationManipulator(e){const{view:t}=this,i=new Le(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=He(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupMeasureTypeManipulator(e,t){const{view:i}=this,n=function(e,t){const i=[(0,w.f)(-.5,0,0),(0,w.f)(.5,0,0)],n=(0,be.Z8)(t.thinOffsetManipulatorMaterial,i),r=(0,be.Z8)(t.unfocusedMaterial,i.map((e=>(0,S.i)((0,w.c)(),e,.5)))),s=r.instantiate({material:t.focusedMaterial});return new me.q({view:e,renderObjects:[new ve.M(r,Ee.p7.Unfocused|Xe),new ve.M(s,Ee.p7.Focused|Xe),new ve.M(n,Xe)],collisionType:{type:"line",paths:[i]},radius:$e(t.lineSizePt)/2,available:!1,metadata:t.metadata,...ge.MO})}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),r=Ze(n,{computation:e,manipulatorMeasureType:t,view:i});return this._computationHandles.add(r,e),n}_updateManipulators(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:n,selectedComputation:r,firstGrabbedManipulator:s}=i,{start:o,end:a,offset:l,heading:c,rotation:d}=t,u=r===e,h=ie(e),{dimension:f}=e;for(const p of t.values()){const e=h&&null==n&&(null==s||p===s);p===l?(p.available=e,p.selected=u):p.available=e&&u}if(!h)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(f.measureType).available=!1;for(const g of[c,d])f.measureType===p.L.Direct&&0!==f.offset||(g.available=!1);$(e)?d.available=!1:c.available=!1;const{geometry:_}=e;o.renderLocation=_.directSegment.startRenderSpace,a.renderLocation=_.directSegment.endRenderSpace;const{renderCoordsHelper:m}=this.view;(function(e,t,i){const{dimensionSegment:n,primaryOffsetAxis:r}=t,s=Q(Ye,t),o=(0,S.h)(s,w.Z)?(0,v.g)(Je):(0,ge.wQ)(s,r,w.Z,Je),a=Math.max((0,S.l)(s),.1/i.unitInMeters);(0,v.b)(o,o,(0,S.s)(Ye,a,a,a)),e.modelTransform=o,e.renderLocation=n.eval(.5,Ye)})(l,_,m),c.available&&function(e,t,i){Fe(e,t,i,{forHeading:!0})}(c,e,m),d.available&&function(e,t,i){Fe(e,t,i,{forHeading:!1})}(d,e,m),t.forEachMeasureTypeManipulator(((t,i)=>{t.available&&function(e,t,i,n){const{geometry:r}=t,s=q(Ke,i,t,n),o=U(Ye,{measureType:i,directSegment:r.directSegment,renderCoordsHelper:n}),a=(0,S.u)(Qe,s.endRenderSpace,s.startRenderSpace),l=(0,ge.wQ)(a,o,w.Z,Je),c=(0,S.l)(a);(0,v.b)(l,l,(0,S.s)(Qe,c,c,c)),e.modelTransform=l,e.renderLocation=s.eval(.5,Qe)}(t,e,i,m)}))}_updateManipulatorStyle(e){const t=function(e){return(0,ae.Lz)(e)+4}(e),i=$e(e),n={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:r,heading:s,rotation:o}of this._computationManipulators.values())r.radius=i/2,s.update(n),o.update(n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_applyPointUpdate(e,t){const{view:i}=this,n=Z(e);"startPoint"in t&&(n.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(n.elevationAlignedEndPoint=t.endPoint);const r=G(n,i.renderCoordsHelper);if(null==r)return;const s=this._computeConstraint({...n,geometry:r});at(e,t,{...n,constraint:s,unconstrainedGeometry:r,view:i}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,Cn);const t=this.view.state.camera.computeScreenPixelSizeAt(Cn);e.dimension.offset=50*t}_computeConstraint(e){return function(e,t){if(ee(e))return et.Direct;if(!e.enabled)return null;const{geometry:i}=e;if(null==i||(0,S.h)(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{camera:n}=t.state,r=X(b.rq.get(),i,t.renderCoordsHelper),s=Y(b.rq.get(),i),o=(0,S.i)(b.rq.get(),r,(0,S.j)(s,r)),a=(0,S.f)(b.rq.get(),s,o),l=(0,S.m)(a),c=(0,S.m)(o),{startRenderSpace:d,endRenderSpace:u}=i.directSegment,h=Math.max(10*n.computeScreenPixelSizeAt(d),10*n.computeScreenPixelSizeAt(u))**2;return l<h?et.Vertical:c<h?et.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new Re.W({width:1,renderOccluded:Pe.m$.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){const e=e=>{var t;return null===(t=this.analysisViewData.computations.find((t=>{let{computation:i}=t;return i.dimension===e})))||void 0===t?void 0:t.computation};return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=Pe.m$.Occlude,this.manipulators.forEach((e=>{let{manipulator:t}=e;for(const{geometry:i}of t.renderObjects)i.material.setParameters({renderOccluded:Pe.m$.Occlude})}))},getManipulatorsForDimension:t=>this._computationManipulators.get(e(t)),getComputationForDimension:t=>e(t),getConstraintForDimension:t=>{const i=e(t);return null!=i?this._computeConstraint(i):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};(0,r._)([(0,d.MZ)({constructOnly:!0})],En.prototype,"analysis",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],En.prototype,"analysisViewData",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],En.prototype,"manipulators",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],En.prototype,"parentTool",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0,nonNullable:!0})],En.prototype,"view",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],En.prototype,"updating",null),(0,r._)([(0,d.MZ)()],En.prototype,"firstGrabbedManipulator",null),(0,r._)([(0,d.MZ)()],En.prototype,"hasGrabbedManipulators",null),(0,r._)([(0,d.MZ)()],En.prototype,"snappingOptions",null),(0,r._)([(0,d.MZ)()],En.prototype,"_stagedDimension",void 0),(0,r._)([(0,d.MZ)()],En.prototype,"_activeComputation",null),(0,r._)([(0,d.MZ)()],En.prototype,"_stagedComputation",null),En=(0,r._)([(0,u.$)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],En);const Cn=(0,w.c)();var Dn,An=i(29808),Ln=i(3112),zn=i(97822),Hn=i(82307),Vn=i(11500);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Dn||(Dn={}));let Zn=class extends zn.k{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,An.hz)(this.view.state.viewingMode),this._intersector.options.store=Ln.oH.MIN,this._lengthDimensionSubTool=new En({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.DQ)(this._lengthDimensionSubTool),(0,o.hA)((()=>this._clearPointerMoveTimeout())),(0,c.wB)((()=>this.state),(e=>{e===Dn.Created&&this.finishToolCreation()}),c.pc),(0,c.z7)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),c.pc),(0,c.wB)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.pc)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?null!=this._activeSubTool?Dn.Creating:Dn.Created:Dn.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(Hn.NE.cancel===e.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else Hn.NE.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,Vn.sC)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const i=this._intersector.results.min,n=b.rq.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.xt)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>e.manipulator.state|=Xe)),this._prevPointerMoveTimeout=re.p.setTimeout((()=>{this.manipulators.forEach((e=>e.manipulator.state&=~Xe))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:e=>{this._pointerMoveTimerMs=e,this._resetPointerMoveTimeout()}}}};(0,r._)([(0,d.MZ)({constructOnly:!0})],Zn.prototype,"view",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],Zn.prototype,"analysis",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],Zn.prototype,"state",null),(0,r._)([(0,d.MZ)({readOnly:!0})],Zn.prototype,"updating",null),(0,r._)([(0,d.MZ)({readOnly:!0})],Zn.prototype,"cursor",null),(0,r._)([(0,d.MZ)({constructOnly:!0})],Zn.prototype,"analysisViewData",void 0),(0,r._)([(0,d.MZ)()],Zn.prototype,"selectedDimension",null),(0,r._)([(0,d.MZ)()],Zn.prototype,"automaticManipulatorSelection",void 0),(0,r._)([(0,d.MZ)()],Zn.prototype,"_activeSubTool",void 0),(0,r._)([(0,d.MZ)()],Zn.prototype,"_lengthDimensionSubTool",void 0),Zn=(0,r._)([(0,u.$)("esri.views.3d.analysis.Dimension.DimensionTool")],Zn);i(11265);var Gn=i(11113),jn=i(11020),Fn=i(70667),qn=i(60561);class In extends ci.X{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=Pe.m$.OccludeAndTransparent,this._width=1,this._color=(0,ut.f)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const i=e.endRenderSpace;this.transform=(0,v.d)(Nn,i),this._normal=t;const{points:n}=e.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,null!=this._material&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(e){this._width=e,null!=this._material&&this._material.setParameters({width:e})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(e){this._color=(0,ut.c)(e),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.markerPrimitive)&&void 0!==e?e:this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,null!=this._material&&this._material.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new qn.i({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,Fn.z)(this.geometry,this.normal)){const i=(0,Fn.t)(this._material,t);e.addGeometry(i)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const Nn=(0,y.a)();class kn{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new it.A,this._messages=null,this._labelSegment=new O.C;const{analysis:t,computation:i,view:n,messages:r,isDecoration:s}=e;this.analysis=t,this.computation=i,this.view=n,this._messages=r;const o=e.visible,a={view:n,attached:o,isDecoration:s},{fontSize:l,textColor:d,textBackgroundColor:u}=t.style;this._visualElements=new Wn({marker:new In(a,e.markerMaterial),dimension:new li.t(a,e.dimensionLineMaterial),startOffset:new li.t(a,e.offsetLineMaterial),endOffset:new li.t(a,e.offsetLineMaterial),dimensionSmall:new li.t(a,e.smallDimensionLineMaterial),startOffsetSmall:new li.t(a,e.smallOffsetLineMaterial),endOffsetSmall:new li.t(a,e.smallOffsetLineMaterial),label:new jn.NB({view:n,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,ae.Lz)(l),textColor:d.clone(),backgroundColor:u.clone(),isDecoration:s})}),this._handles.add([(0,c.wB)((()=>i.geometry),(e=>{this.updateCameraDependentElements(n.state.camera,e,t.style),null!=i.geometry&&this._updateLines(i.geometry)}),{...c.Vh,equals:nt.aI}),(0,c.wB)((()=>i.length),(e=>this._updateLabelContent(e)),c.Vh)])}destroy(){this.destroyed=!0,this._handles=(0,l.pR)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=j(Un,F.Start,e.directSegment,e.dimensionSegment),i=j(Bn,F.End,e.directSegment,e.dimensionSegment),n=this._visualElements;n.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),n.dimension.setGeometryFromSegment(e.dimensionSegment),n.startOffset.setGeometryFromSegment(t),n.endOffset.setGeometryFromSegment(i),n.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),n.startOffsetSmall.setGeometryFromSegment(t),n.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(e,t,i){const n=this._visualElements;if(null==t){for(const e of n.values())e.visible=!1;return}const r=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,$n)),s=function(e,t){return(0,S.m)(Q(K,e))/t**2}(t,r),o=s<(2*(0,ae.Lz)(i.lineSize))**2,a=!o;n.marker.visible=a,n.dimension.visible=a,n.startOffset.visible=a,n.endOffset.visible=a,n.dimensionSmall.visible=o,n.startOffsetSmall.visible=o,n.endOffsetSmall.visible=o;const l=5*(0,ae.Lz)(i.fontSize),{label:c}=n;if(c.visible=s>=l**2,!c.visible)return;const{dimensionSegment:d,primaryOffsetAxis:u}=t,{offset:h}=this.computation.dimension,p=(Math.sign(h)>=0?1:-1)*this._labelOffsetPx(i)*r;(function(e,t,i,n){(0,S.q)(e.startRenderSpace,t.startRenderSpace,i,n),(0,S.q)(e.endRenderSpace,t.endRenderSpace,i,n)})(this._labelSegment,d,u,p),c.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,ae.Lz)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,Gn.zJ)(this._messages,e,e.unit):t.text=""}_labelOffsetPx(e){return 1.5*(0,ae.Lz)(e.fontSize)+20+(0,ae.Lz)(e.lineSize/2)}}const Un=new O.C,Bn=new O.C,$n=(0,w.c)();class Wn{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Xn=i(50125),Yn=i(38042),Qn=i(63860);let Jn=class extends s.A{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new qn.i({width:1,anchor:Xn.kJ.Tip,color:le.Z,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:Pe.m$.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new Re.W({width:1,color:le.Z,renderOccluded:Pe.m$.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new Re.W({width:1,color:le.Z,renderOccluded:Pe.m$.OccludeAndTransparent,stipplePattern:(0,vi.wk)(5),isDecoration:e}),this._smallDimensionLineMaterial=new Re.W({width:1,color:le.Z,renderOccluded:Pe.m$.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new Re.W({width:1,color:le.Z,renderOccluded:Pe.m$.OccludeAndTransparent,stipplePattern:(0,vi.wk)(5),isDecoration:e});for(const i of this._lineMaterials())this.view._stage.add(i),this.addHandles((0,o.hA)((()=>{var e;null===(e=this.view._stage)||void 0===e||e.remove(i)})));const t=(0,c.LF)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createVisualization(t)}));this._dimensionVisualizations=t,this.addHandles([(0,o.DQ)(t),(0,c.wB)((()=>se.A.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(e=>{const t=(0,ae.Lz)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const i=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:i})}),c.pc),(0,c.wB)((()=>({camera:this.view.state.camera,style:Kn(this.analysis)})),(e=>{let{camera:t,style:i}=e;for(const{visualization:n}of this._dimensionVisualizations)n.updateCameraDependentElements(t,n.computation.geometry,i),n.updateLabelStyle(i)})),(0,c.wB)((()=>this.visible),(e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e}))]),this.addHandles([(0,Yn.oQ)((()=>this._updateMessageBundle())),(0,c.z7)((()=>!this.loadingMessages),(()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)}),c.OH)]),this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map((e=>{let{visualization:t}=e;return t})),disablePartialOcclusion:()=>{for(const e of this._lineMaterials())e.setParameters({renderOccluded:Pe.m$.Occlude})}}}_createVisualization(e){const t=new kn({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,Qn.ud)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Kn(e){const{fontSize:t,lineSize:i,textColor:n,textBackgroundColor:r}=e.style;return{fontSize:t,lineSize:i,textBackgroundColor:r.clone(),textColor:n.clone()}}(0,r._)([(0,d.MZ)({constructOnly:!0})],Jn.prototype,"analysisViewData",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0,nonNullable:!0})],Jn.prototype,"view",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],Jn.prototype,"isDecoration",void 0),(0,r._)([(0,d.MZ)()],Jn.prototype,"analysis",null),(0,r._)([(0,d.MZ)()],Jn.prototype,"visible",null),(0,r._)([(0,d.MZ)()],Jn.prototype,"loadingMessages",void 0),Jn=(0,r._)([(0,u.$)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Jn);let er=class extends s.A{constructor(e){super(e),this.dimension=null,this.length=null}};(0,r._)([(0,d.MZ)({constructOnly:!0,nonNullable:!0})],er.prototype,"dimension",void 0),(0,r._)([(0,d.MZ)()],er.prototype,"length",void 0),er=(0,r._)([(0,u.$)("esri.views.3d.analysis.LengthDimensionResult")],er);const tr=er;let ir=class extends s.A{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...i}=e;return{result:new tr({dimension:t}),...i}}initialize(){this.addHandles([(0,c.wB)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),c.pc),(0,c.wB)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),c.pc)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,r._)([(0,d.MZ)({constructOnly:!0,nonNullable:!0})],ir.prototype,"result",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0,nonNullable:!0})],ir.prototype,"projectAndAlignPoint",void 0),(0,r._)([(0,d.MZ)()],ir.prototype,"dimension",null),(0,r._)([(0,d.MZ)()],ir.prototype,"length",null),(0,r._)([(0,d.MZ)()],ir.prototype,"geometry",void 0),(0,r._)([(0,d.MZ)()],ir.prototype,"unconstrainedGeometry",void 0),(0,r._)([(0,d.MZ)()],ir.prototype,"elevationAlignedStartPoint",void 0),(0,r._)([(0,d.MZ)()],ir.prototype,"elevationAlignedEndPoint",void 0),(0,r._)([(0,d.MZ)()],ir.prototype,"preConstraintProperties",void 0),(0,r._)([(0,d.MZ)()],ir.prototype,"previousConstraint",void 0),ir=(0,r._)([(0,u.$)("esri.views.3d.analysis.LengthDimensionComputation")],ir);var nr=i(17430),rr=i(10260);const sr=e=>{let t=class extends e{constructor(){super(...arguments),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new bi.A}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,r._)([(0,d.MZ)({constructOnly:!0})],t.prototype,"view",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,r._)([(0,d.MZ)()],t.prototype,"tool",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],t.prototype,"results",null),(0,r._)([(0,d.MZ)()],t.prototype,"selectedDimension",void 0),(0,r._)([(0,d.MZ)()],t.prototype,"interactive",void 0),(0,r._)([(0,d.MZ)()],t.prototype,"visible",void 0),t=(0,r._)([(0,u.$)("esri.views.analysis.DimensionAnalysisView")],t),t};let or=class extends(sr((0,h.P)(s.A))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:i}=this.view,n=(0,nr.B)(e,t,i);return null==n&&(0,nr.V)(this.analysis,e.spatialReference,a.A.getLogger(this)),n};const e=(0,c.LF)((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([(0,rr.Hd)(this,Zn),(0,o.DQ)(e)]),this._analysisVisualization=new Jn({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new ne({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.DC)(this._placementTask),this._analysisVisualization=(0,l.pR)(this._analysisVisualization),(0,rr.aS)(this)}get updating(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,l.DC)(this._placementTask),this._placementTask=(0,rr.JY)(this,e),this._placementTask.promise}_createComputation(e){const{_dimensionsToComputations:t}=this,i=new ir({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,i),{computation:i,remove:()=>this._removeComputation(i)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,r._)([(0,d.MZ)({readOnly:!0})],or.prototype,"type",void 0),(0,r._)([(0,d.MZ)()],or.prototype,"tool",void 0),(0,r._)([(0,d.MZ)()],or.prototype,"updating",null),(0,r._)([(0,d.MZ)({readOnly:!0})],or.prototype,"results",null),(0,r._)([(0,d.MZ)()],or.prototype,"computations",void 0),(0,r._)([(0,d.MZ)()],or.prototype,"selectedDimension",void 0),(0,r._)([(0,d.MZ)()],or.prototype,"selectedComputation",null),(0,r._)([(0,d.MZ)()],or.prototype,"_analysisVisualization",void 0),(0,r._)([(0,d.MZ)()],or.prototype,"_analysisController",void 0),(0,r._)([(0,d.MZ)()],or.prototype,"_dimensionsToComputations",void 0),(0,r._)([(0,d.MZ)()],or.prototype,"_placementTask",void 0),or=(0,r._)([(0,u.$)("esri.views.3d.analysis.DimensionAnalysisView3D")],or);const ar=or},85746:(e,t,i)=>{i.d(t,{X:()=>y});var n=i(35143),r=i(91967),s=i(5632),o=i(46053),a=(i(40565),i(18690),i(81806),i(85842)),l=i(57662),c=i(57824),d=i(44513);class u{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const i=null===(t=this._resources)||void 0===t?void 0:t.layerView;i&&(i.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this._resourceFactory.createResources(),i=new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),n=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:t,geometriesAdded:!1},n&&(this._resources.drapeSourceRenderer=n.registerGeometryDrapeSource(i)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const t=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!0))}}let h=class extends((0,s.sA)(r.A)){constructor(e){super(e),this.drapeSourceType=l.Om.Features,this.updatePolicy=d.q.SYNC,this.renderGroup=l.O7.Outline}};(0,n._)([(0,o.MZ)({constructOnly:!0})],h.prototype,"view",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],h.prototype,"drapeSourceType",void 0),(0,n._)([(0,o.MZ)()],h.prototype,"renderGroup",void 0),h=(0,n._)([(0,a.$)("DrapedVisualElementLayerView")],h);var p=i(69230),f=i(68134),_=i(87634),m=i(37046),g=i(8918);class v{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==_.X.Mesh&&t.type!==_.X.Line&&t.type!==_.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==_.X.Mesh&&t.type!==_.X.Line&&t.type!==_.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const n=new g.x(i,{pickable:!1,updatePolicy:d.q.SYNC}),r=new m.B({castShadow:!1}),s=e.createResources(r,n);s.forEach((e=>{i.add(e),e.type===_.X.Texture&&e.load(i.renderView.renderingContext)})),i.add(r),n.add(r);const o=e.cameraChanged,a=o?(0,f.wB)((()=>t.state.camera),(e=>o(e)),f.Vh):null;this._resources={layer:n,object:r,external:s,cameraHandle:a},this._syncVisible()}_destroyResources(){var e;if(null==this._resources)return;const t=this._resourceFactory.view._stage;t&&(t.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((e=>{t.remove(e),e.type===_.X.Texture&&e.unload()}))),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class y extends p.B{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new v(this.createObject3DResourceFactory(e.view)),this.drapedResources=new u(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},47996:(e,t,i)=>{i.d(t,{n:()=>M});var n=i(68134),r=i(95941),s=i(23209),o=i(45136),a=i(83670),l=i(11461),c=i(83529),d=i(75762),u=i(18117),h=i(85746),p=i(33169),f=i(50468),_=i(51799),m=i(62577),g=i(45463),v=i(442),y=i(66470),S=i(76956),w=i(425);class M extends h.X{constructor(e){super(e),this._maxSize=0,this._position=(0,a.c)(),this._up=(0,a.c)(),this._right=(0,a.c)(),this._renderOccluded=g.m$.OccludeAndTransparent,this._color=(0,c.f)(1,0,0,1),this._outlineColor=(0,c.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=g.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,l.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,l.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:i,next:n}=e;this._maxSize=Math.min((0,o.o)(i,t),(0,o.o)(i,n))/3,(0,o.n)(this._up,(0,o.f)(this._up,t,i)),(0,o.n)(this._right,(0,o.f)(this._right,n,i)),(0,o.c)(this._position,i),this.recreateGeometry()}_createObject3DResources(e){const t=new S.v(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new w.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_createObject3DGeometries(e,t,i){if((0,o.h)(this._up,a.Z)&&(0,o.h)(this._right,a.Z))return;const n=this._createGeometries(t,i);for(const r of n)e.addGeometry(r);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new S.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new w.W(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new v.$(e)));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,n.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:i,right:n,corner:r}=this._getVertices(),s=this._quadGeometryData(i,n,r,e);return t?[s,(0,m.Z8)(t,[i,r,n])]:[s]}_getVertices(){let e=this._up,t=this._right;const i=(0,o.g)(d.rq.get(),e,t);return this.isDraped&&(e=(0,o.c)(d.rq.get(),e),t=(0,o.c)(d.rq.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,r.d)(b,this._position),(0,r.b)(b,b,[n,n,n]),e.transformation=b}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:n,_size:s}=this,a=(0,o.c)(d.rq.get(),n);a[2]=p.bi;const l=P;l.spatialReference=t.renderer.spatialReference,l.x=a[0],l.y=a[1];const c=s*(this.view.overlayPixelSizeInMapUnits(l)*i),u=Math.min(this._maxSize,c);(0,r.d)(b,a),(0,r.b)(b,b,[u,u,1]);for(const r of e)r.transformation=b}_quadGeometryData(e,t,i,n){return new _.V(n,[[y.r.POSITION,new f.n([0,0,0,...t,...e,...i],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&null!==(e=e.outlineMaterial)&&void 0!==e&&e.setParameters(this._outlineMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||null===(t=t.outlineMaterial)||void 0===t||t.setParameters(this._outlineMaterialParameters)}}const b=(0,s.a)(),P=(0,u.T)(0,0,void 0,null)},82307:(e,t,i)=>{i.d(t,{NE:()=>n,fn:()=>r});const n={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},r={toggle:"Control"}},75543:(e,t,i)=>{i.d(t,{FX:()=>A,Mn:()=>g,WG:()=>L,ej:()=>S,en:()=>H,i7:()=>_});var n=i(18690),r=i(52007),s=i(9711),o=i(45136),a=i(83670),l=i(13927),c=i(95925),d=i(93582),u=i(23862),h=i(79337),p=i(74050);class f{intersect(e){return V(this,e)}closestPoints(e){return[this.closestTo(e)]}}class _ extends f{constructor(e){super(),this.point=e}equals(e){return this===e||X(e)&&(0,o.h)(this.point,e.point)}closestTo(){return(0,u.o8)(this.point)}}class m extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||Y(e)&&this.lineLike.type===e.lineLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){const t=(0,h.Yv)(e,this.lineLike);return(0,u._7)(t)}}class g extends m{constructor(e,t){super(e,t,p.Vv.LINE)}}class v extends m{constructor(e,t){super(e,t,p.Vv.RAY)}}class y extends f{constructor(e){super(),this.constraints=e}equals(e){return this===e||W(e)&&(0,n.aI)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,i=1/0;for(const n of this.constraints){const r=n.closestTo(e),s=(0,o.a)(e,r);s<i&&(i=s,t=r)}return t?(0,u.o8)(t):e}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class S extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||K(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,h.Nm)(e,this.center,this.radius);return(0,u._7)(t)}}class w extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ee(e)&&(0,o.h)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,h.Nm)(e,this.center,this.radius);return t[2]=this.center[2],(0,u._7)(t)}asCircle(){return new M((0,u.o8)(this.center),this.radius,(0,u.fA)(0,0,1))}}class M extends f{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=n}equals(e){return this===e||te(e)&&(0,o.h)(this.center,e.center)&&(0,o.h)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;(0,l._I)(this.getPlane(P),e,b);const n=(0,o.u)(b,b,t),r=(0,o.m)(n);if((0,h.Zj)(r,0))return(0,u.o8)(e);const s=i/Math.sqrt(r),c=(0,o.q)((0,a.c)(),t,n,s),{slicePlane:d}=this;if(d&&!(0,h.F2)(d,c)){var p;const t=G(d,this);return null!==(p=null===t||void 0===t?void 0:t.closestTo(e))&&void 0!==p?p:(0,u.o8)(e)}return(0,u._7)(c)}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.vt)();return(0,l.O_)(this.center,this.normal,e)}}const b=(0,a.c)(),P=(0,l.vt)();class x extends f{constructor(e){super(),this.z=e}equals(e){return this===e||Q(e)&&this.z===e.z}closestTo(e){return(0,u._7)((0,a.f)(e[0],e[1],this.z))}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.vt)();return(0,o.s)(O,0,0,this.z),(0,l.O_)(O,a.d,e)}}const O=(0,a.c)();class R extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:i}}equals(e){return this===e||J(e)&&this.planeLike.type===e.planeLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){return(0,u._7)((0,h.r2)(e,this.planeLike))}closestEndTo(e){const{start:t,end:i}=this;return Math.sign((0,r.g)((0,r.c)(T,i,t),(0,r.c)(E,e,t)))>0?i:t}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.vt)();const t=(0,o.c)(C,this.end);return t[2]+=1,(0,l.Cr)(this.start,this.end,t,e)}getSlicePlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.vt)();const{start:t,end:i,type:n}=this.planeLike;if(n===h.pJ.PLANE)return;const r=(0,o.s)(C,t[0],t[1],0),s=(0,o.s)(D,i[0],i[1],0),a=(0,o.f)(D,s,r);return(0,l.O_)(r,a,e),e}}const T=(0,s.a)(),E=(0,s.a)(),C=(0,a.c)(),D=(0,a.c)();class A extends R{constructor(e,t){super(e,t,h.pJ.HALF_PLANE)}}class L extends R{constructor(e,t){super(e,t,h.pJ.PLANE)}}class z extends f{constructor(e,t){super(),this.sphere=(0,d.k)(e,t)}equals(e){return this===e||ie(e)&&(0,d.l)(this.sphere,e.sphere)}closestTo(e){const t=(0,d.p)(this.sphere,e,(0,a.c)());return(0,u._7)(t)}get center(){return this.sphere}get radius(){return this.sphere[3]}}class H extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:e,end:t,type:h.pJ.PLANE}}equals(e){return this===e||ne(e)&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){var i;const n=(0,h.r2)(t,e.planeLike);return n[2]=null!==(i=e.getZ(n[0],n[1]))&&void 0!==i?i:re,(0,u._7)(n)}(this,e)}addIfOnTheGround(e,t){for(const n of t){var i;const t=null!==(i=this.getZ(n[0],n[1]))&&void 0!==i?i:0;(0,h.Zj)(n[2],t)&&(n[2]=t,e.push(n))}}}function V(e,t){if(W(e)){const i=[];for(const n of e.constraints){const e=n.intersect(t);e&&i.push(e)}return $(i)}if(W(t))return V(t,e);if(ne(e))return N(e,t);if(ne(t))return N(t,e);if(X(e)){const{point:i}=e,n=t.closestTo(i);return(0,o.G)(n,i)?e:void 0}if(Y(e)){if(X(t))return V(t,e);if(Y(t))return U((0,h.SO)(e.lineLike,t.lineLike));if(Q(t))return Z(e,t);if(J(t))return U((0,h.Mc)(t.planeLike,e.lineLike));if(K(t))return U((0,h.K4)(e.lineLike,t.center,t.radius));if(te(t))return U((0,h.IB)(e.lineLike,t));if(ee(t))return function(e,t){let{lineLike:i}=e,{center:n,radius:r}=t;const s=n[2];return U((0,h.K4)(i,n,r).filter((e=>(0,h.Zj)(e[2],s))))}(e,t);if(ie(t))return function(e,t){let{lineLike:i}=e,{sphere:n}=t;return U((0,d.m)(n,i.start,i.end))}(e,t)}else if(Q(e)){if(X(t)||Y(t))return V(t,e);if(Q(t))return function(e,t){return(0,h.Zj)(e.z,t.z)?e:void 0}(e,t);if(J(t))return function(e,t){let{z:i}=e,{planeLike:n}=t;const[r,s]=n.start,[o,a]=n.end,l=(0,u.fA)(r,s,i),c=(0,u.fA)(o,a,i);return n.type===h.pJ.PLANE?new g(l,c):new v(l,c)}(e,t);if(K(t))return function(e,t){const[i,n]=t.center;return new w((0,u.fA)(i,n,e.z),t.radius)}(e,t);if(te(t))return j(e,t);if(ee(t))return function(e,t){return(0,h.Zj)(t.center[2],e.z)?t:void 0}(e,t);if(ie(t))return function(e,t){let{center:i,radius:n}=t;const r=Math.abs(i[2]-e.z);if(r>n&&!(0,h.Zj)(r,n))return;const s=(0,u.fA)(i[0],i[1],e.z),o=Math.sqrt(n**2-r**2);return(0,h.Zj)(o,0)?void 0:new w(s,o)}(e,t)}else if(J(e)){if(X(t)||Y(t)||Q(t))return V(t,e);if(J(t))return k((0,h.b_)(e.planeLike,t.planeLike));if(K(t))return k((0,h.Bn)(e.planeLike,t.center,t.radius));if(te(t))return q(e,t);if(ee(t))return F(e,t);if(ie(t))return I(e,t)}else if(K(e)){if(X(t)||Y(t)||Q(t)||J(t))return V(t,e);if(K(t))return k((0,h.t1)(e.center,e.radius,t.center,t.radius));if(te(t))return;if(ee(t))return function(e,t){const i=(0,r.k)(e.center,t.center);return(0,h.Zj)(i,0)&&(0,h.Zj)(e.radius,t.radius)?t:B((0,h.t1)(e.center,e.radius,t.center,t.radius),t.center[2])}(e,t);if(ie(t))return}else if(te(e)){if(X(t)||Y(t)||Q(t)||J(t)||K(t))return V(t,e);if(te(t))return;if(ee(t))return void t.asCircle();if(ie(t))return}else if(ee(e)){if(X(t)||Y(t)||Q(t)||J(t)||K(t)||te(t))return V(t,e);if(ee(t))return function(e,t){if(!(0,h.HG)(e.center,t.center))return;const i=(0,r.k)(e.center,t.center);return(0,h.Zj)(i,0)&&(0,h.Zj)(e.radius,t.radius)?e:B((0,h.t1)(e.center,e.radius,t.center,t.radius),e.center[2])}(t,e);if(ie(t))return}else if(ie(e)){if(X(t)||Y(t)||Q(t)||J(t)||K(t)||ee(t))return V(t,e);if(ie(t))return}}const Z=(()=>{const e=(0,l.vt)();return(t,i)=>{const{start:n,end:r}=t;if((0,h.HG)(n,r)&&(0,h.Zj)(n[2],i.z))return t;const s=(0,a.c)();return(0,l.U5)(i.getPlane(e),n,r,s)?new _((0,u._7)(s)):void 0}})();const G=(()=>{const e=(0,c.vt)(),t=(0,l.vt)(),i={start:(0,a.c)(),end:(0,a.c)(),type:p.Vv.LINE};return(n,r,s)=>{const{normal:c,center:d,radius:p}=r,f=(0,o.j)(c,(0,l.qb)(n)),m=(0,h.Zj)((0,l.Io)(n,d),0);if((0,h.Zj)(f,1))return m?r:void 0;if(r.getPlane(t),m&&(0,h.Zj)(f,0)&&(0,l.fk)(n)&&(0,l.fk)(t)){if((0,h.Zj)(p,0))return!s||(0,h.F2)(s,d)?new _((0,u.o8)(d)):void 0;const e=(0,a.g)(d);e[2]+=p;const t=(0,a.g)(d);t[2]-=p;const i=[];return s&&!(0,h.F2)(s,e)||i.push(e),s&&!(0,h.F2)(s,t)||i.push(t),U(i)}if(!(0,l.Ji)(n,t,e))return;(0,o.c)(i.start,e.origin),(0,o.g)(i.end,e.origin,e.direction);const g=(0,h.IB)(i,r);return U(s?(0,h.UL)(s,g):g)}})();const j=(()=>{const e=(0,l.vt)();return(t,i)=>G(t.getPlane(e),i)})();const F=(()=>{const e=(0,l.vt)();return(t,i)=>{let{center:n,radius:r}=i;const s=(0,h.Bn)(t.planeLike,n,r),o=n[2];t.getSlicePlane(e);const a=[];for(const[l,c]of s){const t=[l,c,o];(0,h.F2)(e,t)&&a.push(t)}return U(a)}})(),q=(()=>{const e=(0,l.vt)(),t=(0,l.vt)();return(i,n)=>G(i.getPlane(e),n,i.getSlicePlane(t))})(),I=(()=>{const e=(0,l.vt)();return(t,i)=>{let{center:n,radius:r}=i;const s=t.getPlane(e),c=(0,l.mN)(s,n),d=Math.abs(c);if(d>r&&!(0,h.Zj)(d,r))return;const p=(0,a.g)((0,l.qb)(s)),f=(0,o.q)((0,a.c)(),n,p,c),m=Math.sqrt(r**2-c**2);return(0,h.Zj)(m,0)?new _((0,u._7)((0,l._I)(s,n,(0,a.c)()))):new M((0,u._7)(f),m,p,t.getSlicePlane())}})();function N(e,t){const{planeLike:i,getZ:n}=e,r=[];if(X(t))e.addIfOnTheGround(r,(0,h.VT)(i,t.point));else if(Y(t))e.addIfOnTheGround(r,(0,h.Mc)(i,t.lineLike));else if(K(t))for(const[o,l]of(0,h.Bn)(i,t.center,t.radius)){const e=n(o,l);null!=e&&r.push((0,a.f)(o,l,e))}else if(J(t)||ne(t))for(const[o,l]of(0,h.b_)(i,t.planeLike)){var s;const e=null!==(s=n(o,l))&&void 0!==s?s:re;r.push((0,a.f)(o,l,e))}return U(r)}function k(e){return $(e.map((e=>{let[t,i]=e;const n=(0,u.fA)(t,i,0),r=(0,u.fA)(t,i,1);return new g(n,r)})))}function U(e){return $(e.map((e=>e?new _((0,u._7)(e)):void 0)))}function B(e,t){return U(e.map((e=>{let[i,n]=e;return[i,n,t]})))}function $(e){var t;if(0!==e.length)return 1===e.length?null!==(t=e[0])&&void 0!==t?t:void 0:new y(e.filter(n.Ru))}function W(e){return e instanceof y}function X(e){return e instanceof _}function Y(e){return e instanceof m}function Q(e){return e instanceof x}function J(e){return e instanceof R}function K(e){return e instanceof S}function ee(e){return e instanceof w}function te(e){return e instanceof M}function ie(e){return e instanceof z}function ne(e){return e instanceof H}const re=0},23862:(e,t,i)=>{i.d(t,{Lp:()=>d,_7:()=>a,fA:()=>l,io:()=>h,o8:()=>c,vf:()=>u,vt:()=>o});var n=i(83670),r=i(18117),s=i(12482);function o(e,t,i){return(0,n.f)(e,t,i)}function a(e){return e}function l(e,t,i){return(0,n.f)(e,t,i)}function c(e){return(0,n.g)(e)}function d(e,t,i){let{coordinateHelper:n,elevationInfo:r}=i;return e?u(n.vectorToDehydratedPoint(e,p),t,r):null}function u(e,t,i){var r,o;if(null==e)return null;if(null==t)return(0,n.f)(e.x,e.y,null!==(r=e.z)&&void 0!==r?r:0);if("2d"===t.type)return(0,n.f)(e.x,e.y,0);const a=null!==(o=(0,s.wS)(t,e,i,s.qt))&&void 0!==o?o:0;return(0,n.f)(e.x,e.y,a)}function h(e,t){return(0,r.T)(e[0],e[1],e[2],t)}const p=(0,r.T)(0,0,0,null)},99791:(e,t,i)=>{var n;i.d(t,{n:()=>n}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(n||(n={}))},80794:(e,t,i)=>{i.d(t,{X:()=>a});var n=i(75543),r=i(70330),s=i(61751),o=i(23543);class a extends s.w{constructor(e){super({...e,isDraped:!0,constraint:new n.en(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.c(r.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},9876:(e,t,i)=>{i.d(t,{z:()=>a});var n=i(75543),r=i(70330),s=i(61751),o=i(23543);class a extends s.w{constructor(e){super({...e,constraint:new n.Mn(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.c(r.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},61751:(e,t,i)=>{i.d(t,{w:()=>s});var n=i(99791),r=i(30003);class s extends r.C{constructor(e){let{targetPoint:t,objectId:i,constraint:r,isDraped:s}=e;super(t,r,s,n.n.FEATURE),this.objectId=i}}},30003:(e,t,i)=>{i.d(t,{C:()=>n});class n{constructor(e,t,i,n){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=n}}},23543:(e,t,i)=>{i.d(t,{c:()=>o});i(81806),i(76460);var n=i(45136),r=i(99791),s=i(64753);class o extends s.m{constructor(e,t,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.n.ALL,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(n,s),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,n.h)(this.lineStart,e.lineStart)&&(0,n.h)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,n.o)(this.lineStart,this.lineEnd)}}},23241:(e,t,i)=>{i.d(t,{_:()=>s});var n=i(45136),r=i(64753);class s extends r.m{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof s&&(0,n.h)(this.point,e.point)}}},64753:(e,t,i)=>{i.d(t,{m:()=>n});class n{constructor(e,t){this.isDraped=e,this.domain=t}}},70330:(e,t,i)=>{i.d(t,{BY:()=>w,H3:()=>n,HN:()=>S,Mo:()=>m,Tu:()=>M,is:()=>y,nf:()=>v,pM:()=>_,xX:()=>g});var n,r,s=i(68134),o=i(41289),a=i(34154),l=i(18288),c=i(45136),d=i(18117),u=i(68295),h=i(57308),p=i(82307),f=i(23862);function _(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function m(e,t){return Math.sqrt(_(e,t))}function g(e,t){t.sort(((t,i)=>(0,c.a)(t.targetPoint,e)-(0,c.a)(i.targetPoint,e)))}function v(e,t,i){let{point:n,distance:r,returnEdge:s,vertexMode:c,coordinateHelper:{spatialReference:h},filter:p}=e;return i=null!=i?i.clone():new u.A({where:"1=1"}),p&&(i.geometry=p.geometry,i.distance=p.distance,i.spatialRelationship=p.spatialRelationship,i.where=(0,a.m)(i.where,p.where),i.timeExtent=(0,l.pJ)(i.timeExtent,p.timeExtent),i.objectIds=function(e,t){return e||t?t?e?Array.from((0,o.E$)(new Set(e),new Set(t))):t:e:null}(i.objectIds,p.objectIds)),{point:(0,d.T)(n[0],n[1],n[2],h.toJSON()),mode:t,distance:r,returnEdge:s,vertexMode:c,query:i.toJSON()}}function y(e,t,i){return{left:(0,f.Lp)(e.leftVertex.pos,t,i),right:(0,f.Lp)(e.rightVertex.pos,t,i)}}function S(e){return e.createQuery()}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};const i=(0,s.wB)((()=>({view:e.view,snappingOptions:e.snappingOptions})),(i=>{let{view:n,snappingOptions:r}=i;const s="snapping-toggle",o=h.o.TOOL;if(e.removeHandles(s),n&&null!=r){const i=[n.on("key-down",(e=>{e.key!==p.fn.toggle||e.repeat||(r.enabledToggled=!0,t())}),o),n.on("key-up",(e=>{e.key===p.fn.toggle&&(r.enabledToggled=!1,t())}),o),n.on("pointer-move",(e=>{const i=e.native.ctrlKey;r.enabledToggled!==i&&(r.enabledToggled=i,t())}),o)];e.addHandles(i,s)}}),s.pc);e.addHandles(i)}function M(e){var t;return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass&&"utilityNetworks"in e&&!(null===e||void 0===e||null===(t=e.utilityNetworks)||void 0===t||!t.length)}(r=n||(n={}))[r.TARGET=0]="TARGET",r[r.REFERENCE=1]="REFERENCE",r[r.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"},79337:(e,t,i)=>{i.d(t,{Bn:()=>u,F2:()=>O,HG:()=>b,IB:()=>v,K4:()=>y,Mc:()=>h,Nm:()=>m,SO:()=>S,UL:()=>x,VT:()=>p,Yv:()=>g,Zj:()=>P,b_:()=>f,pJ:()=>R,r2:()=>_,t1:()=>w});var n=i(15941),r=i(52007),s=i(9711),o=i(45136),a=i(83670),l=i(13927),c=i(94966),d=i(74050);function u(e,t,i){let{start:n,end:o,type:a}=e;const l=[],c=(0,r.c)(A,o,n),d=(0,r.c)(L,n,t),u=(0,r.v)(c),h=2*(0,r.g)(c,d),p=h*h-4*u*((0,r.v)(d)-i*i);if(0===p){const e=-h/(2*u);(a===R.PLANE||e>=0)&&l.push((0,r.w)((0,s.a)(),n,c,e))}else if(p>0){const e=Math.sqrt(p),t=(-h+e)/(2*u);(a===R.PLANE||t>=0)&&l.push((0,r.w)((0,s.a)(),n,c,t));const i=(-h-e)/(2*u);(a===R.PLANE||i>=0)&&l.push((0,r.w)((0,s.a)(),n,c,i))}return l}function h(e,t){const i=e.start,n=e.end,s=(0,r.c)(A,n,i),l=(0,o.s)(L,-s[1],s[0],0),c=t.start,u=t.end,h=(0,o.u)(z,u,c),p=(0,o.j)(h,l),f=(0,o.s)(H,i[0],i[1],0),_=(0,o.u)(V,f,c),m=(0,o.j)(_,l);if(Math.abs(p)<E)return Math.abs(m),[];const g=(0,o.q)(Z,c,h,m/p);if(t.type===d.Vv.RAY){const e=(0,o.u)(G,g,c);if((0,o.j)(e,h)<-E)return[]}if(e.type===R.HALF_PLANE){const e=(0,r.b)(G,g,i);if((0,r.g)(e,s)<-E)return[]}return[(0,a.g)(g)]}function p(e,t){return function(e,t){let{start:i,end:n,type:r}=e;const s=(0,o.u)(A,t,i),l=(0,o.u)(L,n,i),c=(0,o.b)(z,l,s);if((0,o.F)(c)/(0,o.F)(l)<E)switch(r){case d.Vv.LINE:return[(0,a.g)(t)];case d.Vv.RAY:return(0,o.j)(l,s)<-E?[]:[(0,a.g)(t)]}return[]}(M(F,t[2],e),t)}function f(e,t){const i=S(M(F,0,e),M(q,0,t)),n=[];for(const r of i)n.push((0,s.d)(r));return n}function _(e,t){return g(e,M(F,e[2],t))}function m(e,t,i){const n=(0,r.c)(A,e,t),s=i/(0,r.h)(n),o=(0,r.w)((0,a.c)(),t,n,s);return o[2]=e[2],o}function g(e,t){let{start:i,end:n,type:r}=t;const s=(0,o.u)(A,e,i),l=(0,o.u)(L,n,i),c=(0,o.j)(s,l)/(0,o.j)(l,l);return(0,o.q)((0,a.c)(),i,l,r===d.Vv.RAY?Math.max(c,0):c)}const v=(()=>{const e=(0,a.c)(),t=(0,a.c)(),i=(0,a.c)();return(n,u)=>{let{start:h,end:p}=n,{center:f,radius:_,normal:m,slicePlane:g}=u;const v=(0,a.c)(),y=(0,l.O_)(f,m,j);if(P((0,l.Io)(y,h),0)&&P((0,l.Io)(y,p),0)){(0,c.VV)(m,e,t);const n=(n,s)=>((0,o.f)(i,s,f),(0,r.s)(n,(0,o.j)(i,e),(0,o.j)(i,t)),n),l=(0,d.IB)({start:n(C,h),end:n(D,p),type:d.Vv.LINE},s.Z,_),u=[];for(const[i,r]of l){const n=(0,o.c)((0,a.c)(),f);(0,o.q)(n,n,e,i),(0,o.q)(n,n,t,r),g&&!O(g,n)||u.push(n)}return u}return(0,l.U5)(y,h,p,v)?!P((0,o.o)(v,f),_)||g&&!O(g,v)?[]:[v]:[]}})();function y(e,t,i){let{start:n,end:s,type:l}=e;const c=[],u=(0,o.f)(A,s,n),h=(0,r.c)(L,n,t),p=(0,r.v)(u),f=2*(0,r.g)(u,h),_=f*f-4*p*((0,r.v)(h)-i*i);if(0===_){const e=-f/(2*p);(l===d.Vv.LINE||e>=0)&&c.push((0,o.q)((0,a.c)(),n,u,e))}else if(_>0){const e=Math.sqrt(_),t=(-f+e)/(2*p);(l===d.Vv.LINE||t>=0)&&c.push((0,o.q)((0,a.c)(),n,u,t));const i=(-f-e)/(2*p);(l===d.Vv.LINE||i>=0)&&c.push((0,o.q)((0,a.c)(),n,u,i))}return c}function S(e,t){const i=e.start,r=e.end,s=t.start,l=t.end,c=(0,o.u)(A,r,i),u=(0,o.u)(L,l,s),h=(0,o.u)(z,s,i),p=(0,o.b)(H,c,u),f=(0,o.j)(h,p);if(!(0,n.Sp)(f,0,E))return[];const _=(0,o.F)(p);if((0,n.Sp)(_,0,E))return[];const m=(0,o.b)(V,h,u),g=(0,o.j)(m,p)/_,v=(0,o.q)(Z,i,c,g);if(e.type===d.Vv.RAY){const e=(0,o.u)(G,v,i);if((0,o.j)(c,e)<-E)return[]}if(t.type===d.Vv.RAY){const e=(0,o.u)(G,v,s);if((0,o.j)(u,e)<-E)return[]}return[(0,a.g)(v)]}function w(e,t,i,n){const[o,a]=e,[l,c]=i,d=l-o,u=c-a,h=d*d+u*u,p=Math.sqrt(h);if(p>t+n)return[];if(p<Math.abs(t-n))return[];if(P(p,0)&&P(t,n))return[];const f=(t*t-n*n+h)/(2*p),_=Math.sqrt(t*t-f*f),m=_*u/p,g=_*d/p,[v,y]=(0,r.l)(C,e,i,f/p);return P(m,g)?[(0,s.f)(v,y)]:[(0,s.f)(v+m,y-g),(0,s.f)(v-m,y+g)]}function M(e,t,i){let{start:n,end:r,type:s}=i;return(0,o.s)(e.start,n[0],n[1],t),(0,o.s)(e.end,r[0],r[1],t),e.type=T[s],e}function b(e,t){return P(e[2],t[2])}function P(e,t){return Math.abs(e-t)<E}function x(e,t){return t.filter((t=>O(e,t)))}function O(e,t){return(0,l.Tj)(e,t)}var R;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(R||(R={}));const T={[R.PLANE]:d.Vv.LINE,[R.HALF_PLANE]:d.Vv.RAY},E=1e-6,C=(0,s.a)(),D=(0,s.a)(),A=(0,a.c)(),L=(0,a.c)(),z=(0,a.c)(),H=(0,a.c)(),V=(0,a.c)(),Z=(0,a.c)(),G=(0,a.c)(),j=(0,l.vt)(),F={start:(0,a.c)(),end:(0,a.c)(),type:d.Vv.LINE},q={start:(0,a.c)(),end:(0,a.c)(),type:d.Vv.LINE}}}]);
//# sourceMappingURL=7884.18e1b893.chunk.js.map