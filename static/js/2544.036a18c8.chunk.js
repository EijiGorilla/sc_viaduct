"use strict";(self.webpackChunksc_viaduct=self.webpackChunksc_viaduct||[]).push([[2544],{62544:(e,r,a)=>{a.r(r),a.d(r,{fromUrl:()=>v});var t=a(50076),l=a(90534),n=a(13096),s=a(39323),o=a(11668),i=a(31933),u=a(62487),c=a(67061);const y={FeatureLayer:!0,SceneLayer:!0};async function v(e){var r;const u=null===(r=e.properties)||void 0===r?void 0:r.customParameters,v=await async function(e,r){let a=(0,n.qg)(e);if(null==a&&(a=await async function(e,r){var a,t;const s=await(0,c.V)(e,{customParameters:r});let o=null,i=null;const u=s.type;if("Feature Layer"===u||"Table"===u?(o="FeatureServer",i=null!==(a=s.id)&&void 0!==a?a:null):"indexedVector"===u?o="VectorTileServer":s.hasOwnProperty("mapName")?o="MapServer":s.hasOwnProperty("bandCount")&&s.hasOwnProperty("pixelSizeX")?o="ImageServer":s.hasOwnProperty("maxRecordCount")&&s.hasOwnProperty("allowGeometryUpdates")?o="FeatureServer":s.hasOwnProperty("streamUrls")?o="StreamServer":f(s)?(o="SceneServer",i=s.id):s.hasOwnProperty("layers")&&f(null===(t=s.layers)||void 0===t?void 0:t[0])&&(o="SceneServer"),!o)return null;const y=null!=i?(0,n.iz)(e):null;return{title:null!=y&&s.name||(0,l.e7)(e),serverType:o,sublayer:i,url:{path:null!=y?y.serviceUrl:(0,l.An)(e).path}}}(e,r)),null==a)throw new t.A("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:u,sublayer:v}=a;let d;const m={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"},b="FeatureServer"===u,w="SceneServer"===u,S={parsedUrl:a,Constructor:null,layerId:(b||w)&&null!==v&&void 0!==v?v:void 0,layers:[],tables:[]};switch(u){case"MapServer":d=null!=v?"FeatureLayer":await async function(e,r){return(await(0,c.V)(e,{customParameters:r})).tileInfo}(e,r)?"TileLayer":"MapImageLayer";break;case"ImageServer":{var h;const a=await(0,c.V)(e,{customParameters:r}),{tileInfo:t,cacheType:l}=a;d=t?"LERC"!==(null===t||void 0===t||null===(h=t.format)||void 0===h?void 0:h.toUpperCase())||l&&"elevation"!==l.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer";break}case"SceneServer":{const e=await(0,c.V)(a.url.path,{customParameters:r});if(d="SceneLayer",e){const r=null===e||void 0===e?void 0:e.layers;if("Voxel"===(null===e||void 0===e?void 0:e.layerType))d="VoxelLayer";else if(null!==r&&void 0!==r&&r.length){var I;const e=null===(I=r[0])||void 0===I?void 0:I.layerType;null!=e&&null!=i.XX[e]&&(d=i.XX[e])}}break}case"FeatureServer":if(d="FeatureLayer",null!=v){const a=await(0,c.V)(e,{customParameters:r});S.sourceJSON=a,"Oriented Imagery Layer"===a.type&&(d="OrientedImageryLayer")}break;default:d=m[u]}if(y[d]&&null==v){var L;const a=await async function(e,r,a){var t,l;let n,i,u=!1;switch(r){case"FeatureServer":{const r=await(0,o.Q)(e,{customParameters:a});u=!!r.layersJSON,n=r.layersJSON||r.serviceJSON;break}case"SceneServer":{const r=await async function(e,r){var a;const t=await(0,c.V)(e,{customParameters:r}),l=null===(a=t.layers)||void 0===a?void 0:a[0];if(!l)return{serviceInfo:t};try{const{serverUrl:a}=await(0,s.L)(e),l=await(0,c.V)(a,{customParameters:r}).catch((()=>null));return l&&(t.tables=l.tables),{serviceInfo:t,tableServerUrl:a}}catch{return{serviceInfo:t}}}(e,a);n=r.serviceInfo,i=r.tableServerUrl;break}default:n=await(0,c.V)(e,{customParameters:a})}const y=null===(t=n)||void 0===t?void 0:t.layers,v=null===(l=n)||void 0===l?void 0:l.tables;return{layers:(null===y||void 0===y?void 0:y.map((e=>({id:e.id}))).reverse())||[],tables:(null===v||void 0===v?void 0:v.map((e=>({serverUrl:i,id:e.id}))).reverse())||[],layerInfos:u?y:[],tableInfos:u?v:[]}}(e,u,r);if(b&&(S.sublayerInfos=a.layerInfos,S.tableInfos=a.tableInfos),1!==a.layers.length+a.tables.length)S.layers=a.layers,S.tables=a.tables,b&&(null===(L=a.layerInfos)||void 0===L?void 0:L.length)&&(S.sublayerConstructorProvider=await async function(e){const r=[],a=[];if(e.forEach((e=>{const{type:t}=e;"Oriented Imagery Layer"===t?(r.push(t),a.push(p("OrientedImageryLayer"))):(r.push(t),a.push(p("FeatureLayer")))})),!a.length)return;const t=await Promise.all(a),l=new Map;return r.forEach(((e,r)=>{l.set(e,t[r])})),e=>l.get(e.type)}(a.layerInfos));else if(b||w){var O,g,P,V,T,F;const e=null!==(O=null===(g=a.layerInfos)||void 0===g?void 0:g[0])&&void 0!==O?O:null===(P=a.tableInfos)||void 0===P?void 0:P[0];S.layerId=null!==(V=null===(T=a.layers[0])||void 0===T?void 0:T.id)&&void 0!==V?V:null===(F=a.tables[0])||void 0===F?void 0:F.id,S.sourceJSON=e,b&&"Oriented Imagery Layer"===(null===e||void 0===e?void 0:e.type)&&(d="OrientedImageryLayer")}}return S.Constructor=await p(d),S}(e.url,u),m={...e.properties,url:e.url};if(v.layers.length+v.tables.length===0)return null!=v.layerId&&(m.layerId=v.layerId),null!=v.sourceJSON&&(m.sourceJSON=v.sourceJSON),new v.Constructor(m);const b=new(0,(await Promise.resolve().then(a.bind(a,4604))).default)({title:v.parsedUrl.title});return await async function(e,r,a){function t(e,r,t,l){const n={...a,layerId:r,sublayerTitleMode:"service-name"};return null!=e&&(n.url=e),null!=t&&(n.sourceJSON=t),l(n)}const l=r.sublayerConstructorProvider;for(const{id:s,serverUrl:o}of r.layers){var n;const a=d(r.sublayerInfos,s),i=null!==(n=a&&(null===l||void 0===l?void 0:l(a)))&&void 0!==n?n:r.Constructor,u=t(o,s,a,(e=>new i(e)));e.add(u)}if(r.tables.length){const a=await p("FeatureLayer");r.tables.forEach((l=>{let{id:n,serverUrl:s}=l;const o=t(s,n,d(r.tableInfos,n),(e=>new a(e)));e.tables.add(o)}))}}(b,v,m),b}function d(e,r){return e?e.find((e=>e.id===r)):null}function f(e){return null!=e&&e.hasOwnProperty("store")&&e.hasOwnProperty("id")&&"number"==typeof e.id}async function p(e){return(0,u.S[e])()}},11668:(e,r,a)=>{a.d(r,{Q:()=>l});var t=a(67061);async function l(e,r){var a;const l=await(0,t.V)(e,r);c(l),o(l);const n={serviceJSON:l};if((null!==(a=l.currentVersion)&&void 0!==a?a:0)<10.5)return n;const s=await(0,t.V)(e+"/layers",r);return c(s),o(s),n.layersJSON={layers:s.layers,tables:s.tables},n}function n(e){return"Feature Layer"===e.type||"Oriented Imagery Layer"===e.type}function s(e){return"Table"===e.type}function o(e){var r,a;e.layers=null===(r=e.layers)||void 0===r?void 0:r.filter(n),e.tables=null===(a=e.tables)||void 0===a?void 0:a.filter(s)}function i(e){e.type||(e.type="Feature Layer")}function u(e){e.type||(e.type="Table")}function c(e){var r,a;null!==(r=e.layers)&&void 0!==r&&r.forEach(i),null===(a=e.tables)||void 0===a||a.forEach(u)}},67061:(e,r,a)=>{a.d(r,{V:()=>l});var t=a(3825);async function l(e,r){const{data:a}=await(0,t.A)(e,{responseType:"json",query:{f:"json",...null===r||void 0===r?void 0:r.customParameters,token:null===r||void 0===r?void 0:r.apiKey}});return a}}}]);
//# sourceMappingURL=2544.036a18c8.chunk.js.map