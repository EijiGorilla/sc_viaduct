"use strict";(self.webpackChunksc_viaduct=self.webpackChunksc_viaduct||[]).push([[2665],{22665:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var r=n(98773),s=n(50076),i=n(76460),a=n(50346),o=n(80963),u=n(98618),l=n(72547),c=n(24586),h=n(26151),d=n(10907),p=n(40098),y=n(11316),g=n(1900),f=n(67478);class m{constructor(){this._queryEngine=null,this._customParameters=null}destroy(){var e;null!==(e=this._queryEngine)&&void 0!==e&&e.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:n,getFeatureOutputFormat:r,fields:i,geometryType:o,featureType:u,objectIdField:d,customParameters:p}=e,{spatialReference:m,getFeatureSpatialReference:_}=(0,y.UH)(n,u,e.spatialReference);this._featureType=u,this._customParameters=p,this._getFeatureUrl=n,this._getFeatureOutputFormat=r,this._getFeatureSpatialReference=_;try{await(0,c.Nk)(_,m)}catch{throw new s.A("unsupported-projection","Projection not supported",{inSpatialReference:_,outSpatialReference:m})}(0,a.Te)(t);const w=g.A.fromLayerJSON({fields:i,dateFieldsTimeReference:i.some((e=>"esriFieldTypeDate"===e.type))?{timeZoneIANA:f.n$}:null}),F=await this._snapshotFeatures({fieldsIndex:w,geometryType:o,objectIdField:d,spatialReference:m},t.signal);return this._queryEngine=new h.d({fieldsIndex:w,geometryType:o,hasM:!1,hasZ:!1,objectIdField:d,spatialReference:m,timeInfo:null,featureStore:new l.A({geometryType:o,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(F),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new s.A("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){var t;return this._customParameters=e,null!==(t=this._snapshotTask)&&void 0!==t&&t.abort(),this._snapshotTask=(0,r.UT)((e=>this._snapshotFeatures(this._queryEngine,e))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),(0,a.zf)(e)||i.A.getLogger("esri.layers.WFSLayer").error(new s.A("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e,t){var n;let{objectIdField:r,geometryType:s,spatialReference:i,fieldsIndex:l}=e;const h=await(0,y.x$)(null!==(n=this._getFeatureUrl)&&void 0!==n?n:"",this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:t});(0,d.sO)(h,this._getFeatureSpatialReference.wkid),(0,a.Te)(t);const g=(0,d.bd)(h,{geometryType:s,hasZ:!1,objectIdField:r});if(!(0,o.aI)(i,this._getFeatureSpatialReference))for(const a of g)null!=a.geometry&&(a.geometry=(0,u.Ux)((0,c.Cv)((0,u.zv)(a.geometry,s,!1,!1),this._getFeatureSpatialReference,i)));let f=1;for(const a of g){const e={};(0,p.MB)(l,e,a.attributes,!0),a.attributes=e,null==e[r]&&(a.objectId=e[r]=f++)}return g}}},40098:(e,t,n)=>{n.d(t,{$1:()=>f,CR:()=>g,MB:()=>d,Yx:()=>u,bP:()=>c});var r=n(51344),s=n(80963),i=n(53430);class a{constructor(){this.code=null,this.description=null}}class o{constructor(e){this.error=new a,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function u(e){return new o(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function c(e){return new l(e)}const h=new Set;function d(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];h.clear();for(const a in n){const s=e.get(a);if(!s)continue;const o=p(s,n[a]);if(h.add(s.name),s&&(r||s.editable)){const e=(0,i.CJ)(s,o);if(e)return u((0,i.uo)(e,s,o));t[s.name]=o}}for(const i of null!==(s=null===e||void 0===e?void 0:e.requiredFields)&&void 0!==s?s:[]){var s;if(!h.has(i.name))return u('missing required field "'.concat(i.name,'"'))}return null}function p(e,t){let n=t;return(0,i.WA)(e)&&"string"==typeof t?n=parseFloat(t):(0,i.yM)(e)&&null!=t&&"string"!=typeof t?n=String(t):(0,i.vE)(e)&&"string"==typeof t&&(n=(0,r._U)(t)),(0,i.WX)(n)}let y;function g(e,t){if(!e||!(0,s.fn)(t))return e;if("rings"in e||"paths"in e){if(null==y)throw new TypeError("geometry engine not loaded");return y.simplify(t,e)}return e}async function f(e,t){!(0,s.fn)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==y&&(y=await Promise.all([n.e(2612),n.e(4050)]).then(n.bind(n,1669))),y}()}}}]);
//# sourceMappingURL=2665.ba7c52d8.chunk.js.map