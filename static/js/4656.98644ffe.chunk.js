"use strict";(self.webpackChunksc_viaduct=self.webpackChunksc_viaduct||[]).push([[4656],{37923:(e,t,r)=>{r.d(t,{C:()=>y,b:()=>v});var i=r(34981),s=r(26917),o=r(59395),a=r(90080),n=r(54478),l=r(94192),c=r(66763),h=r(80883),u=r(3799),d=r(58350),_=r(64839),p=r(32307),g=r(66470),m=r(91911);function v(e){const t=new p.N5,{vertex:r,fragment:v,attributes:y,varyings:f}=t;(0,u.NB)(r,e),t.include(o.d,e),t.include(n.c,e),t.include(c.A,e),t.include(a.g,e),t.include(s.HQ,e),t.include(m.z,e),y.add(g.r.POSITION,"vec3"),e.vvColor&&y.add(g.r.COLORFEATUREATTRIBUTE,"float"),f.add("vColor","vec4"),f.add("vpos","vec3");const w=e.terrainDepthTest&&e.output===i.V.Color;return w&&f.add("depth","float"),r.uniforms.add(new d.E("eColor",(e=>e.color))),r.main.add(_.H`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${w?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);`),t.include(s.HQ,e),w&&t.include(l.Z,e),v.include(h.a),v.main.add(_.H`
    discardBySlice(vpos);
    ${w?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;
    outputColorHighlightOID(fColor, vpos);`),t}const y=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},90806:(e,t,r)=>{r.d(t,{M:()=>u,b:()=>h});var i=r(90235),s=r(3799),o=r(58350),a=r(21390),n=r(64839),l=r(32307),c=r(66470);function h(e){const t=new l.N5,{vertex:r,fragment:h}=t;(0,s.NB)(r,e),r.uniforms.add(new a.m("width",(e=>e.width))),t.attributes.add(c.r.POSITION,"vec3"),t.attributes.add(c.r.NORMAL,"vec3"),t.attributes.add(c.r.UV0,"vec2"),t.attributes.add(c.r.LENGTH,"float"),t.varyings.add("vtc","vec2"),t.varyings.add("vlength","float"),t.varyings.add("vradius","float"),r.main.add(n.H`vec3 bitangent = normal;
vtc = uv0;
vlength = length;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;`),h.uniforms.add(new a.m("outlineSize",(e=>e.outlineSize)),new o.E("outlineColor",(e=>e.outlineColor)),new a.m("stripeLength",(e=>e.stripeLength)),new o.E("stripeEvenColor",(e=>e.stripeEvenColor)),new o.E("stripeOddColor",(e=>e.stripeOddColor)));const u=1/Math.sqrt(2);return h.code.add(n.H`
    const float INV_SQRT2 = ${n.H.float(u)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      }
      if (d < outlineSize) {
        return outlineColor;
      }
      return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
    }`),h.main.add(n.H`
    vec2 ntc = vec2(vtc.x / vradius, vtc.y);
    vec4 color = arrowColor(ntc, vlength / vradius);
    if (color.a < ${n.H.float(i.Q)}) {
      discard;
    }
    fragColor = color;`),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},16159:(e,t,r)=>{r.d(t,{q:()=>s});var i=r(19747);const s={readOnly:!0,get(){return(0,i.c)(this.view)}}},84656:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Le});var i=r(35143),s=r(91967),o=(r(81806),r(30726)),a=r(46053),n=r(76460),l=(r(47249),r(85842)),c=r(16159),h=r(2522),u=r(87562),d=r(68134),_=r(17430),p=r(29772),g=r(23739),m=r(90659);let v=class extends s.A{constructor(e){super(e)}initialize(){this.addHandles([(0,d.wB)((()=>({viewData:this.viewData,startPoint:this.analysis.startPoint})),(e=>{let{viewData:t,startPoint:r}=e;t.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(r)}),d.pc),(0,d.wB)((()=>({viewData:this.viewData,endPoint:this.analysis.endPoint})),(e=>{let{viewData:t,endPoint:r}=e;t.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(r)}),d.pc),(0,d.wB)((()=>({result:this._computedResult,viewData:this.viewData})),(e=>{let{result:t,viewData:r}=e;r.result=t}),d.pc)])}_applyProjectionAndElevationAlignment(e){if(null==e)return e;const{spatialReference:t,elevationProvider:r}=this.view;return(0,_.B)(e,t,r)??((0,_.V)(this.analysis,e.spatialReference,n.A.getLogger(this)),null)}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:r}=this.viewData;if(null==e||null==t)return null;const i=(0,p.NH)(e,t),s=(0,g.Og)(e,t);if(null==i)return null;let o,a;switch(r){case u.G.Auto:a=null!=s?"geodesic":"euclidean",o=s??i.horizontal;break;case u.G.Geodesic:if(null==s)return null;a="geodesic",o=s;break;case u.G.Euclidean:a="euclidean",o=i.horizontal}return{mode:a,directDistance:i.direct,horizontalDistance:o,verticalDistance:i.vertical,distance:r===u.G.Euclidean||i.horizontal.value<=m.U7?i.direct:s??i.horizontal}}};(0,i._)([(0,a.MZ)()],v.prototype,"view",void 0),(0,i._)([(0,a.MZ)()],v.prototype,"analysis",void 0),(0,i._)([(0,a.MZ)()],v.prototype,"viewData",void 0),(0,i._)([(0,a.MZ)()],v.prototype,"_computedResult",null),v=(0,i._)([(0,l.$)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],v);r(11265);var y,f,w,b=r(59784),O=r(15941),C=r(11113),R=r(24648),P=r(76931),M=r(31633),A=r(19555),E=r(20664),S=r(9392);(w=y||(y={}))[w.None=0]="None",w[w.Direct=1]="Direct",w[w.Triangle=2]="Triangle",w[w.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(f||(f={}));var T=r(4244),D=r(66747),L=r(7256),z=r(88321),G=r(13191),V=r(43047),x=r(55855),j=r(75762),N=r(32314),F=r(81923),I=r(71372),H=r(62577),Z=r(45463),W=r(48549),B=r(34981),q=r(90235),k=r(59696),U=r(77730),Q=r(66470),$=r(16506),X=r(59246),Y=r(60322),J=r(90806),K=r(93345),ee=r(57162);class te extends X.w{constructor(e,t,i){super(e,t,new $.$(J.M,(()=>r.e(9492).then(r.bind(r,59492)))),i,re),this.primitiveType=K.WR.TRIANGLE_STRIP}initializePipeline(e){return(0,ee.Ey)({blending:e.transparent?(0,Y.Yf)(e.oitPass):null,polygonOffset:e.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:K.MT.LESS},depthWrite:ee.Uy,colorWrite:ee.kn})}}const re=new Map([[Q.r.POSITION,0],[Q.r.NORMAL,1],[Q.r.UV0,2],[Q.r.LENGTH,3]]);var ie=r(6485),se=r(94570);class oe extends se.E{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1}}(0,i._)([(0,ie.W)()],oe.prototype,"polygonOffsetEnabled",void 0),(0,i._)([(0,ie.W)()],oe.prototype,"transparent",void 0);class ae extends Z.im{constructor(e){super(e,le),this._configuration=new oe,this.vertexAttributeLocations=re,this.produces=new Map([[U.N.OPAQUE_MATERIAL,e=>!this._transparent&&e===B.V.Color],[U.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>this._transparent&&e===B.V.Color]])}getConfiguration(e,t){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.oitPass=t.oitPass,this._configuration}get visible(){const{outlineColor:e,stripeEvenColor:t,stripeOddColor:r}=this.parameters;return e[3]>=q.Q||t[3]>=q.Q||r[3]>=q.Q}intersect(){}createGLMaterial(e){return new ne(e)}createBufferWriter(){return new ge}get _transparent(){const{parameters:e}=this;return e.outlineColor[3]<1||e.stripeEvenColor[3]<1||e.stripeOddColor[3]<1}}class ne extends k.A{beginSlot(e){return this.acquireTechnique(te,e)}}class le extends Z.qA{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=(0,x.fA)(1,.5,0,1),this.stripeEvenColor=(0,x.fA)(1,1,1,1),this.stripeOddColor=(0,x.fA)(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const ce=(0,W.BP)().vec3f(Q.r.POSITION).vec3f(Q.r.NORMAL).vec2f(Q.r.UV0).f32(Q.r.LENGTH),he=(0,S.vt)(),ue=(0,S.vt)(),de=(0,S.vt)(),_e=(0,S.vt)(),pe=(0,S.vt)();class ge{constructor(){this.vertexBufferLayout=ce}elementCount(e){return 2*(e.get(Q.r.POSITION).indices.length/2+1)}write(e,t,r,i,s,o){const{data:a,indices:n}=r.get(Q.r.POSITION),l=r.get(Q.r.NORMAL).data,c=a.length/3;n&&n.length!==2*(c-1)&&console.warn("MeasurementArrowMaterial does not support indices");const h=he,u=ue,d=de,_=_e,p=pe,g=s.position,m=s.normal,v=s.uv0;let y=0;for(let w=0;w<c;++w){const r=3*w;if((0,E.i)(h,a[r],a[r+1],a[r+2]),w<c-1){const e=3*(w+1);(0,E.i)(u,a[e],a[e+1],a[e+2]),(0,E.i)(p,l[e],l[e+1],l[e+2]),(0,E.n)(p,p),(0,E.d)(d,u,h),(0,E.n)(d,d),(0,E.e)(_,p,d),(0,E.n)(_,_)}const i=(0,E.j)(h,u);e&&t&&((0,E.t)(h,h,e),(0,E.t)(u,u,e),(0,E.t)(_,_,t));const s=o+2*w,n=s+1;g.setVec(s,h),g.setVec(n,h),m.setVec(s,_),m.setVec(n,_),v.set(s,0,y),v.set(s,1,-1),v.set(n,0,y),v.set(n,1,1),w<c-1&&(y+=i)}const f=s.length;for(let w=0;w<2*c;++w)f.set(o+w,y)}}class me extends N.X{constructor(e){super(e),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=(0,S.vt)(),this._originTransform=(0,G.vt)(),this._arrowCenter=(0,S.vt)(),this._renderOccluded=Z.m$.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=(0,x.vt)(),this._contrastColor=(0,x.vt)(),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial?.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._contrastColor:this._color;this._arrowMaterial.setParameters({stripeEvenColor:e})}}get color(){return this._color}set color(e){(0,b.we)(e,this._color)||((0,V.c)(this._color,e),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(e){(0,b.we)(e,this._color)||((0,V.c)(this._contrastColor,e),this._updateArrowColor())}createExternalResources(){const e=this._color,t=this._contrastColor,r=this._stripesEnabled?t:e;this._arrowMaterial=new ae({outlineColor:e,stripeEvenColor:r,stripeOddColor:e,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new z.A,this._handles.add((0,d.wB)((()=>this.view.state.camera),(()=>{this._viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles=(0,o.pR)(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(null==this._geometry?.startRenderSpace||null==this._geometry.endRenderSpace)return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);t.transformation=this._originTransform,e.addGeometry(t),this._viewChanged()}_createArrowGeometry(e,t,r,i){const s=this.view,o=s.renderCoordsHelper,a=[],n=[],l=(e,t)=>{const i=j.rq.get();(0,E.d)(i,e,r),a.push(i),n.push(t)};if("euclidean"===i.type){i.eval(.5,this._arrowCenter);const r=j.rq.get();if(o.worldUpAtPosition(this._arrowCenter,r),function(e,t,r){const i=(0,E.a)(ve,t,e),s=(0,E.e)(ve,i,r);return 0===(0,E.G)(s)}(e,t,r)){const{heading:t,tilt:i}=s.camera,{direction:o}=(0,F.ZC)(s,e,t,i,ye);(0,E.c)(r,o)}l(e,r),l(t,r)}else{i.eval(.5,this._arrowCenter);const e=this._arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const r=t/(e-1),s=j.rq.get(),a=j.rq.get();i.eval(r,s),o.worldUpAtPosition(s,a),l(s,a)}}return(0,H.Z8)(this._arrowMaterial,a,n)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&null!=this._geometry){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*e})}}_updateArrowColor(){if(!this.attached)return;const e=this._color,t=this._contrastColor,r=this._stripesEnabled?t:e,i=e,s=e;this._arrowMaterial.setParameters({stripeEvenColor:r,outlineColor:i,stripeOddColor:s})}}const ve=(0,S.vt)(),ye=(0,I.NP)();var fe=r(47996),we=r(25191),be=r(35925),Oe=r(38042),Ce=r(63860);let Re=class extends s.A{get _parameters(){const e=this.view.effectiveTheme,{accentColor:t,textColor:r}=e,i=(0,b.QP)(t),s=(0,b.f6)(t,.75),o=(0,b.QP)((0,b.bJ)(t)),a=(0,b.bJ)(r,b.pW.Low);return{accentColor:i,contrastColor:o,translucentAccentColor:s,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:r,textBackgroundColor:(0,b._L)(a,.6),textCalloutColor:(0,b._L)(a,.5)}}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if(null==e||null==t||e.equals(t))return y.None;const r=this.analysisView.result;if(null==r)return y.Direct;if("geodesic"===this.actualVisualizedMeasurement)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?y.ProjectedGeodesic:y.Direct;const{verticalDistance:i,horizontalDistance:s}=r,o=i.value,a=s.value;return Math.min(o/a,a/o)<this.triangleCollapseRatioThreshold?y.Direct:y.Triangle}get actualVisualizedMeasurement(){const{measurementMode:e,result:t}=this.analysisView;switch(e){case u.G.Auto:return null!=t&&t.horizontalDistance.value>m.U7?"geodesic":"euclidean";case u.G.Euclidean:return"euclidean";case u.G.Geodesic:return"geodesic"}}get allowVisualElementsOrientationChange(){return null==this._triangleOrientationOverride}set allowVisualElementsOrientationChange(e){null==this._triangleOrientationOverride!==e&&(null==this._triangleOrientationOverride?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){return"geodesic"===this.actualVisualizedMeasurement?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(e){super(e),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,S.vt)(),this._endPosition=(0,S.vt)(),this._cornerPosition=(0,S.vt)(),this._startPositionAtSeaLevel=(0,S.vt)(),this._endPositionAtSeaLevel=(0,S.vt)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=f.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){const e=this._parameters,t={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:r,guideStippleLengthPixels:i,triangleLineWidth:s,geodesicProjectionLineWidth:o,directLabelFontSize:a,verticalLabelFontSize:n,horizontalLabelFontSize:l}=e;this._segmentVisualElement=new me({...t,geometry:null,renderOccluded:Z.m$.OccludeAndTransparent}),this._triangleVisualElement=new L.t({...t,width:s,renderOccluded:Z.m$.OccludeAndTransparent}),this._rightAngleQuad=new fe.n({...t,renderOccluded:Z.m$.OccludeAndTransparent});const c={...t,polygonOffset:!0,renderOccluded:Z.m$.OccludeAndTransparent};this._projectedGeodesicLine=new L.t({...c,width:o,stipplePattern:(0,be.wk)(i)}),this._geodesicStartHint=new L.t({...c,width:r,stipplePattern:(0,be.wk)(i)}),this._geodesicEndHint=new L.t({...c,width:r,stipplePattern:(0,be.wk)(i)}),this._segmentLabel=new D.N({...t,fontSize:a}),this._verticalLabel=new D.N({...t,fontSize:n}),this._horizontalLabel=new D.N({...t,fontSize:l}),this.addHandles([(0,d.wB)((()=>{const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView,r=this.view;return{view:r,camera:r.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}}),(e=>this._updateGeometryAndViewMode(e)),d.pc),(0,d.wB)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateVisualElementVisibility(e)),d.pc),(0,d.wB)((()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement})),(e=>this._updateLabelText(e)),d.pc),(0,d.wB)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateLabelVisibility(e)),d.pc),(0,d.wB)((()=>this._measurementArrowStripeLength),(e=>this._updateSegmentStripeLength(e)),d.pc),(0,Oe.oQ)((async()=>this._updateMessageBundle())),(0,d.wB)((()=>this._parameters),(e=>{let{textBackgroundColor:t,textCalloutColor:r,textColor:i,translucentAccentColor:s,accentColor:o,contrastColor:a}=e;const{_segmentLabel:n,_verticalLabel:l,_horizontalLabel:c,_triangleVisualElement:h,_rightAngleQuad:u,_projectedGeodesicLine:d,_geodesicStartHint:_,_geodesicEndHint:p,_segmentVisualElement:g}=this;n.backgroundColor=t,n.calloutColor=r,n.textColor=i,l.backgroundColor=t,l.calloutColor=r,l.textColor=i,c.backgroundColor=t,c.calloutColor=r,c.textColor=i,h.color=s,u.color=s,d.color=s,_.color=s,p.color=s,g.color=o,g.contrastColor=a}),d.Vh)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=(0,o.pR)(this._segmentVisualElement),this._triangleVisualElement=(0,o.pR)(this._triangleVisualElement),this._rightAngleQuad=(0,o.pR)(this._rightAngleQuad),this._projectedGeodesicLine=(0,o.pR)(this._projectedGeodesicLine),this._geodesicStartHint=(0,o.pR)(this._geodesicStartHint),this._geodesicEndHint=(0,o.pR)(this._geodesicEndHint),this._segmentLabel=(0,o.pR)(this._segmentLabel),this._verticalLabel=(0,o.pR)(this._verticalLabel),this._horizontalLabel=(0,o.pR)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility(e){let{visible:t,viewMode:r}=e;if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(r){case y.None:break;case y.Direct:this._segmentVisualElement.visible=!0;break;case y.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case y.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode(e){let{view:t,camera:r,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,orientation:a,visualizedMeasurement:n,stripeLength:l}=e;const c=t.renderCoordsHelper;if(null==c||null==s||null==o||s.equals(o))return;let h=this._startPosition,u=this._endPosition;c.toRenderCoords(s,h),c.toRenderCoords(o,u);const d=a===f.AboveSegment?1:-1,_=d*(c.getAltitude(u)-c.getAltitude(h));_<0&&(h=this._endPosition,u=this._startPosition);const p="geodesic"===n?new we.J(this._startPosition,this._endPosition,c.spatialReference):new we.C(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=p,this._updateSegmentStripeLength(l),i){case y.Direct:this._updateSegment(p,a);break;case y.Triangle:this._updateSegmentAndTriangle({view:t,camera:r,segment:p,orientation:a,startPosition:h,endPosition:u,deltaSign:d,altitudeDelta:_});break;case y.ProjectedGeodesic:this._updateSegmentAndProjection({view:t,orientation:a,startPosition:h,endPosition:u})}}_updateSegment(e,t){this._segmentLabel.anchor=t===f.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle(e){let{view:{renderCoordsHelper:t},camera:r,segment:i,orientation:s,startPosition:o,endPosition:a,deltaSign:n,altitudeDelta:l}=e;const c=this._cornerPosition;t.worldUpAtPosition(o,c),(0,E.h)(c,c,n*Math.abs(l)),(0,E.g)(c,c,o),this._triangleVisualElement.geometry=[[[o[0],o[1],o[2]],[c[0],c[1],c[2]],[a[0],a[1],a[2]]]],this._rightAngleQuad.geometry={previous:o,center:c,next:a};const h=new we.C(o,c),u=new we.C(c,a),d=function(e,t,r,i,s){const o=Me,a=Ae;s.projectToRenderScreen(r,o),s.projectToRenderScreen(t,a);const n={segment:"bottom",horizontal:"top",vertical:o[0]<a[0]?"left":"right"};{const i=Ee,o=Se;if((0,T.Q)(e,r,s,i),(0,T.Q)(e,t,s,o),(0,A.Om)(i,o)>=Pe){const e=Math.sign(i[1])===Math.sign(o[1]);n.segment=e?(0,D.R)(n.vertical):n.vertical}else{const e=Te;(0,T.Q)(r,t,s,e),(0,A.Om)(e,o)>=Pe&&(n.segment=Math.sign(e[0])===Math.sign(o[0])?(0,D.R)(n.horizontal):n.horizontal)}}if(i===f.BelowSegment){const e=e=>"top"===e?"bottom":"top";n.segment=e(n.segment),n.horizontal=e(n.horizontal),n.vertical=e(n.vertical)}return n}(o,a,c,s,r);this._segmentLabel.anchor=d.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=d.vertical,this._horizontalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._horizontalLabel.anchor=d.horizontal}_updateSegmentAndProjection(e){let{view:{renderCoordsHelper:t},orientation:r,startPosition:i,endPosition:s}=e;t.setAltitude(this._startPositionAtSeaLevel,0,i),t.setAltitude(this._endPositionAtSeaLevel,0,s);const o=new we.J(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(o),this._geodesicStartHint.setGeometryFromSegment(new we.C(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new we.C(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:o,sampleLocation:"center"},this._segmentLabel.anchor=r===f.AboveSegment?"top":"bottom"}_updateLabelText(e){let{text:t,visualizedMeasurement:r}=e;null!=t?(this._segmentLabel.text="euclidean"===r?t.directDistance:t.horizontalDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility(e){let{visible:t,viewMode:r}=e;const i=this._segmentLabel,s=this._horizontalLabel,o=this._verticalLabel;if(i.visible=!1,s.visible=!1,o.visible=!1,t)switch(r){case y.Direct:i.visible=!0;break;case y.Triangle:i.visible=!0,s.visible=!0,o.visible=!0;break;case y.ProjectedGeodesic:i.visible=!0;case y.None:}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if(null==t||null==e)return null;const{directDistance:r,horizontalDistance:i,verticalDistance:s}=t,o=this.analysisView.unit,a=e=>({directDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(o){case"metric":return a({directDistance:r&&(0,C.Ee)(e,r),horizontalDistance:i&&(0,C.Ee)(e,i),verticalDistance:s&&(0,C.W4)(e,s)});case"imperial":return a({directDistance:r&&(0,C.tr)(e,r),horizontalDistance:i&&(0,C.tr)(e,i),verticalDistance:s&&(0,C.t_)(e,s)});default:return a({directDistance:r&&(0,C.zJ)(e,r,o),horizontalDistance:i&&(0,C.zJ)(e,i,o),verticalDistance:s&&(0,C.zJ)(e,s,o)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;null!=e?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(null!=this._triangleOrientationOverride)return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===f.Auto?this.view.state.camera.aboveGround?f.AboveSegment:f.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(!t?.state)return!1;const r=t.state.camera,i=t.renderCoordsHelper;if(!i)return!1;const s=r.computeScreenPixelSizeAt(e);return i.getAltitude(e)/s>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if(null==e)return null;let r=null;const i=e.directDistance;switch(t){case"metric":r=i&&(0,R.kM)(i,"meters");break;case"imperial":r=i&&(0,R.kM)(i,(0,M.OU)(i.value,i.unit));break;default:r=i&&(0,R.kM)(i,t)}return null==r?null:(0,O.Vr)(r.value/30)*(0,M.oU)(1,r.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,Ce.ud)("esri/core/t9n/Units").then((e=>{this.messages=e})).finally((()=>{this.loadingMessages=!1}))}get testData(){}};(0,i._)([(0,a.MZ)()],Re.prototype,"_parameters",null),(0,i._)([(0,a.MZ)()],Re.prototype,"_triangleOrientationOverride",void 0),(0,i._)([(0,a.MZ)()],Re.prototype,"messages",void 0),(0,i._)([(0,a.MZ)()],Re.prototype,"view",void 0),(0,i._)([(0,a.MZ)()],Re.prototype,"analysis",void 0),(0,i._)([(0,a.MZ)()],Re.prototype,"analysisView",void 0),(0,i._)([(0,a.MZ)()],Re.prototype,"loadingMessages",void 0),(0,i._)([(0,a.MZ)()],Re.prototype,"visible",null),(0,i._)([(0,a.MZ)()],Re.prototype,"viewMode",null),(0,i._)([(0,a.MZ)()],Re.prototype,"actualVisualizedMeasurement",null),(0,i._)([(0,a.MZ)()],Re.prototype,"visualElementOrientation",void 0),(0,i._)([(0,a.MZ)()],Re.prototype,"triangleCollapseRatioThreshold",void 0),(0,i._)([(0,a.MZ)()],Re.prototype,"allowVisualElementsOrientationChange",null),(0,i._)([(0,a.MZ)()],Re.prototype,"labels",null),(0,i._)([(0,a.MZ)()],Re.prototype,"_labelsText",null),(0,i._)([(0,a.MZ)()],Re.prototype,"_actualVisualElementsOrientation",null),(0,i._)([(0,a.MZ)()],Re.prototype,"_measurementArrowStripeLength",null),Re=(0,i._)([(0,l.$)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],Re);const Pe=Math.cos((0,O.kU)(12)),Me=(0,P.r_)(),Ae=(0,P.r_)(),Ee=(0,P.QG)(),Se=(0,P.QG)(),Te=(0,P.QG)();let De=class extends((0,h.P)(s.A)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=u.G.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new Re({view:e,analysis:t,analysisView:this}),this._analysisController=new v({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,o.pR)(this._analysisController),this._analysisVisualization=(0,o.pR)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return this.analysis.unit??this._defaultUnit}get testData(){}};(0,i._)([(0,a.MZ)()],De.prototype,"updating",null),(0,i._)([(0,a.MZ)({readOnly:!0})],De.prototype,"type",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0,nonNullable:!0})],De.prototype,"analysis",void 0),(0,i._)([(0,a.MZ)()],De.prototype,"result",void 0),(0,i._)([(0,a.MZ)()],De.prototype,"measurementMode",void 0),(0,i._)([(0,a.MZ)()],De.prototype,"elevationAlignedStartPoint",void 0),(0,i._)([(0,a.MZ)()],De.prototype,"elevationAlignedEndPoint",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],De.prototype,"viewMode",null),(0,i._)([(0,a.MZ)({readOnly:!0})],De.prototype,"actualVisualizedMeasurement",null),(0,i._)([(0,a.MZ)()],De.prototype,"visualElementOrientation",null),(0,i._)([(0,a.MZ)()],De.prototype,"allowVisualElementsOrientationChange",null),(0,i._)([(0,a.MZ)()],De.prototype,"triangleCollapseRatioThreshold",null),(0,i._)([(0,a.MZ)({readOnly:!0})],De.prototype,"directLabelText",null),(0,i._)([(0,a.MZ)({readOnly:!0})],De.prototype,"horizontalLabelText",null),(0,i._)([(0,a.MZ)({readOnly:!0})],De.prototype,"verticalLabelText",null),(0,i._)([(0,a.MZ)()],De.prototype,"_analysisVisualization",void 0),(0,i._)([(0,a.MZ)()],De.prototype,"_analysisController",void 0),(0,i._)([(0,a.MZ)()],De.prototype,"unit",null),(0,i._)([(0,a.MZ)(c.q)],De.prototype,"_defaultUnit",void 0),De=(0,i._)([(0,l.$)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],De);const Le=De},87562:(e,t,r)=>{var i;r.d(t,{G:()=>i}),function(e){e[e.Auto=0]="Auto",e[e.Euclidean=1]="Euclidean",e[e.Geodesic=2]="Geodesic"}(i||(i={}))},17430:(e,t,r)=>{r.d(t,{B:()=>o,V:()=>a});var i=r(9624),s=r(80935);function o(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=(0,i.tryProjectWithZConversion)(e,t);return null==a?null:(a.hasZ&&!o||null==r||(a.z=(0,s.R1)(r,a)??0),a)}function a(e,t,r){r.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${t.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},85746:(e,t,r)=>{r.d(t,{X:()=>f});var i=r(35143),s=r(91967),o=r(5632),a=r(46053),n=(r(81806),r(76460),r(47249),r(85842)),l=r(57662),c=r(57824),h=r(44513);class u{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new d({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new d({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!0))}}let d=class extends((0,o.sA)(s.A)){constructor(e){super(e),this.drapeSourceType=l.Om.Features,this.updatePolicy=h.q.SYNC,this.renderGroup=l.O7.Outline}};(0,i._)([(0,a.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],d.prototype,"drapeSourceType",void 0),(0,i._)([(0,a.MZ)()],d.prototype,"renderGroup",void 0),d=(0,i._)([(0,n.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],d);var _=r(69230),p=r(68134),g=r(87634),m=r(37046),v=r(8918);class y{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==g.X.Mesh&&t.type!==g.X.Line&&t.type!==g.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==g.X.Mesh&&t.type!==g.X.Line&&t.type!==g.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,r=t._stage;if(!r)return;const i=new v.x(r,{pickable:!1,updatePolicy:h.q.SYNC}),s=new m.B({castShadow:!1}),o=e.createResources(s,i);o.forEach((e=>{r.add(e),e.type===g.X.Texture&&e.load(r.renderView.renderingContext)})),r.add(s),i.add(s);const a=e.cameraChanged,n=a?(0,p.wB)((()=>t.state.camera),(e=>a(e)),p.Vh):null;this._resources={layer:i,object:s,external:o,cameraHandle:n},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===g.X.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class f extends _.B{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new y(this.createObject3DResourceFactory(e.view)),this.drapedResources=new u(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},7256:(e,t,r)=>{r.d(t,{t:()=>d});var i=r(34761),s=r(13191),o=r(20664),a=r(9392),n=r(55855),l=r(32314),c=r(70667),h=r(45463),u=r(425);class d extends l.X{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._hasExternalMaterial=null!=t,this._material=null!=t?t:new u.W({width:1,color:(0,n.fA)(1,0,1,1),stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerWidth:1,hasPolygonOffset:!1,renderOccluded:h.m$.OccludeAndTransparent,isDecoration:!!e.isDecoration,writeDepth:!0}),this.applyProperties(e)}setGeometryFromPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;const r=(0,a.vt)();this.view.renderCoordsHelper.toRenderCoords(e,r)&&this.setGeometryFromRenderSpacePoint(r,t)}setGeometryFromRenderSpacePoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.geometry=[[[e[0]-t,e[1],e[2]],[e[0]+t,e[1],e[2]]],[[e[0],e[1]-t,e[2]],[e[0],e[1]+t,e[2]]],[[e[0],e[1],e[2]-t],[e[0],e[1],e[2]+t]]]}setGeometryFromExtent(e){const t=this.view.spatialReference,r=(0,a.vt)(),i=(0,a.vt)(),s=100,n=[];(0,o.i)(r,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(r,t,i),n.push([i[0],i[1],i[2]]),(0,o.i)(r,e[2],e[1],s),this.view.renderCoordsHelper.toRenderCoords(r,t,i),n.push([i[0],i[1],i[2]]),(0,o.i)(r,e[2],e[3],s),this.view.renderCoordsHelper.toRenderCoords(r,t,i),n.push([i[0],i[1],i[2]]),(0,o.i)(r,e[0],e[3],s),this.view.renderCoordsHelper.toRenderCoords(r,t,i),n.push([i[0],i[1],i[2]]),(0,o.i)(r,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(r,t,i),n.push([i[0],i[1],i[2]]),(0,o.i)(r,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(r,t,i),n.push([i[0],i[1],i[2]]),this.geometry=[n]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],r=e.origin,i=e.basis1,s=e.basis2,o=.5,n=(0,a.vt)(),l=(0,a.vt)(),c=(0,a.vt)(),h=(0,a.vt)();n[0]=r[0]-i[0]*o-s[0]*o,n[1]=r[1]-i[1]*o-s[1]*o,n[2]=r[2]-i[2]*o-s[2]*o,l[0]=r[0]-i[0]*o+s[0]*o,l[1]=r[1]-i[1]*o+s[1]*o,l[2]=r[2]-i[2]*o+s[2]*o,c[0]=r[0]+i[0]*o+s[0]*o,c[1]=r[1]+i[1]*o+s[1]*o,c[2]=r[2]+i[2]*o+s[2]*o,h[0]=r[0]+i[0]*o-s[0]*o,h[1]=r[1]+i[1]*o-s[1]*o,h[2]=r[2]+i[2]*o-s[2]*o,t.push([n[0],n[1],n[2]]),t.push([l[0],l[1],l[2]]),t.push([c[0],c[1],c[2]]),t.push([h[0],h[1],h[2]]),t.push([n[0],n[1],n[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=(0,i.kN)(_,t);const{points:r}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[r]}setGeometryFromSegments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.uY;this.transform=(0,i.kN)(_,t),this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}getTransformedGeometry(){return null==this._geometry?null:this._geometry.map((e=>e.map((e=>(0,o.t)((0,a.vt)(),e,this.transform)))))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(e){this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(e){this._material.setParameters({width:e})}get color(){return this._material.parameters.color}set color(e){const t=1===e[3];this._material.setParameters({color:e,writeDepth:t})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(e){this._material.setParameters({innerWidth:e})}get innerColor(){return this._material.parameters.innerColor}set innerColor(e){this._material.setParameters({innerColor:e})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(e){null!=this._material&&this._material.setParameters({stipplePattern:e})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(e){this._material.setParameters({stippleOffColor:e})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(e){this._material.setParameters({stipplePreferContinuous:e})}get falloff(){return this._material.parameters.falloff}set falloff(e){this._material.setParameters({falloff:e})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(e){this._material.setParameters({hasPolygonOffset:e})}createExternalResources(){}destroyExternalResources(){}createGeometries(e){for(const t of(0,c.z)(this.geometry)){const r=(0,c.t)(this._material,t);e.addGeometry(r)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const _=(0,s.vt)()},32314:(e,t,r)=>{r.d(t,{X:()=>c});var i=r(34761),s=r(13191),o=r(69230),a=r(37046),n=r(44513),l=r(8918);class c extends o.B{constructor(e){super(e),this._resources=null,this._transform=(0,s.vt)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,i.C)(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new l.x(e,{pickable:!1,updatePolicy:n.q.SYNC}),r=new a.B({castShadow:!1});r.transformation=this._transform,this.createExternalResources(),this.createGeometries(r),e.addMany(r.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(r),t.add(r),r.visible=this.visible,this._resources={layer:t,object:r}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((t=>{e.remove(t)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}},47996:(e,t,r)=>{r.d(t,{n:()=>O});var i=r(68134),s=r(34761),o=r(13191),a=r(20664),n=r(9392),l=r(43047),c=r(55855),h=r(75762),u=r(18117),d=r(85746),_=r(33169),p=r(50468),g=r(17345),m=r(62577),v=r(45463),y=r(442),f=r(66470),w=r(76956),b=r(425);class O extends d.X{constructor(e){super(e),this._maxSize=0,this._position=(0,n.vt)(),this._up=(0,n.vt)(),this._right=(0,n.vt)(),this._renderOccluded=v.m$.OccludeAndTransparent,this._color=(0,c.fA)(1,0,0,1),this._outlineColor=(0,c.fA)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=v.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:C}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,l.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,l.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:r,next:i}=e;this._maxSize=Math.min((0,a.j)(r,t),(0,a.j)(r,i))/3,(0,a.n)(this._up,(0,a.d)(this._up,t,r)),(0,a.n)(this._right,(0,a.d)(this._right,i,r)),(0,a.c)(this._position,r),this.recreateGeometry()}_createObject3DResources(e){const t=new w.v(this._quadMaterialParameters),r=0===this._outlineSize?void 0:new b.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,r),{quadMaterial:t,outlineMaterial:r,forEach:e=>{e(t),r&&e(r)}}}_createObject3DGeometries(e,t,r){if((0,a.p)(this._up,n.uY)&&(0,a.p)(this._right,n.uY))return;const i=this._createGeometries(t,r);for(const s of i)e.addGeometry(s);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new w.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new b.W(this._outlineMaterialParameters),r=this._createGeometries(e,t).map((e=>new y.$(e)));return this._setTransformDraped(r),{quadMaterial:e,outlineMaterial:t,geometries:r,pixelRatioHandle:(0,i.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_createGeometries(e,t){const{up:r,right:i,corner:s}=this._getVertices(),o=function(e,t,r,i){return new g.V(i,[[f.r.POSITION,new p.n([0,0,0,...t,...e,...r],[0,1,2,1,2,3],3,!0)]])}(r,i,s,e);return t?[o,(0,m.Z8)(t,[r,s,i])]:[o]}_getVertices(){let e=this._up,t=this._right;const r=(0,a.g)(h.rq.get(),e,t);return this.isDraped&&(e=(0,a.c)(h.rq.get(),e),t=(0,a.c)(h.rq.get(),t),e[2]=0,t[2]=0,r[2]=0),{up:e,right:t,corner:r}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,r=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,r);(0,s.kN)(R,this._position),(0,s.hs)(R,R,[i,i,i]),e.transformation=R}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{_position:i,_size:o}=this,n=(0,a.c)(h.rq.get(),i);n[2]=_.bi;const l=P;l.spatialReference=t.renderer.spatialReference,l.x=n[0],l.y=n[1];const c=o*(this.view.overlayPixelSizeInMapUnits(l)*r),u=Math.min(this._maxSize,c);(0,s.kN)(R,n),(0,s.hs)(R,R,[u,u,1]);for(const s of e)s.transformation=R}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}function C(e){e.pixelRatioHandle.remove(),e.geometries=[]}const R=(0,o.vt)(),P=(0,u.T)(0,0,void 0,null)},69230:(e,t,r)=>{r.d(t,{B:()=>s});r(81806);var i=r(68134);class s{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,i.wB)((()=>e.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProperties(e){let t=!1;for(const r in e)r in this&&("attached"===r?t=!!e[r]:this[r]=e[r]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},70667:(e,t,r)=>{r.d(t,{t:()=>m,z:()=>f});var i=r(19555),s=r(72745),o=r(55855),a=r(34111),n=r(482),l=r(44815),c=r(75002),h=r(38496),u=r(64465),d=r(50468),_=r(87634),p=r(17345),g=r(66470);function m(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=[],m=t.mapPositions;!function(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,s=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&i,o=r.length/3-(s?1:0),a=new Array(2*(o-1)),n=s?r.slice(0,-3):r;let l=0;for(let c=0;c<o-1;c++)a[l++]=c,a[l++]=c+1;t.push([g.r.POSITION,new d.n(n,a,3,s)])}(t,s);const f=s[0][1].data,w=s[0][1].indices.length,b=(0,h.EH)(w);return function(e,t,r){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([g.r.COLOR,new d.n(i??o.Un,r,4)])}(t,s,b),function(e,t,r){null==e.attributeData.sizeFeature&&t.push([g.r.SIZE,new d.n([e.attributeData.size??1],r,1,!0)])}(t,s,b),function(e,t,r){e.attributeData.normal&&t.push([g.r.NORMAL,new d.n(e.attributeData.normal,r,3)])}(t,s,b),function(e,t,r){null!=e.attributeData.colorFeature&&t.push([g.r.COLORFEATUREATTRIBUTE,new d.n([e.attributeData.colorFeature],r,1,!0)])}(t,s,b),function(e,t,r){null!=e.attributeData.sizeFeature&&t.push([g.r.SIZEFEATUREATTRIBUTE,new d.n([e.attributeData.sizeFeature],r,1,!0)])}(t,s,b),function(e,t,r){null!=e.attributeData.opacityFeature&&t.push([g.r.OPACITYFEATUREATTRIBUTE,new d.n([e.attributeData.opacityFeature],r,1,!0)])}(t,s,b),function(e,t,r){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==u.RT.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=(0,l.jh)(r.length),o=(0,a.tO)(e.overlayInfo.spatialReference);for(let i=0;i<s.length;i+=3)(0,n.RC)(r,i,s,i,o);const h=r.length/3,_=(0,c.oe)(h+1);let p=v,m=y,f=0,w=0;(0,i.hZ)(p,s[w++],s[w++]),w++,_[0]=0;for(let a=1;a<h+1;++a)a===h&&(w=0),(0,i.hZ)(m,s[w++],s[w++]),w++,f+=(0,i.xg)(p,m),_[a]=f,[p,m]=[m,p];t.push([g.r.DISTANCETOSTART,new d.n(_,t[0][1].indices,1,!0)])}(t,s,f),new p.V(e,s,m,_.X.Line,r)}const v=(0,s.vt)(),y=(0,s.vt)();function f(e,t){if(null==e||0===e.length)return[];const r=[];return e.forEach((e=>{const i=e.length,s=(0,l.jh)(3*i);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e[2]}));const o={attributeData:{position:s,normal:t},removeDuplicateStartEnd:!1};r.push(o)})),r}},76956:(e,t,r)=>{r.d(t,{v:()=>D});var i=r(55855),s=r(48549),o=r(34981),a=r(90235),n=r(61785),l=r(83490),c=r(59696),h=r(60322),u=r(77730),d=r(66470),_=r(82809),p=r(63928),g=r(93684),m=r(16506),v=r(59246),y=r(72001),f=r(96643),w=r(37923),b=r(93345),O=r(57162);g.S;class C extends v.w{constructor(e,t,i){super(e,t,new m.$(w.C,(()=>r.e(5837).then(r.bind(r,35837)))),i)}_createPipeline(e,t){const{oitPass:r,output:i,transparent:s,cullFace:a,draped:n,hasOccludees:l,polygonOffset:c,enableOffset:u}=e,d=r===y.Y.NONE,_=r===y.Y.FrontFace;return(0,O.Ey)({blending:i===o.V.Color&&s?(0,h.Yf)(r):null,culling:(0,O.Xt)(a),depthTest:n?null:{func:(0,h.K_)(r)},depthWrite:(0,h.z5)(e),drawBuffers:i===o.V.Depth?{buffers:[b.Hr.NONE]}:(0,h.m6)(r,i),colorWrite:O.kn,stencilWrite:l?f.v0:null,stencilTest:l?t?f.a9:f.qh:null,polygonOffset:d||_?c?R:null:(0,h.aB)(u)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const R={factor:1,units:1};var P=r(35143),M=r(97808),A=r(42717),E=r(6485),S=r(94570);class T extends S.E{constructor(){super(...arguments),this.cullFace=l.s2.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=M.I.None,this.emissionSource=A.ZX.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}(0,P._)([(0,E.W)({count:l.s2.COUNT})],T.prototype,"cullFace",void 0),(0,P._)([(0,E.W)()],T.prototype,"hasSlicePlane",void 0),(0,P._)([(0,E.W)()],T.prototype,"hasVertexColors",void 0),(0,P._)([(0,E.W)()],T.prototype,"transparent",void 0),(0,P._)([(0,E.W)()],T.prototype,"discardInvisibleFragments",void 0),(0,P._)([(0,E.W)()],T.prototype,"polygonOffset",void 0),(0,P._)([(0,E.W)()],T.prototype,"enableOffset",void 0),(0,P._)([(0,E.W)()],T.prototype,"writeDepth",void 0),(0,P._)([(0,E.W)()],T.prototype,"hasOccludees",void 0),(0,P._)([(0,E.W)()],T.prototype,"terrainDepthTest",void 0),(0,P._)([(0,E.W)()],T.prototype,"cullAboveTerrain",void 0),(0,P._)([(0,E.W)()],T.prototype,"objectAndLayerIdColorInstanced",void 0),(0,P._)([(0,E.W)()],T.prototype,"vvColor",void 0),(0,P._)([(0,E.W)()],T.prototype,"draped",void 0);class D extends p.W{constructor(e){super(e,z),this._configuration=new T,this.supportsEdges=!0,this.produces=new Map([[u.N.OPAQUE_MATERIAL,e=>this._isOpaqueMaterialPass(e)],[u.N.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>this._isOpaqueNoSSAODepthPass(e)],[u.N.TRANSPARENT_MATERIAL,e=>(0,o.zW)(e)&&this._transparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>(0,o.eh)(e)&&this._transparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,o.zW)(e)&&this._transparent&&!this.parameters.writeDepth],[u.N.DRAPED_MATERIAL,e=>(0,o.i3)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<h.xt,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=a.Q}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===o.V.Highlight||(0,o.zW)(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return(0,o.eh)(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new L(e)}createBufferWriter(){const e=(0,s.BP)().vec3f(d.r.POSITION);return(0,n.E)()&&e.vec4u8(d.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(d.r.COLORFEATUREATTRIBUTE):e.vec4u8(d.r.COLOR),new _.Z(e)}}class L extends c.A{beginSlot(e){return this.acquireTechnique(C,e)}}class z extends g.S{constructor(){super(...arguments),this.color=i.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=l.s2.None,this.draped=!1,this.discardInvisibleFragments=!1}}}}]);
//# sourceMappingURL=4656.98644ffe.chunk.js.map